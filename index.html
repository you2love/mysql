<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MySQL å­¦ä¹ æ•™ç¨‹ - ä»å…¥é—¨åˆ°ç²¾é€š</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="styles.css">
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.code-block').forEach(function(block) {
                var pre = block.querySelector('pre');
                if (!pre) return;
                
                var code = document.createElement('div');
                code.className = 'code-actions';
                
                var copyBtn = document.createElement('button');
                copyBtn.className = 'copy-btn';
                copyBtn.innerHTML = 'ğŸ“‹ å¤åˆ¶';
                copyBtn.onclick = function(e) {
                    e.stopPropagation();
                    var text = pre.textContent;
                    navigator.clipboard.writeText(text).then(function() {
                        copyBtn.innerHTML = 'âœ“ å·²å¤åˆ¶';
                        setTimeout(function() {
                            copyBtn.innerHTML = 'ğŸ“‹ å¤åˆ¶';
                        }, 2000);
                    });
                };
                
                code.appendChild(copyBtn);
                block.insertBefore(code, pre);
            });

            function wrapLongContent(container) {
                var children = Array.from(container.querySelectorAll(':scope > h3, :scope > h4'));
                
                children.forEach(function(heading) {
                    var contentElements = [];
                    var totalLines = 0;
                    var sibling = heading.nextElementSibling;
                    
                    while (sibling && sibling.tagName !== 'H3' && sibling.tagName !== 'H4') {
                        contentElements.push(sibling);
                        if (sibling.classList && sibling.classList.contains('code-block')) {
                            totalLines += (sibling.textContent || '').split('\n').length;
                        }
                        sibling = sibling.nextElementSibling;
                    }
                    
                    if (totalLines > 15) {
                        var wrapper = document.createElement('div');
                        wrapper.className = 'collapsible-content';
                        contentElements.forEach(function(el) {
                            wrapper.appendChild(el);
                        });
                        
                        var details = document.createElement('details');
                        details.className = 'long-content';
                        var title = heading.textContent;
                        details.innerHTML = '<summary>ğŸ“– ' + title + ' (ç‚¹å‡»å±•å¼€/æŠ˜å  ' + totalLines + ' è¡Œä»£ç )</summary>';
                        details.appendChild(wrapper);
                        
                        heading.parentNode.replaceChild(details, heading);
                    }
                });
            }

            document.querySelectorAll('.content').forEach(wrapLongContent);
        });
    </script>
</head>
<body>
    <div class="layout">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1>MySQL æ•™ç¨‹</h1>
            </div>
            <nav class="tree-nav">
                <ul class="tree">
                    <li>
                        <a href="#introduction">ç®€ä»‹</a>
                    </li>
                    <li>
                        <a href="#installation">å®‰è£…</a>
                    </li>
                    <li>
                        <a href="#basics">åŸºç¡€æ“ä½œ</a>
                    </li>
                    <li>
                        <a href="#datatypes">æ•°æ®ç±»å‹</a>
                    </li>
                    <li>
                        <a href="#advanced">é«˜çº§ç‰¹æ€§</a>
                    </li>
                    <li>
                        <a href="#index-theory">ç´¢å¼•åŸç†</a>
                    </li>
                    <li>
                        <a href="#performance">æ€§èƒ½ä¼˜åŒ–</a>
                    </li>
                    <li>
                        <a href="#security">å®‰å…¨ç‰¹æ€§</a>
                    </li>
                    <li>
                        <a href="#ai">AI å¢å¼º</a>
                    </li>
                    <li>
                        <a href="#practice">å®æˆ˜ç»ƒä¹ </a>
                    </li>
                </ul>
            </nav>
        </aside>
        <main class="main-content">
            <section id="introduction" class="section">
            <h2>ä»€ä¹ˆæ˜¯ MySQLï¼Ÿ</h2>
            <div class="content">
                <p>MySQL æ˜¯ä¸–ç•Œä¸Šæœ€æµè¡Œçš„å¼€æºå…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿã€‚å®ƒæ”¯æŒ AI é©±åŠ¨çš„æŸ¥è¯¢ä¼˜åŒ–ã€æœºå™¨å­¦ä¹ é›†æˆã€äº‘åŸç”Ÿæ¶æ„ç­‰å‰æ²¿æŠ€æœ¯ã€‚</p>

                <div class="feature-grid">
                    <div class="feature-card">
                        <h3>ğŸ¯ å¼€æºå…è´¹</h3>
                        <p>å®Œå…¨å¼€æºï¼Œç¤¾åŒºæ´»è·ƒï¼Œæ”¯æŒ PostgreSQL åè®®å…¼å®¹</p>
                    </div>
                    <div class="feature-card">
                        <h3>âš¡ é«˜æ€§èƒ½</h3>
                        <p>AI é©±åŠ¨çš„æŸ¥è¯¢ä¼˜åŒ–å™¨ï¼Œæ€§èƒ½æå‡ 40%ï¼Œæ”¯æŒå®æ—¶åˆ†æ</p>
                    </div>
                    <div class="feature-card">
                        <h3>ğŸ”’ å®‰å…¨å¯é </h3>
                        <p>é›¶ä¿¡ä»»æ¶æ„ï¼Œé‡å­å¯†é’¥åˆ†å‘æ”¯æŒï¼Œç«¯åˆ°ç«¯åŠ å¯†</p>
                    </div>
                    <div class="feature-card">
                        <h3>ğŸŒ äº‘åŸç”Ÿ</h3>
                        <p>åŸç”Ÿæ”¯æŒ Kubernetesã€Serverless æ¶æ„ï¼Œè‡ªåŠ¨æ‰©ç¼©å®¹</p>
                    </div>
                    <div class="feature-card">
                        <h3>ğŸ¤– AI é›†æˆ</h3>
                        <p>å†…ç½®æœºå™¨å­¦ä¹ å¼•æ“ï¼Œè‡ªåŠ¨æ¨èç´¢å¼•ã€ä¼˜åŒ–æŸ¥è¯¢</p>
                    </div>
                    <div class="feature-card">
                        <h3>ğŸ“Š å®æ—¶åˆ†æ</h3>
                        <p>HTAP æ··åˆäº‹åŠ¡åˆ†æï¼Œå®æ—¶ BI å’Œ OLAP èƒ½åŠ›</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="installation" class="section">
            <h2>å®‰è£… MySQL 9.x (æœ€æ–°ç‰ˆæœ¬)</h2>
            <div class="content">
                <p><strong>MySQL 9.x æ–°ç‰¹æ€§ï¼š</strong></p>
                <ul>
                    <li>â€¢ åŸç”Ÿæ”¯æŒ ARM64 æ¶æ„ä¼˜åŒ–</li>
                    <li>â€¢ é›†æˆ AI æŸ¥è¯¢ä¼˜åŒ–å™¨</li>
                    <li>â€¢ æ”¹è¿›çš„ JSON å¤„ç†èƒ½åŠ›</li>
                    <li>â€¢ æ›´å¥½çš„äº‘åŸç”Ÿæ”¯æŒ</li>
                    <li>â€¢ å¢å¼ºçš„å®‰å…¨æ€§åŠŸèƒ½</li>
                </ul>
                <div class="tabs">
                    <div class="tab-buttons">
                        <span class="tab-button">Mac ç³»ç»Ÿ (ARM64)</span>
                        <span class="tab-button">Linux ç³»ç»Ÿ</span>
                        <span class="tab-button">Windows ç³»ç»Ÿ</span>
                        <span class="tab-button">Docker</span>
                    </div>

                    <div class="tab-content" id="mac">
                        <pre><code class="sh"><span class="com"># ä½¿ç”¨ Homebrew å®‰è£… MySQL 9.x</span>
<span class="cmd">brew</span> install mysql@<span class="num">9</span>.<span class="num">0</span>

<span class="com"># å¯åŠ¨ MySQL æœåŠ¡</span>
<span class="cmd">brew</span> <span class="cmd">services</span> start mysql@<span class="num">9</span>.<span class="num">0</span>

<span class="com"># å®‰å…¨é…ç½®ï¼ˆæ”¯æŒå¤šå› ç´ è®¤è¯ï¼‰</span>
<span class="cmd">mysql_secure_installation</span> --mfa

<span class="com"># éªŒè¯å®‰è£…</span>
<span class="cmd">mysql</span> --<span class="cmd">version</span>

<span class="com"># ç™»å½• MySQL</span>
<span class="cmd">mysql</span> -u root -p</code></pre>
                    </div>

                    <div class="tab-content" id="linux">
                        <pre><code class="sh"><span class="str">"com"</span>><span class="com"># Ubuntu/Debian 24.04 LTSsudoapt updatesudoapt install mysql-server-9.0</span>

<span class="str">"com"</span>><span class="com"># å¯ç”¨ AI ä¼˜åŒ–å™¨</span>
sudomysql -e <span class="str">"SET GLOBAL optimizer_switch=ai_optimization=on;"</span>

<span class="str">"com"</span>><span class="com"># å¯åŠ¨æœåŠ¡</span>
sudosystemctl startmysql
sudosystemctl enablemysql

<span class="str">"com"</span>><span class="com"># RHEL/CentOS 9sudodnf install mysql-server</span>

<span class="str">"com"</span>><span class="com"># å®‰å…¨é…ç½®</span>
sudomysql_secure_installation</code></pre>
                    </div>

                    <div class="tab-content" id="windows">
                        <pre><code class="sh"><span class="str">"com"</span>><span class="com"># 1. è®¿é—® MySQL å®˜ç½‘ä¸‹è½½ MySQL 9.x</span>
<span class="str">"com"</span>><span class="com"># https://dev.mysql.com/downloads/mysql/</span>

<span class="str">"com"</span>><span class="com"># 2. é€‰æ‹© "Developer Default" å®‰è£…ç±»å‹</span>

<span class="str">"com"</span>><span class="com"># 3. å¯ç”¨ä»¥ä¸‹é€‰é¡¹ï¼š</span>
<span class="str">"com"</span>><span class="com">#    - AI Query Optimizer</span>
<span class="str">"com"</span>><span class="com">#    - Machine Learning Integration</span>
<span class="str">"com"</span>><span class="com">#    - Enhanced Security</span>

<span class="str">"com"</span>><span class="com"># 4. é…ç½® root å¯†ç ï¼ˆæ”¯æŒå¯†ç ç­–ç•¥ï¼‰</span>

<span class="str">"com"</span>><span class="com"># 5. å¯åŠ¨ MySQL æœåŠ¡</span>
<span class="str">"com"</span>><span class="com"># ä»å¼€å§‹èœå•è¿è¡Œ "MySQL 9.0 Command Line Client"</span></code></pre>
                    </div>

                    <div class="tab-content" id="docker">
                        <pre><code class="sh"><span class="str">"com"</span>><span class="com"># æ‹‰å–æœ€æ–° MySQL 9.x é•œåƒdocker pull mysql:9.0</span>

<span class="str">"com"</span>><span class="com"># è¿è¡Œå®¹å™¨ï¼ˆå¯ç”¨ AI ä¼˜åŒ–å™¨ï¼‰docker run --name mysql90 \</span>
  -p <span class="num">3306</span>:<span class="num">3306</span> \
  -e MYSQL_ROOT_PASSWORD=yourpassword \
  -e MYSQL_AI_OPTIMIZER=<span class="num">1</span> \
  -d mysql:<span class="num">9</span>.<span class="num">0</span>

<span class="str">"com"</span>><span class="com"># è¿æ¥åˆ°å®¹å™¨dockerexec -it mysql90mysql -u root -p</span>

<span class="str">"com"</span>><span class="com"># ä½¿ç”¨ Docker Compose</span>
version: <span class="num">3</span>.<span class="num">8</span>
services:
  mysql:
    image: mysql:<span class="num">9</span>.<span class="num">0</span>
    environment:
      MYSQL_ROOT_PASSWORD: rootpassword
      MYSQL_AI_OPTIMIZER: <span class="num">1</span>
    ports:
      - <span class="str">"<span class="num">3306</span>:<span class="num">3306</span>"</span>
    volumes:
      - mysql_data:/var/lib/<span class="cmd">mysql</span>

volumes:
  mysql_data:</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <section id="basics" class="section">
            <h2>åŸºç¡€æ“ä½œ</h2>
            <div class="content">
                <h3>1. è¿æ¥æ•°æ®åº“</h3>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- è¿æ¥åˆ° MySQL</span>
mysql -u root -p

<span class="com">-- æˆ–æŒ‡å®šä¸»æœºå’Œç«¯å£</span>
mysql -h localhost -P <span class="num">3306</span> -u root -p</code></pre>
                </div>

                <h3>2. åˆ›å»ºæ•°æ®åº“</h3>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- åˆ›å»ºæ•°æ®åº“</span>
<span class="kwd">CREATE</span> <span class="kwd">DATABASE</span> my_database;

<span class="com">-- æ˜¾ç¤ºæ‰€æœ‰æ•°æ®åº“</span>
<span class="kwd">SHOW</span> DATABASES;

<span class="com">-- ä½¿ç”¨æŒ‡å®šæ•°æ®åº“</span>
<span class="kwd">USE</span> my_database;

<span class="com">-- åˆ é™¤æ•°æ®åº“</span>
<span class="kwd">DROP</span> <span class="kwd">DATABASE</span> my_database;</code></pre>
                </div>

                <h3>3. åˆ›å»ºæ•°æ®è¡¨ï¼ˆæ”¯æŒæ–°æ•°æ®ç±»å‹ï¼‰</h3>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- åˆ›å»ºç”¨æˆ·è¡¨ï¼ˆåŒ…å« <span class="kwd">JSON</span> å’Œ <span class="kwd">VECTOR</span> ç±»å‹ï¼‰</span>
<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> users (
    id <span class="kwd">BIGINT</span> <span class="kwd">UNSIGNED</span> <span class="kwd">AUTO_INCREMENT</span> <span class="kwd">PRIMARY KEY</span>,
    username <span class="type">VARCHAR</span>(<span class="num">100</span>) <span class="kwd"><span class="kwd">NOT</span> NULL</span> <span class="kwd">UNIQUE</span>,
    email <span class="type">VARCHAR</span>(<span class="num">255</span>) <span class="kwd"><span class="kwd">NOT</span> NULL</span>,
    age <span class="kwd">TINYINT</span> <span class="kwd">UNSIGNED</span>,
    preferences <span class="type">JSON</span>,
    user_embedding <span class="type">VECTOR</span>(<span class="num">768</span>),
    created_at <span class="type">TIMESTAMP</span>(<span class="num">6</span>) <span class="kwd">DEFAULT</span> <span class="kwd">CURRENT_TIMESTAMP</span>(<span class="num">6</span>),
    updated_at <span class="type">TIMESTAMP</span>(<span class="num">6</span>) <span class="kwd">DEFAULT</span> <span class="kwd">CURRENT_TIMESTAMP</span>(<span class="num">6</span>) <span class="kwd">ON</span> <span class="kwd">UPDATE</span> <span class="kwd">CURRENT_TIMESTAMP</span>(<span class="num">6</span>),
    <span class="kwd">FULLTEXT</span> <span class="kwd">INDEX</span> idx_username_fulltext (username),
    <span class="kwd">INDEX</span> idx_email (email),
    <span class="kwd">SPATIAL</span> <span class="kwd">INDEX</span> idx_location (location) <span class="kwd">IF</span> <span class="kwd">EXISTS</span>
) ENGINE=InnoDB <span class="kwd">DEFAULT</span> CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

<span class="com">-- æŸ¥çœ‹è¡¨ç»“æ„</span>
<span class="kwd">DESCRIBE</span> users;
<span class="kwd">SHOW</span> <span class="kwd">CREATE</span> <span class="kwd">TABLE</span> users\G</code></pre>
                </div>

                <h3>4. æ’å…¥æ•°æ®</h3>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- æ’å…¥å•æ¡æ•°æ®</span>
<span class="kwd">INSERT</span> <span class="kwd">INTO</span> users (username, email, age)
<span class="kwd">VALUES</span> (<span class="str">'zhangsan'</span>, <span class="str">'zhangsan@example.com'</span>, <span class="num">25</span>);

<span class="com">-- æ’å…¥å¤šæ¡æ•°æ®</span>
<span class="kwd">INSERT</span> <span class="kwd">INTO</span> users (username, email, age) <span class="kwd">VALUES</span>
    (<span class="str">'lisi'</span>, <span class="str">'lisi@example.com'</span>, <span class="num">30</span>),
    (<span class="str">'wangwu'</span>, <span class="str">'wangwu@example.com'</span>, <span class="num">28</span>);</code></pre>
                </div>

                <h3>5. æŸ¥è¯¢æ•°æ®ï¼ˆä½¿ç”¨ AI ä¼˜åŒ–ï¼‰</h3>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- æŸ¥è¯¢æ‰€æœ‰æ•°æ®</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> users;

<span class="com">-- æŸ¥è¯¢ç‰¹å®šåˆ—</span>
<span class="kwd">SELECT</span> username, email <span class="kwd">FROM</span> users;

<span class="com">-- æ¡ä»¶æŸ¥è¯¢ï¼ˆ<span class="kwd">AI</span> è‡ªåŠ¨ä¼˜åŒ–ï¼‰</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> users <span class="kwd">WHERE</span> age > <span class="num">25</span>;

<span class="com">-- <span class="kwd">JSON</span> æ•°æ®æŸ¥è¯¢</span>
<span class="kwd">SELECT</span> username,
       <span class="func">JSON_EXTRACT</span>(preferences, <span class="str">'$.theme'</span>) <span class="kwd">as</span> theme,
       <span class="func">JSON_EXTRACT</span>(preferences, <span class="str">'$.language'</span>) <span class="kwd">as</span> <span class="kwd">language</span>
<span class="kwd">FROM</span> users
<span class="kwd">WHERE</span> <span class="func">JSON_EXTRACT</span>(preferences, <span class="str">'$.newsletter'</span>) = true;

<span class="com">-- å‘é‡ç›¸ä¼¼æ€§æœç´¢ï¼ˆç”¨äº <span class="kwd">AI</span> åº”ç”¨ï¼‰</span>
<span class="kwd">SELECT</span> username,
       <span class="func">VECTOR_DISTANCE</span>(user_embedding,
                       <span class="str">'[<span class="num">0</span>.<span class="num">1</span>, <span class="num">0</span>.<span class="num">2</span>, <span class="num">0</span>.<span class="num">3</span>, ..., <span class="num">0</span>.<span class="num">768</span>]'</span>) <span class="kwd">as</span> distance
<span class="kwd">FROM</span> users
<span class="kwd">ORDER BY</span> distance
<span class="kwd">LIMIT</span> <span class="num">10</span>;

<span class="com">-- å…¨æ–‡æœç´¢ï¼ˆæ”¹è¿›çš„å…¨æ–‡ç´¢å¼•ï¼‰</span>
<span class="kwd">SELECT</span> username,
       <span class="func">MATCH</span>(username, email) <span class="func">AGAINST</span>(<span class="str">'zhangsan'</span> <span class="kwd">IN</span> <span class="kwd">NATURAL</span> <span class="kwd">LANGUAGE</span> MODE) <span class="kwd">as</span> relevance
<span class="kwd">FROM</span> users
<span class="kwd">WHERE</span> <span class="func">MATCH</span>(username, email) <span class="func">AGAINST</span>(<span class="str">'zhangsan'</span> <span class="kwd">IN</span> <span class="kwd">NATURAL</span> <span class="kwd">LANGUAGE</span> MODE);

<span class="com">-- ä½¿ç”¨ <span class="kwd">AI</span> ä¼˜åŒ–æç¤º</span>
<span class="kwd">SELECT</span> /*+ AI_OPTIMIZE */ * <span class="kwd">FROM</span> users <span class="kwd">WHERE</span> age > <span class="num">25</span> <span class="kwd">ORDER BY</span> created_at DESC;

<span class="com">-- åˆ†é¡µæŸ¥è¯¢ï¼ˆä¼˜åŒ–æ€§èƒ½ï¼‰</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> users
<span class="kwd">WHERE</span> id > <span class="num">1000</span>
<span class="kwd">ORDER BY</span> id
<span class="kwd">LIMIT</span> <span class="num">10</span>;

<span class="com">-- çª—å£å‡½æ•°ï¼ˆåˆ†ææŸ¥è¯¢ï¼‰</span>
<span class="kwd">SELECT</span> username,
       age,
       <span class="func">RANK</span>() OVER (<span class="kwd">ORDER BY</span> age <span class="kwd">DESC</span>) <span class="kwd">as</span> age_rank,
       <span class="func">DENSE_RANK</span>() OVER (<span class="kwd">ORDER BY</span> age <span class="kwd">DESC</span>) <span class="kwd">as</span> dense_age_rank
<span class="kwd">FROM</span> users;</code></pre>
                </div>

                <h3>6. æ›´æ–°æ•°æ®</h3>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- æ›´æ–°å•æ¡æ•°æ®</span>
<span class="kwd">UPDATE</span> users <span class="kwd">SET</span> age = <span class="num">26</span> <span class="kwd">WHERE</span> username = <span class="str">'zhangsan'</span>;

<span class="com">-- æ›´æ–°å¤šæ¡æ•°æ®</span>
<span class="kwd">UPDATE</span> users <span class="kwd">SET</span> age = age + <span class="num">1</span> <span class="kwd">WHERE</span> age < <span class="num">30</span>;</code></pre>
                </div>

                <h3>7. åˆ é™¤æ•°æ®</h3>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- åˆ é™¤å•æ¡æ•°æ®</span>
<span class="kwd">DELETE</span> <span class="kwd">FROM</span> users <span class="kwd">WHERE</span> id = <span class="num">1</span>;

<span class="com">-- åˆ é™¤å¤šæ¡æ•°æ®</span>
<span class="kwd">DELETE</span> <span class="kwd">FROM</span> users <span class="kwd">WHERE</span> age < <span class="num">25</span>;

<span class="com">-- æ¸…ç©ºè¡¨</span>
TRUNCATE <span class="kwd">TABLE</span> users;</code></pre>
                </div>

                <h3 id="datatypes">8. æ•°æ®ç±»å‹</h3>
                <p>MySQL æä¾›äº†ä¸°å¯Œçš„æ•°æ®ç±»å‹ï¼Œäº†è§£å„ç§æ•°æ®ç±»å‹çš„ç‰¹æ€§å¯¹äºè®¾è®¡é«˜æ•ˆçš„æ•°æ®åº“è¡¨ç»“æ„è‡³å…³é‡è¦ã€‚</p>

                <h4>8.1 æ•°å€¼ç±»å‹</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- æ•´æ•°ç±»å‹</span>
TINYINT:       <span class="num">-128</span> åˆ° <span class="num">127</span> (æˆ– <span class="num">0</span> åˆ° <span class="num">255</span> æ— ç¬¦å·)
SMALLINT:      <span class="num">-32768</span> åˆ° <span class="num">32767</span>
MEDIUMINT:     <span class="num">-8388608</span> åˆ° <span class="num">8388607</span>
INT:           <span class="num">-2147483648</span> åˆ° <span class="num">2147483647</span> (å¸¸ç”¨)
BIGINT:        <span class="num">-9</span>.<span class="num">22</span>Ã—10^<span class="num">18</span> åˆ° <span class="num">9</span>.<span class="num">22</span>Ã—10^<span class="num">18</span>

<span class="com">-- æµ®ç‚¹æ•°ç±»å‹</span>
FLOAT(p):      å•ç²¾åº¦æµ®ç‚¹æ•°, p è¡¨ç¤ºç²¾åº¦
DOUBLE:        åŒç²¾åº¦æµ®ç‚¹æ•°
DECIMAL(m,d):  ç²¾ç¡®æ•°å€¼, m æ˜¯æ€»ä½æ•°, d æ˜¯å°æ•°ä½æ•° (ç”¨äºé‡‘èè®¡ç®—)

<span class="com">-- å®šç‚¹æ•°ç¤ºä¾‹</span>
<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> accounts (
    id <span class="kwd">INT</span> <span class="kwd">PRIMARY KEY</span>,
    balance <span class="type">DECIMAL</span>(<span class="num">15</span>,<span class="num">2</span>) <span class="kwd">DEFAULT</span> <span class="num">0.00</span>,  <span class="com">-- æœ€å¤š15ä½æ•°å­—,2ä½å°æ•°</span>
    rate <span class="type">DECIMAL</span>(<span class="num">5</span>,<span class="num">4</span>) <span class="kwd">DEFAULT</span> <span class="num">0.0000</span>
);

<span class="com">-- BIT ç±»å‹ (ä½å­—æ®µ)</span>
<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> flags (
    flags <span class="type">BIT</span>(<span class="num">8</span>)  <span class="com">-- å­˜å‚¨8ä½äºŒè¿›åˆ¶å€¼</span>
);
<span class="kwd">INSERT</span> <span class="kwd">INTO</span> flags <span class="kwd">VALUES</span>(<span class="num">b</span><span class="str">'10101010'</span>);</code></pre>
                </div>

                <h4>8.2 å­—ç¬¦ä¸²ç±»å‹</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- å®šé•¿å­—ç¬¦ä¸²</span>
CHAR(n):       å›ºå®šé•¿åº¦, æœ€å¤š <span class="num">255</span> å­—ç¬¦, ä¸è¶³éƒ¨åˆ†ç”¨ç©ºæ ¼å¡«å……
CHAR(<span class="num">10</span>):      <span class="str">'hello'</span> å­˜å‚¨ä¸º <span class="str">'hello     '</span>

<span class="com">-- å˜é•¿å­—ç¬¦ä¸²</span>
VARCHAR(n):    å¯å˜é•¿åº¦, æœ€å¤š <span class="num">65535</span> å­—èŠ‚ (ä½¿ç”¨utf8mb4æ—¶æœ€å¤š <span class="num">16383</span> å­—ç¬¦)
TINYTEXT:      æœ€å¤š <span class="num">255</span> å­—èŠ‚
TEXT:          æœ€å¤š <span class="num">65535</span> å­—èŠ‚
MEDIUMTEXT:    æœ€å¤š <span class="num">16</span>MB
LONGTEXT:      æœ€å¤š <span class="num">4</span>GB

<span class="com">-- å­—ç¬¦ä¸²ç¤ºä¾‹</span>
<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> posts (
    id <span class="kwd">INT</span> <span class="kwd">PRIMARY KEY</span>,
    title <span class="type">VARCHAR</span>(<span class="num">200</span>) <span class="kwd">NOT NULL</span>,
    summary <span class="type">TINYTEXT</span>,
    content <span class="type">TEXT</span>,
    bio <span class="type">MEDIUMTEXT</span>
);

<span class="com">-- ENUM ç±»å‹ (æšä¸¾)</span>
<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> orders (
    status <span class="type">ENUM</span>(<span class="str">'pending'</span>, <span class="str">'processing'</span>, <span class="str">'shipped'</span>, <span class="str">'delivered'</span>, <span class="str">'cancelled'</span>)
);
<span class="kwd">INSERT</span> <span class="kwd">INTO</span> orders (status) <span class="kwd">VALUES</span>(<span class="str">'pending'</span>);

<span class="com">-- SET ç±»å‹ (é›†åˆ)</span>
<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> user_profile (
    hobbies <span class="type">SET</span>(<span class="str">'reading'</span>, <span class="str">'sports'</span>, <span class="str">'music'</span>, <span class="str">'travel'</span>)
);
<span class="kwd">INSERT</span> <span class="kwd">INTO</span> user_profile (hobbies) <span class="kwd">VALUES</span>(<span class="str">'reading,sports'</span>);</code></pre>
                </div>

                <h4>8.3 æ—¥æœŸå’Œæ—¶é—´ç±»å‹</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- æ—¥æœŸæ—¶é—´ç±»å‹</span>
DATE:          æ—¥æœŸ, æ ¼å¼: <span class="str">'YYYY-MM-DD'</span>, èŒƒå›´: <span class="str">'1000-01-01'</span> åˆ° <span class="str">'9999-12-31'</span>
TIME:          æ—¶é—´, æ ¼å¼: <span class="str">'HH:MM:SS'</span>, èŒƒå›´: <span class="str">'-838:59:59'</span> åˆ° <span class="str">'838:59:59'</span>
DATETIME:      æ—¥æœŸæ—¶é—´, æ ¼å¼: <span class="str">'YYYY-MM-DD HH:MM:SS'</span>, èŒƒå›´: <span class="str">'1000-01-01 00:00:00'</span>
TIMESTAMP:     æ—¶é—´æˆ³, èŒƒå›´: <span class="str">'1970-01-01 00:00:01'</span> åˆ° <span class="str">'2038-01-19 03:14:07'</span> (UTC)
YEAR:          å¹´ä»½, æ ¼å¼: <span class="str">'YYYY'</span>

<span class="com">-- æ—¥æœŸæ—¶é—´ç¤ºä¾‹</span>
<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> events (
    id <span class="kwd">INT</span> <span class="kwd">PRIMARY KEY</span>,
    event_date <span class="type">DATE</span>,
    event_time <span class="type">TIME</span>,
    created_at <span class="type">DATETIME</span> <span class="kwd">DEFAULT</span> <span class="kwd">CURRENT_TIMESTAMP</span>,
    updated_at <span class="type">DATETIME</span> <span class="kwd">DEFAULT</span> <span class="kwd">CURRENT_TIMESTAMP</span> <span class="kwd">ON</span> <span class="kwd">UPDATE</span> <span class="kwd">CURRENT_TIMESTAMP</span>,
    logged_at <span class="type">TIMESTAMP</span> <span class="kwd">DEFAULT</span> <span class="kwd">CURRENT_TIMESTAMP</span>
);

<span class="com">-- æ’å…¥æ—¥æœŸæ—¶é—´å€¼</span>
<span class="kwd">INSERT</span> <span class="kwd">INTO</span> events (event_date, event_time, created_at)
<span class="kwd">VALUES</span>(<span class="str">'2024-01-15'</span>, <span class="str">'14:30:00'</span>, <span class="str">'2024-01-15 14:30:00'</span>);

<span class="com">-- ä½¿ç”¨ NOW() è·å–å½“å‰æ—¶é—´</span>
<span class="kwd">INSERT</span> <span class="kwd">INTO</span> events (event_date, event_time)
<span class="kwd">VALUES</span>(<span class="func">CURDATE</span>(), <span class="func">CURTIME</span>());

<span class="com">-- TIMESTAMP è‡ªåŠ¨æ›´æ–°ç¤ºä¾‹</span>
<span class="kwd">UPDATE</span> events <span class="kwd">SET</span> event_date = <span class="func">CURDATE</span>() <span class="kwd">WHERE</span> id = <span class="num">1</span>;</code></pre>
                </div>

                <h4>8.4 JSON ç±»å‹ (MySQL 5.7+)</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- JSON ç±»å‹ç”¨äºå­˜å‚¨ç»“æ„åŒ–æ•°æ®</span>
<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> user_preferences (
    id <span class="kwd">INT</span> <span class="kwd">PRIMARY KEY</span>,
    user_id <span class="kwd">INT</span> <span class="kwd">NOT NULL</span>,
    preferences <span class="type">JSON</span>,
    settings <span class="type">JSON</span>
);

<span class="com">-- æ’å…¥ JSON æ•°æ®</span>
<span class="kwd">INSERT</span> <span class="kwd">INTO</span> user_preferences (user_id, preferences, settings)
<span class="kwd">VALUES</span>(
    <span class="num">1</span>,
    <span class="str">'{"theme": "dark", "language": "zh-CN", "notifications": true}'</span>,
    <span class="str">'{"privacy": "public", "two_factor": false}'</span>
);

<span class="com">-- ä½¿ç”¨ JSON_EXTRACT æå–å€¼</span>
<span class="kwd">SELECT</span>
    user_id,
    <span class="func">JSON_EXTRACT</span>(preferences, <span class="str">'$.theme'</span>) <span class="kwd">as</span> theme,
    <span class="func">JSON_EXTRACT</span>(preferences, <span class="str">'$.language'</span>) <span class="kwd">as</span> <span class="kwd">language</span>,
    <span class="func">JSON_EXTRACT</span>(preferences, <span class="str">'$.notifications'</span>) <span class="kwd">as</span> notifications
<span class="kwd">FROM</span> user_preferences;

<span class="com">-- ä½¿ç”¨ JSON_SET æ›´æ–°/æ·»åŠ å€¼</span>
<span class="kwd">UPDATE</span> user_preferences
<span class="kwd">SET</span> preferences = <span class="func">JSON_SET</span>(preferences, <span class="str">'$.theme'</span>, <span class="str">'light'</span>, <span class="str">'$.font_size'</span>, <span class="str">'14px'</span>)
<span class="kwd">WHERE</span> user_id = <span class="num">1</span>;

<span class="com">-- ä½¿ç”¨ JSON_REMOVE åˆ é™¤å€¼</span>
<span class="kwd">UPDATE</span> user_preferences
<span class="kwd">SET</span> preferences = <span class="func">JSON_REMOVE</span>(preferences, <span class="str">'$.notifications'</span>)
<span class="kwd">WHERE</span> user_id = <span class="num">1</span>;

<span class="com">-- ä½¿ç”¨ JSON_KEYS è·å–æ‰€æœ‰é”®</span>
<span class="kwd">SELECT</span> <span class="func">JSON_KEYS</span>(preferences) <span class="kwd">as</span> keys <span class="kwd">FROM</span> user_preferences;

<span class="com">-- JSON æ•°ç»„æ“ä½œ</span>
<span class="kwd">INSERT</span> <span class="kwd">INTO</span> user_preferences (user_id, preferences)
<span class="kwd">VALUES</span>(<span class="num">2</span>, <span class="str">'{"tags": ["mysql", "database", "sql"]}'</span>);

<span class="kwd">SELECT</span> <span class="func">JSON_EXTRACT</span>(preferences, <span class="str">'$.tags[0]'</span>) <span class="kwd">as</span> first_tag <span class="kwd">FROM</span> user_preferences;</code></pre>
                </div>

                <h4>8.5 ç©ºé—´æ•°æ®ç±»å‹ (GIS)</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- ç©ºé—´æ•°æ®ç±»å‹</span>
GEOMETRY:      ä»»æ„å‡ ä½•ç±»å‹
POINT:         ç‚¹ (x, y)
LINESTRING:    æ›²çº¿ (ç‚¹åºåˆ—)
POLYGON:       å¤šè¾¹å½¢ (è¾¹ç•Œç‚¹åºåˆ—)
MULTIPOINT:    ç‚¹é›†åˆ
MULTILINESTRING: æ›²çº¿é›†åˆ
MULTIPOLYGON:  å¤šè¾¹å½¢é›†åˆ
GEOMETRYCOLLECTION: å‡ ä½•é›†åˆ

<span class="com">-- åˆ›å»ºç©ºé—´æ•°æ®è¡¨</span>
<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> locations (
    id <span class="kwd">INT</span> <span class="kwd">PRIMARY KEY</span>,
    name <span class="type">VARCHAR</span>(<span class="num">100</span>),
    location POINT <span class="kwd">NOT NULL</span>,
    area POLYGON,
    route LINESTRING,
    <span class="kwd">SPATIAL</span> <span class="kwd">INDEX</span> idx_location (location)
);

<span class="com">-- æ’å…¥ç©ºé—´æ•°æ®</span>
<span class="kwd">INSERT</span> <span class="kwd">INTO</span> locations (name, location)
<span class="kwd">VALUES</span>(
    <span class="str">'å¤©å®‰é—¨å¹¿åœº'</span>,
    <span class="func">ST_GeomFromText</span>(<span class="str">'POINT(116.397428 39.90923)'</span>)
);

<span class="com">-- æŸ¥è¯¢åæ ‡</span>
<span class="kwd">SELECT</span> name, <span class="func">ST_X</span>(location) <span class="kwd">as</span> longitude, <span class="func">ST_Y</span>(location) <span class="kwd">as</span> latitude
<span class="kwd">FROM</span> locations;

<span class="com">-- è®¡ç®—ä¸¤ç‚¹è·ç¦» (ç±³)</span>
<span class="kwd">SELECT</span> <span class="func">ST_Distance_Sphere</span>(
    <span class="func">ST_GeomFromText</span>(<span class="str">'POINT(116.397428 39.90923)'</span>),
    <span class="func">ST_GeomFromText</span>(<span class="str">'POINT(121.473701 31.230416)'</span>)
) <span class="kwd">as</span> distance_meters;

<span class="com">-- åˆ›å»ºå¤šè¾¹å½¢</span>
<span class="kwd">INSERT</span> <span class="kwd">INTO</span> locations (name, area)
<span class="kwd">VALUES</span>(
    <span class="str">'åŒ—äº¬å¸‚'</span>,
    <span class="func">ST_GeomFromText</span>(<span class="str">'POLYGON((116.0 39.0, 117.0 39.0, 117.0 41.0, 116.0 41.0, 116.0 39.0))'</span>)
);

<span class="com">-- åˆ¤æ–­ç‚¹æ˜¯å¦åœ¨å¤šè¾¹å½¢å†…</span>
<span class="kwd">SELECT</span> name <span class="kwd">FROM</span> locations
<span class="kwd">WHERE</span> <span class="func">ST_Contains</span>(
    area,
    <span class="func">ST_GeomFromText</span>(<span class="str">'POINT(116.5 40.0)'</span>)
);</code></pre>
                </div>

                <h4>8.6 å‘é‡ç±»å‹ (MySQL 9.0+ AI å¢å¼º)</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- å‘é‡ç±»å‹ç”¨äºå­˜å‚¨åµŒå…¥å‘é‡ (AI/ML åº”ç”¨)</span>
<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> document_embeddings (
    id <span class="kwd">INT</span> <span class="kwd">PRIMARY KEY</span>,
    doc_id <span class="kwd">INT</span> <span class="kwd">NOT NULL</span>,
    embedding VECTOR(<span class="num">768</span>),  <span class="com">-- 768ç»´å‘é‡ (BERTç­‰æ¨¡å‹å¸¸ç”¨)</span>
    <span class="kwd">INDEX</span> idx_embedding (embedding)
);

<span class="com">-- æ’å…¥å‘é‡æ•°æ® (éœ€è¦è½¬æ¢ä¸ºå­—ç¬¦ä¸²æ ¼å¼)</span>
<span class="kwd">INSERT</span> <span class="kwd">INTO</span> document_embeddings (doc_id, embedding)
<span class="kwd">VALUES</span>(
    <span class="num">1</span>,
    <span class="str">'[0.1, 0.2, 0.3, 0.0, -0.1, 0.5, -0.3, 0.8, ...]'</span>
);

<span class="com">-- å‘é‡ç›¸ä¼¼æ€§æœç´¢ (ä½™å¼¦ç›¸ä¼¼åº¦)</span>
<span class="kwd">SELECT</span>
    doc_id,
    <span class="func">VECTOR_DISTANCE</span>(embedding, <span class="str">'[0.1, 0.2, 0.3, 0.0, -0.1, 0.5, -0.3, 0.8, ...]'</span>, <span class="str">'cosine'</span>) <span class="kwd">as</span> similarity
<span class="kwd">FROM</span> document_embeddings
<span class="kwd">ORDER BY</span> similarity
<span class="kwd">LIMIT</span> <span class="num">5</span>;

<span class="com">-- æ¬§æ°è·ç¦»</span>
<span class="kwd">SELECT</span>
    doc_id,
    <span class="func">VECTOR_DISTANCE</span>(embedding, <span class="str">'[0.1, 0.2, 0.3, ...]'</span>, <span class="str">'euclidean'</span>) <span class="kwd">as</span> distance
<span class="kwd">FROM</span> document_embeddings
<span class="kwd">ORDER BY</span> distance
<span class="kwd">LIMIT</span> <span class="num">5</span>;

<span class="com">-- å†…ç§¯</span>
<span class="kwd">SELECT</span>
    doc_id,
    <span class="func">VECTOR_DISTANCE</span>(embedding, <span class="str">'[0.1, 0.2, 0.3, ...]'</span>, <span class="str">'dot_product'</span>) <span class="kwd">as</span> score
<span class="kwd">FROM</span> document_embeddings
<span class="kwd">ORDER BY</span> score DESC
<span class="kwd">LIMIT</span> <span class="num">5</span>;

<span class="com">-- ä½¿ç”¨ HNSW ç´¢å¼•åŠ é€Ÿå‘é‡æœç´¢</span>
<span class="kwd">ALTER</span> <span class="kwd">TABLE</span> document_embeddings
ADD <span class="kwd">INDEX</span> idx_hnsw (embedding) <span class="kwd">INDEX_TYPE</span> = <span class="str">'HNSW'</span> <span class="kwd">PARAMETERS</span> = <span class="str">'{"m": 16, "ef_construction": 200}'</span>;</code></pre>
                </div>

                <h4>8.7 æ•°æ®ç±»å‹é€‰æ‹©å»ºè®®</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- æ•°æ®ç±»å‹é€‰æ‹©åŸåˆ™</span>

<span class="com">-- 1. é€‰æ‹©æœ€å°çš„æ•°æ®ç±»å‹</span>
<span class="com">-- ä¸æ¨è: INT UNSIGNED å¯¹äº 0-100 çš„å€¼</span>
<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> age_table (
    age TINYINT UNSIGNED  <span class="com">-- 0-255, æ¯” INT èŠ‚çœ3å­—èŠ‚</span>
);

<span class="com">-- 2. ä½¿ç”¨ VARCHAR(n) è€Œé CHAR(n) å½“å­—ç¬¦ä¸²é•¿åº¦ä¸ç¡®å®šæ—¶</span>
<span class="com">-- CHAR(10) å§‹ç»ˆå ç”¨10å­—èŠ‚, VARCHAR(10) æŒ‰å®é™…é•¿åº¦</span>

<span class="com">-- 3. ä½¿ç”¨ DECIMAL è€Œé FLOAT/DOUBLE ç”¨äºç²¾ç¡®æ•°å€¼</span>
<span class="com">-- é‡‘èè®¡ç®—: DECIMAL(15,2) vs FLOAT</span>
<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> accounts (
    balance <span class="type">DECIMAL</span>(<span class="num">15</span>,<span class="num">2</span>)  <span class="com">-- ç²¾ç¡®</span>
);

<span class="com">-- 4. ä½¿ç”¨ TIMESTAMP è€Œé DATETIME å½“éœ€è¦è‡ªåŠ¨æ›´æ–°æ—¶</span>
<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> logs (
    created_at TIMESTAMP <span class="kwd">DEFAULT</span> <span class="kwd">CURRENT_TIMESTAMP</span>,  <span class="com">-- è‡ªåŠ¨è®¾ç½®</span>
    updated_at TIMESTAMP <span class="kwd">DEFAULT</span> <span class="kwd">CURRENT_TIMESTAMP</span> <span class="kwd">ON</span> <span class="kwd">UPDATE</span> <span class="kwd">CURRENT_TIMESTAMP</span>  <span class="com">-- è‡ªåŠ¨æ›´æ–°</span>
);

<span class="com">-- 5. ä½¿ç”¨ JSON ç±»å‹å­˜å‚¨çµæ´»çš„ç»“æ„åŒ–æ•°æ®</span>
<span class="com">-- ä½†ä¸è¦æ»¥ç”¨, é¢‘ç¹æŸ¥è¯¢çš„å­—æ®µåº”è¯¥ç”¨ç‹¬ç«‹åˆ—</span>

<span class="com">-- 6. è€ƒè™‘å­—ç¬¦é›†: ä½¿ç”¨ utf8mb4 æ”¯æŒemoji</span>
<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> messages (
    content <span class="type">VARCHAR</span>(<span class="num">1000</span>) <span class="kwd">CHARSET</span> utf8mb4 COLLATE utf8mb4_unicode_ci
);

<span class="com">-- 7. æœ‰ç¬¦å· vs æ— ç¬¦å·</span>
<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> counters (
    positive_count TINYINT UNSIGNED,  <span class="com">-- 0-255</span>
    signed_count TINYINT               <span class="com">-- -128 åˆ° 127</span>
);</code></pre>
                </div>
            </div>
        </section>
            <h2>é«˜çº§ç‰¹æ€§</h2>
            <div class="content">
                <h3>1. ç´¢å¼•è¯¦è§£ï¼ˆAI é©±åŠ¨ï¼‰</h3>

                <h4>1.1 ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Ÿ</h4>
                <p>ç´¢å¼•æ˜¯æ•°æ®åº“ä¸­ç”¨äºåŠ é€Ÿæ•°æ®æ£€ç´¢çš„æ•°æ®ç»“æ„ã€‚å°±åƒä¹¦ç±çš„ç›®å½•ä¸€æ ·ï¼Œç´¢å¼•å¯ä»¥å¸®åŠ©å¿«é€Ÿå®šä½æ•°æ®ï¼Œè€Œä¸éœ€è¦æ‰«ææ•´ä¸ªè¡¨ã€‚åˆç†çš„ç´¢å¼•è®¾è®¡å¯ä»¥æ˜¾è‘—æå‡æŸ¥è¯¢æ€§èƒ½ï¼Œä½†ä¹Ÿä¼šå ç”¨å­˜å‚¨ç©ºé—´å¹¶å½±å“å†™å…¥æ€§èƒ½ã€‚</p>

                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- æŸ¥çœ‹è¡¨çš„å½“å‰ç´¢å¼•çŠ¶æ€</span>
<span class="kwd">SHOW</span> <span class="kwd">INDEX</span> <span class="kwd">FROM</span> users;

<span class="com">-- åˆ†æè¡¨è·å–ç´¢å¼•ä½¿ç”¨ç»Ÿè®¡</span>
<span class="kwd">ANALYZE</span> <span class="kwd">TABLE</span> users;

<span class="com">-- æŸ¥çœ‹ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> mysql.innodb_index_stats
<span class="kwd">WHERE</span> database_name = <span class="kwd">DATABASE</span>() <span class="kwd">AND</span> table_name = <span class="str">'users'</span>;</code></pre>
                </div>

                <details>
                    <summary>1.2 ç´¢å¼•ç±»å‹ï¼ˆç‚¹å‡»å±•å¼€ï¼‰</summary>

                <h5>1.2.1 ä¸»é”®ç´¢å¼•ï¼ˆPRIMARY KEYï¼‰</h5>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- ä¸»é”®ç´¢å¼•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼Œå”¯ä¸€ä¸”éç©ºï¼‰</span>
<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> users (
    id <span class="kwd">INT</span> <span class="kwd">AUTO_INCREMENT</span> <span class="kwd">PRIMARY KEY</span>,
    username <span class="type">VARCHAR</span>(<span class="num">100</span>)
);

<span class="com">-- æˆ–è€…å•ç‹¬å®šä¹‰</span>
<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> users (
    id <span class="kwd">INT</span> <span class="kwd">AUTO_INCREMENT</span>,
    username <span class="type">VARCHAR</span>(<span class="num">100</span>),
    <span class="kwd">PRIMARY KEY</span> (id)
);

<span class="com">-- å¤åˆä¸»é”®</span>
<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> user_scores (
    user_id <span class="type">INT</span>,
    game_id <span class="type">INT</span>,
    score <span class="type">INT</span>,
    <span class="kwd">PRIMARY KEY</span> (user_id, game_id)
);</code></pre>
                </div>

                <h5>1.2.2 å”¯ä¸€ç´¢å¼•ï¼ˆUNIQUEï¼‰</h5>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- åˆ›å»ºå”¯ä¸€ç´¢å¼•ï¼ˆç¡®ä¿åˆ—å€¼å”¯ä¸€ï¼‰</span>
<span class="kwd">CREATE</span> <span class="kwd">UNIQUE</span> <span class="kwd">INDEX</span> idx_email <span class="kwd">ON</span> users(email);

<span class="com">-- åœ¨è¡¨å®šä¹‰ä¸­åˆ›å»º</span>
<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> users (
    id <span class="kwd">INT</span> <span class="kwd">AUTO_INCREMENT</span> <span class="kwd">PRIMARY KEY</span>,
    username <span class="type">VARCHAR</span>(<span class="num">100</span>),
    email <span class="type">VARCHAR</span>(<span class="num">255</span>) <span class="kwd">UNIQUE</span>
);

<span class="com">-- å¤åˆå”¯ä¸€ç´¢å¼•</span>
<span class="kwd">CREATE</span> <span class="kwd">UNIQUE</span> <span class="kwd">INDEX</span> idx_username_email <span class="kwd">ON</span> users(username, email);</code></pre>
                </div>

                <h5>1.2.3 æ™®é€šç´¢å¼•ï¼ˆINDEXï¼‰</h5>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- åˆ›å»ºæ™®é€šç´¢å¼•</span>
<span class="kwd">CREATE</span> <span class="kwd">INDEX</span> idx_username <span class="kwd">ON</span> users(username);

<span class="com">-- å¤åˆç´¢å¼•ï¼ˆæœ€å·¦å‰ç¼€åŸåˆ™ï¼‰</span>
<span class="kwd">CREATE</span> <span class="kwd">INDEX</span> idx_age_email <span class="kwd">ON</span> users(age, email);

<span class="com">-- ä½¿ç”¨å¤åˆç´¢å¼•çš„æŸ¥è¯¢ä¼šå‘½ä¸­ç´¢å¼•</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> users <span class="kwd">WHERE</span> age = <span class="num">25</span>; <span class="com">-- å‘½ä¸­</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> users <span class="kwd">WHERE</span> age = <span class="num">25</span> <span class="kwd">AND</span> email = <span class="str">'test@example.com'</span>; <span class="com">-- å‘½ä¸­</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> users <span class="kwd">WHERE</span> email = <span class="str">'test@example.com'</span>; <span class="com">-- ä¸å‘½ä¸­</span>

<span class="com">-- æ·»åŠ ç´¢å¼•</span>
<span class="kwd">ALTER</span> <span class="kwd">TABLE</span> users ADD <span class="kwd">INDEX</span> idx_created_at (created_at);</code></pre>
                </div>

                <h5>1.2.4 å…¨æ–‡ç´¢å¼•ï¼ˆFULLTEXTï¼‰</h5>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- å…¨æ–‡ç´¢å¼•ï¼ˆç”¨äºæ–‡æœ¬æœç´¢ï¼‰</span>
<span class="kwd">CREATE</span> <span class="kwd">FULLTEXT</span> <span class="kwd">INDEX</span> idx_content <span class="kwd">ON</span> articles(content);

<span class="com">-- å…¨æ–‡æœç´¢</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> articles
<span class="kwd">WHERE</span> <span class="func">MATCH</span>(content) <span class="func">AGAINST</span>(<span class="str">'MySQL æ•™ç¨‹'</span> <span class="kwd">IN</span> <span class="kwd">NATURAL</span> <span class="kwd">LANGUAGE</span> MODE);

<span class="com">-- å¸ƒå°”æ¨¡å¼æœç´¢</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> articles
<span class="kwd">WHERE</span> <span class="func">MATCH</span>(content, title) <span class="func">AGAINST</span>(<span class="str">'MySQL +æ•™ç¨‹ -åŸºç¡€'</span> <span class="kwd">IN</span> BOOLEAN MODE);

<span class="com">-- æŸ¥è¯¢æ‰©å±•æ¨¡å¼</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> articles
<span class="kwd">WHERE</span> <span class="func">MATCH</span>(content) <span class="func">AGAINST</span>(<span class="str">'MySQL'</span> <span class="kwd">WITH</span> <span class="kwd">QUERY</span> EXPANSION);

<span class="com">-- ä¸­æ–‡åˆ†è¯æ”¯æŒ</span>
<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> articles (
    id <span class="kwd">INT</span> <span class="kwd">AUTO_INCREMENT</span> <span class="kwd">PRIMARY KEY</span>,
    content <span class="type">TEXT</span>,
    <span class="kwd">FULLTEXT</span> <span class="kwd">INDEX</span> ft_content (content) <span class="kwd">WITH</span> PARSER ngram
);</code></pre>
                </div>

                <h5>1.2.5 ç©ºé—´ç´¢å¼•ï¼ˆSPATIALï¼‰</h5>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- ç©ºé—´ç´¢å¼•ï¼ˆç”¨äºåœ°ç†æ•°æ®ï¼‰</span>
<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> locations (
    id <span class="kwd">INT</span> <span class="kwd">AUTO_INCREMENT</span> <span class="kwd">PRIMARY KEY</span>,
    name <span class="type">VARCHAR</span>(<span class="num">100</span>),
    location GEOMETRY <span class="kwd"><span class="kwd">NOT</span> NULL</span>,
    <span class="kwd">SPATIAL</span> <span class="kwd">INDEX</span> idx_location (location)
);

<span class="com">-- æ’å…¥ç©ºé—´æ•°æ®</span>
<span class="kwd">INSERT</span> <span class="kwd">INTO</span> locations (name, location) <span class="kwd">VALUES</span>
(<span class="str">'Beijing'</span>, <span class="func">ST_GeomFromText</span>(<span class="str">'<span class="type">POINT</span>(<span class="num">116</span>.<span class="num">4074</span> <span class="num">39</span>.<span class="num">9042</span>)'</span>)),
(<span class="str">'Shanghai'</span>, <span class="func">ST_GeomFromText</span>(<span class="str">'<span class="type">POINT</span>(<span class="num">121</span>.<span class="num">4737</span> <span class="num">31</span>.<span class="num">2304</span>)'</span>));

<span class="com">-- ç©ºé—´æŸ¥è¯¢</span>
<span class="kwd">SELECT</span> name, <span class="func">ST_AsText</span>(location) <span class="kwd">as</span> coordinates
<span class="kwd">FROM</span> locations
<span class="kwd">WHERE</span> <span class="func">ST_Distance_Sphere</span>(
    location,
    <span class="func">ST_GeomFromText</span>(<span class="str">'<span class="type">POINT</span>(<span class="num">116</span>.<span class="num">4074</span> <span class="num">39</span>.<span class="num">9042</span>)'</span>)
) < <span class="num">50000</span>; <span class="com">-- 50å…¬é‡ŒèŒƒå›´å†…</span></code></pre>
                </div>

                <h5>1.2.6 å‰ç¼€ç´¢å¼•</h5>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- å‰ç¼€ç´¢å¼•ï¼ˆèŠ‚çœç©ºé—´ï¼Œé€‚ç”¨äºé•¿å­—ç¬¦ä¸²ï¼‰</span>
<span class="kwd">CREATE</span> <span class="kwd">INDEX</span> idx_email_prefix <span class="kwd">ON</span> users(email(<span class="num">20</span>));

<span class="com">-- æŸ¥çœ‹å‰ç¼€é•¿åº¦å»ºè®®</span>
<span class="kwd">SELECT</span>
    <span class="func">COUNT</span>(<span class="kwd">DISTINCT</span> LEFT(email, <span class="num">10</span>)) <span class="kwd">as</span> distinct_10,
    <span class="func">COUNT</span>(<span class="kwd">DISTINCT</span> LEFT(email, <span class="num">20</span>)) <span class="kwd">as</span> distinct_20,
    <span class="func">COUNT</span>(<span class="kwd">DISTINCT</span> LEFT(email, <span class="num">30</span>)) <span class="kwd">as</span> distinct_30
<span class="kwd">FROM</span> users;

<span class="com">-- åˆ›å»ºåˆé€‚é•¿åº¦çš„å‰ç¼€ç´¢å¼•</span>
<span class="kwd">CREATE</span> <span class="kwd">INDEX</span> idx_title_prefix <span class="kwd">ON</span> articles(title(<span class="num">50</span>));</code></pre>
                </div>

                <h5>1.2.7 å‡½æ•°ç´¢å¼•</h5>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- å‡½æ•°ç´¢å¼•ï¼ˆå¯¹è¡¨è¾¾å¼å»ºç«‹ç´¢å¼•ï¼‰</span>
<span class="kwd">CREATE</span> <span class="kwd">INDEX</span> idx_email_lower <span class="kwd">ON</span> users((<span class="func">LOWER</span>(email)));

<span class="com">-- ä½¿ç”¨å‡½æ•°ç´¢å¼•çš„æŸ¥è¯¢</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> users <span class="kwd">WHERE</span> <span class="func">LOWER</span>(email) = <span class="str">'test@example.com'</span>;

<span class="com">-- è®¡ç®—åˆ—ç´¢å¼•</span>
<span class="kwd">ALTER</span> <span class="kwd">TABLE</span> products ADD COLUMN discounted_price <span class="type">DECIMAL</span>(<span class="num">10</span>,<span class="num">2</span>);
<span class="kwd">CREATE</span> <span class="kwd">INDEX</span> idx_discounted_price <span class="kwd">ON</span> products((price * discount_rate));

<span class="com">-- <span class="kwd">JSON</span> åˆ—ç´¢å¼•</span>
<span class="kwd">CREATE</span> <span class="kwd">INDEX</span> idx_user_prefs <span class="kwd">ON</span> users((<span class="func">JSON_EXTRACT</span>(preferences, <span class="str">'$.language'</span>)));
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> users
<span class="kwd">WHERE</span> <span class="func">JSON_EXTRACT</span>(preferences, <span class="str">'$.language'</span>) = <span class="str">'zh-CN'</span>;
                </div>
                </details>

                <h4>1.3 ç´¢å¼•è®¾è®¡åŸåˆ™</h4>

                <h5>1.3.1 é€‰æ‹©åˆé€‚çš„åˆ—å»ºç«‹ç´¢å¼•</h5>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- å»ºè®®ç´¢å¼•çš„åˆ—ç±»å‹ï¼š</span>
<span class="com">-- <span class="num">1</span>. ç»å¸¸åœ¨ <span class="kwd">WHERE</span> æ¡ä»¶ä¸­ä½¿ç”¨çš„åˆ—</span>
<span class="kwd">CREATE</span> <span class="kwd">INDEX</span> idx_status <span class="kwd">ON</span> orders(<span class="kwd">status</span>);

<span class="com">-- <span class="num">2</span>. ç»å¸¸åœ¨ JOIN æ¡ä»¶ä¸­ä½¿ç”¨çš„åˆ—</span>
<span class="kwd">CREATE</span> <span class="kwd">INDEX</span> idx_user_id <span class="kwd">ON</span> orders(user_id);

<span class="com">-- <span class="num">3</span>. ç»å¸¸åœ¨ <span class="kwd">ORDER BY</span> ä¸­ä½¿ç”¨çš„åˆ—</span>
<span class="kwd">CREATE</span> <span class="kwd">INDEX</span> idx_created_at <span class="kwd">ON</span> posts(created_at);

<span class="com">-- <span class="num">4</span>. ç»å¸¸åœ¨ <span class="kwd">GROUP BY</span> ä¸­ä½¿ç”¨çš„åˆ—</span>
<span class="kwd">CREATE</span> <span class="kwd">INDEX</span> idx_category <span class="kwd">ON</span> posts(category_id);

<span class="com">-- <span class="num">5</span>. å”¯ä¸€æ€§é«˜çš„åˆ—</span>
<span class="kwd">CREATE</span> <span class="kwd">UNIQUE</span> <span class="kwd">INDEX</span> idx_username <span class="kwd">ON</span> users(username);</code></pre>
                </div>

                <h5>1.3.2 å¤åˆç´¢å¼•çš„åˆ—é¡ºåº</h5>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- å¤åˆç´¢å¼•è®¾è®¡åŸåˆ™ï¼š</span>
<span class="com">-- <span class="num">1</span>. å°†é€‰æ‹©æ€§é«˜çš„åˆ—æ”¾åœ¨å‰é¢</span>
<span class="kwd">CREATE</span> <span class="kwd">INDEX</span> idx_status_created <span class="kwd">ON</span> orders(<span class="kwd">status</span>, created_at);

<span class="com">-- <span class="num">2</span>. è€ƒè™‘æŸ¥è¯¢çš„åˆ—é¡ºåº</span>
<span class="com">-- å¸¸è§æŸ¥è¯¢ï¼š<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> orders <span class="kwd">WHERE</span> user_id = ? <span class="kwd">AND</span> <span class="kwd">status</span> = ?</span>
<span class="kwd">CREATE</span> <span class="kwd">INDEX</span> idx_user_status <span class="kwd">ON</span> orders(user_id, <span class="kwd">status</span>);

<span class="com">-- <span class="num">3</span>. æœ€å·¦å‰ç¼€åŸåˆ™</span>
<span class="com">-- ç´¢å¼• (user_id, <span class="kwd">status</span>, created_at)</span>
<span class="com">-- å¯ä»¥ä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢ï¼š</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> orders <span class="kwd">WHERE</span> user_id = <span class="num">1</span>;
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> orders <span class="kwd">WHERE</span> user_id = <span class="num">1</span> <span class="kwd">AND</span> <span class="kwd">status</span> = <span class="str">'pending'</span>;
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> orders <span class="kwd">WHERE</span> user_id = <span class="num">1</span> <span class="kwd">AND</span> <span class="kwd">status</span> = <span class="str">'pending'</span> <span class="kwd">AND</span> created_at > <span class="str">'<span class="num">2024</span>-<span class="num">01</span>-<span class="num">01</span>'</span>;

<span class="com">-- ä¸å¯ä»¥ä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢ï¼š</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> orders <span class="kwd">WHERE</span> <span class="kwd">status</span> = <span class="str">'pending'</span>; <span class="com">-- è·³è¿‡æœ€å·¦åˆ—</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> orders <span class="kwd">WHERE</span> created_at > <span class="str">'<span class="num">2024</span>-<span class="num">01</span>-<span class="num">01</span>'</span>; <span class="com">-- è·³è¿‡å‰ä¸¤åˆ—</span></code></pre>
                </div>

                <h5>1.3.3 è¦†ç›–ç´¢å¼•</h5>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- è¦†ç›–ç´¢å¼•ï¼ˆç´¢å¼•åŒ…å«æŸ¥è¯¢æ‰€éœ€çš„æ‰€æœ‰åˆ—ï¼‰</span>
<span class="com">-- ç´¢å¼•åŒ…å«ï¼šuser_id, <span class="kwd">status</span>, total_amount</span>
<span class="kwd">CREATE</span> <span class="kwd">INDEX</span> idx_user_status_amount <span class="kwd">ON</span> orders(user_id, <span class="kwd">status</span>, total_amount);

<span class="com">-- æŸ¥è¯¢åªä½¿ç”¨ç´¢å¼•ï¼Œä¸éœ€è¦å›è¡¨</span>
<span class="kwd">SELECT</span> user_id, <span class="kwd">status</span>, total_amount
<span class="kwd">FROM</span> orders
<span class="kwd">WHERE</span> user_id = <span class="num">1</span> <span class="kwd">AND</span> <span class="kwd">status</span> = <span class="str">'completed'</span>;

<span class="com">-- ä½¿ç”¨ <span class="kwd">EXPLAIN</span> éªŒè¯æ˜¯å¦ä½¿ç”¨è¦†ç›–ç´¢å¼•</span>
<span class="kwd">EXPLAIN</span> <span class="kwd">SELECT</span> user_id, <span class="kwd">status</span>, total_amount
<span class="kwd">FROM</span> orders <span class="kwd">WHERE</span> user_id = <span class="num">1</span> <span class="kwd">AND</span> <span class="kwd">status</span> = <span class="str">'completed'</span>;

<span class="com">-- Extra å­—æ®µæ˜¾ç¤º "Using index" è¡¨ç¤ºä½¿ç”¨äº†è¦†ç›–ç´¢å¼•</span></code></pre>
                </div>

                <h4>1.4 ç´¢å¼•ç®¡ç†</h4>

                <h5>1.4.1 æŸ¥çœ‹ç´¢å¼•ä¿¡æ¯</h5>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- æŸ¥çœ‹è¡¨çš„æ‰€æœ‰ç´¢å¼•</span>
<span class="kwd">SHOW</span> <span class="kwd">INDEX</span> <span class="kwd">FROM</span> users;

<span class="com">-- æŸ¥çœ‹ç´¢å¼•çš„ç»Ÿè®¡ä¿¡æ¯</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> mysql.innodb_index_stats
<span class="kwd">WHERE</span> database_name = <span class="kwd">DATABASE</span>() <span class="kwd">AND</span> table_name = <span class="str">'users'</span>;

<span class="com">-- æŸ¥çœ‹ç´¢å¼•ä½¿ç”¨æƒ…å†µ</span>
<span class="kwd">SELECT</span>
    table_name,
    index_name,
    cardinality,
    nullable,
    index_type
<span class="kwd">FROM</span> information_schema.statistics
<span class="kwd">WHERE</span> table_schema = <span class="kwd">DATABASE</span>()
<span class="kwd">ORDER BY</span> table_name, index_name;

<span class="com">-- æŸ¥çœ‹æœªä½¿ç”¨çš„ç´¢å¼•</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> sys.schema_unused_indexes
<span class="kwd">WHERE</span> object_schema = <span class="kwd">DATABASE</span>();</code></pre>
                </div>

                <h5>1.4.2 ç´¢å¼•ç»´æŠ¤</h5>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- åˆ†æè¡¨ï¼ˆæ›´æ–°ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯ï¼‰</span>
<span class="kwd">ANALYZE</span> <span class="kwd">TABLE</span> users;

<span class="com">-- ä¼˜åŒ–è¡¨ï¼ˆé‡å»ºè¡¨å’Œç´¢å¼•ï¼‰</span>
<span class="kwd">OPTIMIZE</span> <span class="kwd">TABLE</span> users;

<span class="com">-- é‡å»ºç´¢å¼•</span>
<span class="kwd">ALTER</span> <span class="kwd">TABLE</span> users ENGINE=InnoDB;

<span class="com">-- æ¸…ç†ç¢ç‰‡</span>
<span class="kwd">ALTER</span> <span class="kwd">TABLE</span> users ENGINE=InnoDB;

<span class="com">-- ç¦ç”¨ç´¢å¼•ï¼ˆæ‰¹é‡å¯¼å…¥æ—¶æå‡æ€§èƒ½ï¼‰</span>
<span class="kwd">ALTER</span> <span class="kwd">TABLE</span> users <span class="kwd">DISABLE</span> KEYS;
<span class="com">-- æ‰¹é‡æ’å…¥æ•°æ®</span>
<span class="kwd">ALTER</span> <span class="kwd">TABLE</span> users <span class="kwd">ENABLE</span> KEYS;</code></pre>
                </div>

                <h5>1.4.3 ç´¢å¼•åˆ é™¤</h5>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- åˆ é™¤ç´¢å¼•</span>
<span class="kwd">DROP</span> <span class="kwd">INDEX</span> idx_username <span class="kwd">ON</span> users;

<span class="com">-- åˆ é™¤ä¸»é”®ï¼ˆå¦‚æœæœ‰è‡ªå¢åˆ—éœ€è¦å…ˆåˆ é™¤ï¼‰</span>
<span class="kwd">ALTER</span> <span class="kwd">TABLE</span> users <span class="kwd">DROP</span> PRIMARY KEY;

<span class="com">-- åˆ é™¤å¤šä¸ªç´¢å¼•</span>
<span class="kwd">ALTER</span> <span class="kwd">TABLE</span> users
    <span class="kwd">DROP</span> <span class="kwd">INDEX</span> idx_email,
    <span class="kwd">DROP</span> <span class="kwd">INDEX</span> idx_age;</code></pre>
                </div>

                <h4>1.5 AI æ™ºèƒ½ç´¢å¼•ä¼˜åŒ–</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- <span class="kwd">AI</span> è‡ªåŠ¨ç´¢å¼•æ¨è</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> sys.ai_index_recommendations
<span class="kwd">WHERE</span> table_name = <span class="str">'users'</span>
<span class="kwd">ORDER BY</span> potential_improvement DESC;

<span class="com">-- åº”ç”¨ <span class="kwd">AI</span> æ¨èçš„ç´¢å¼•</span>
<span class="kwd">CALL</span> sys.apply_ai_index_recommendations(<span class="str">'users'</span>);

<span class="com">-- æŸ¥çœ‹ <span class="kwd">AI</span> ä¼˜åŒ–å»ºè®®è¯¦æƒ…</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> sys.ai_query_analysis
<span class="kwd">WHERE</span> query_time > <span class="func">NOW</span>() - INTERVAL <span class="num">1</span> DAY;

<span class="com">-- <span class="kwd">AI</span> å®æ—¶ç›‘æ§ç´¢å¼•æ•ˆæœ</span>
<span class="kwd">SELECT</span>
    index_name,
    used_count,
    avg_access_time,
    improvement_percentage
<span class="kwd">FROM</span> sys.ai_index_performance_monitor
<span class="kwd">WHERE</span> table_name = <span class="str">'users'</span>;</code></pre>
                </div>

                <h4>1.6 ç´¢å¼•æ€§èƒ½ä¼˜åŒ–æŠ€å·§</h4>

                <h5>1.6.1 éšè—ç´¢å¼•ï¼ˆæµ‹è¯•æ€§èƒ½ï¼‰</h5>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- åˆ›å»ºéšè—ç´¢å¼•ï¼ˆä¸å®é™…ä½¿ç”¨ï¼Œç”¨äºæµ‹è¯•ï¼‰</span>
<span class="kwd">CREATE</span> <span class="kwd">INDEX</span> idx_test <span class="kwd">ON</span> users(username) INVISIBLE;

<span class="com">-- å°†å·²æœ‰ç´¢å¼•è®¾ä¸ºéšè—</span>
<span class="kwd">ALTER</span> <span class="kwd">TABLE</span> users <span class="kwd">ALTER</span> <span class="kwd">INDEX</span> idx_username INVISIBLE;

<span class="com">-- æ˜¾ç¤ºéšè—ç´¢å¼•</span>
<span class="kwd">ALTER</span> <span class="kwd">TABLE</span> users <span class="kwd">ALTER</span> <span class="kwd">INDEX</span> idx_username VISIBLE;

<span class="com">-- æŸ¥çœ‹éšè—ç´¢å¼•</span>
<span class="kwd">SELECT</span> index_name, is_visible
<span class="kwd">FROM</span> information_schema.statistics
<span class="kwd">WHERE</span> table_schema = <span class="kwd">DATABASE</span>() <span class="kwd">AND</span> table_name = <span class="str">'users'</span> <span class="kwd">AND</span> is_visible = <span class="str">'NO'</span>;</code></pre>
                </div>

                <h5>1.6.2 ç´¢å¼•æç¤º</h5>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- å¼ºåˆ¶ä½¿ç”¨æŒ‡å®šç´¢å¼•</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> users <span class="kwd">USE</span> <span class="kwd">INDEX</span> (idx_username) <span class="kwd">WHERE</span> username = <span class="str">'test'</span>;

<span class="com">-- å¼ºåˆ¶ä¸ä½¿ç”¨ç´¢å¼•ï¼ˆå…¨è¡¨æ‰«æï¼‰</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> users IGNORE <span class="kwd">INDEX</span> (idx_username) <span class="kwd">WHERE</span> username = <span class="str">'test'</span>;

<span class="com">-- æŒ‡å®šå¤šä¸ªç´¢å¼•</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> users <span class="kwd">USE</span> <span class="kwd">INDEX</span> (idx_username, idx_email)
<span class="kwd">WHERE</span> username = <span class="str">'test'</span> <span class="kwd">OR</span> email = <span class="str">'test@example.com'</span>;</code></pre>
                </div>

                <h5>1.6.3 ç´¢å¼•ä¸‹æ¨ä¼˜åŒ–</h5>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- MySQL <span class="num">8</span>.<span class="num">0</span>+ æ”¯æŒç´¢å¼•ä¸‹æ¨</span>
<span class="com">-- å¯¹äºå¤åˆç´¢å¼•ï¼Œæ¡ä»¶è¿‡æ»¤åœ¨å­˜å‚¨å¼•æ“å±‚å®Œæˆ</span>
<span class="com">-- ç¤ºä¾‹ï¼šç´¢å¼• (name, age)</span>
<span class="com">-- æŸ¥è¯¢ï¼š<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> users <span class="kwd">WHERE</span> name = <span class="str">'test'</span> <span class="kwd">AND</span> age > <span class="num">25</span></span>
<span class="com">-- MySQL ä¼šå…ˆåœ¨ç´¢å¼•ä¸­è¿‡æ»¤ age > <span class="num">25</span>ï¼Œå‡å°‘å›è¡¨æ¬¡æ•°</span>

<span class="com">-- æŸ¥çœ‹æ˜¯å¦ä½¿ç”¨äº†ç´¢å¼•ä¸‹æ¨</span>
<span class="kwd">EXPLAIN</span> <span class="kwd">SELECT</span> * <span class="kwd">FROM</span> users
<span class="kwd">WHERE</span> name = <span class="str">'test'</span> <span class="kwd">AND</span> age > <span class="num">25</span>;
<span class="com">-- Extra å­—æ®µæ˜¾ç¤º "Using <span class="kwd">index</span> condition" è¡¨ç¤ºä½¿ç”¨äº†ç´¢å¼•ä¸‹æ¨</span></code></pre>
                </div>

                <h4>1.7 ç´¢å¼•æœ€ä½³å®è·µ</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- æœ€ä½³å®è·µæ€»ç»“ï¼š</span>

<span class="com">-- <span class="num">1</span>. ä¸º WHEREã€JOINã€ORDER BYã€<span class="kwd">GROUP BY</span> ä¸­çš„åˆ—åˆ›å»ºç´¢å¼•</span>
<span class="kwd">CREATE</span> <span class="kwd">INDEX</span> idx_user_status <span class="kwd">ON</span> orders(user_id, <span class="kwd">status</span>);

<span class="com">-- <span class="num">2</span>. é¿å…åœ¨åŒºåˆ†åº¦ä½çš„åˆ—ä¸Šåˆ›å»ºç´¢å¼•ï¼ˆå¦‚æ€§åˆ«ã€å¸ƒå°”å€¼ï¼‰</span>
<span class="com">-- ä¸æ¨èï¼š<span class="kwd">CREATE</span> <span class="kwd">INDEX</span> idx_gender <span class="kwd">ON</span> users(gender);</span>

<span class="com">-- <span class="num">3</span>. ä¸è¦è¿‡åº¦ç´¢å¼•ï¼ˆç´¢å¼•ä¼šå ç”¨ç©ºé—´å¹¶é™ä½å†™å…¥æ€§èƒ½ï¼‰</span>
<span class="com">-- å®šæœŸæ£€æŸ¥æœªä½¿ç”¨çš„ç´¢å¼•å¹¶åˆ é™¤</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> sys.schema_unused_indexes;

<span class="com">-- <span class="num">4</span>. ä½¿ç”¨ <span class="kwd">EXPLAIN</span> åˆ†ææŸ¥è¯¢è®¡åˆ’</span>
<span class="kwd">EXPLAIN</span> <span class="kwd">SELECT</span> * <span class="kwd">FROM</span> users <span class="kwd">WHERE</span> age > <span class="num">25</span>;

<span class="com">-- <span class="num">5</span>. å®šæœŸç»´æŠ¤ç´¢å¼•</span>
<span class="kwd">ANALYZE</span> <span class="kwd">TABLE</span> users; <span class="com">-- æ›´æ–°ç»Ÿè®¡ä¿¡æ¯</span>
<span class="kwd">OPTIMIZE</span> <span class="kwd">TABLE</span> users; <span class="com">-- é‡å»ºè¡¨å’Œç´¢å¼•</span>

<span class="com">-- <span class="num">6</span>. ä½¿ç”¨è¦†ç›–ç´¢å¼•å‡å°‘å›è¡¨</span>
<span class="kwd">CREATE</span> <span class="kwd">INDEX</span> idx_covering <span class="kwd">ON</span> orders(user_id, <span class="kwd">status</span>, total_amount);

<span class="com">-- <span class="num">7</span>. åˆç†ä½¿ç”¨å¤åˆç´¢å¼•ï¼Œéµå¾ªæœ€å·¦å‰ç¼€åŸåˆ™</span>
<span class="kwd">CREATE</span> <span class="kwd">INDEX</span> idx_user_created <span class="kwd">ON</span> orders(user_id, created_at);

<span class="com">-- <span class="num">8</span>. å¤§è¡¨åˆ é™¤å’Œæ›´æ–°æ—¶è€ƒè™‘ç´¢å¼•å½±å“</span>
<span class="com">-- å¯ä»¥å…ˆç¦ç”¨ç´¢å¼•ï¼Œæ“ä½œå®Œæˆåå†å¯ç”¨</span>
<span class="kwd">ALTER</span> <span class="kwd">TABLE</span> large_table <span class="kwd">DISABLE</span> KEYS;
<span class="com">-- æ‰§è¡Œæ‰¹é‡æ“ä½œ</span>
<span class="kwd">ALTER</span> <span class="kwd">TABLE</span> large_table <span class="kwd">ENABLE</span> KEYS;

<span class="com">-- <span class="num">9</span>. åˆ©ç”¨ <span class="kwd">AI</span> æ™ºèƒ½æ¨è</span>
<span class="kwd">CALL</span> sys.recommend_indexes(<span class="str">'your_database'</span>);

<span class="com">-- <span class="num">10</span>. ç›‘æ§ç´¢å¼•æ€§èƒ½ï¼ŒåŠæ—¶è°ƒæ•´</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> sys.schema_index_statistics
<span class="kwd">WHERE</span> table_schema = <span class="kwd">DATABASE</span>();</code></pre>
                </div>

                <h4>1.8 ç´¢å¼•å¸¸è§é—®é¢˜</h4>

                <h5>1.8.1 ç´¢å¼•å¤±æ•ˆçš„åœºæ™¯</h5>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- ç´¢å¼•å¤±æ•ˆçš„å¸¸è§åœºæ™¯ï¼š</span>

<span class="com">-- <span class="num">1</span>. ä½¿ç”¨å‡½æ•°æˆ–è¡¨è¾¾å¼</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> users <span class="kwd">WHERE</span> <span class="func">LOWER</span>(username) = <span class="str">'test'</span>; <span class="com">-- username ç´¢å¼•å¤±æ•ˆ</span>
<span class="com">-- è§£å†³ï¼šåˆ›å»ºå‡½æ•°ç´¢å¼•</span>
<span class="kwd">CREATE</span> <span class="kwd">INDEX</span> idx_username_lower <span class="kwd">ON</span> users((<span class="func">LOWER</span>(username)));

<span class="com">-- <span class="num">2</span>. ç±»å‹ä¸åŒ¹é…</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> users <span class="kwd">WHERE</span> id = <span class="str">'<span class="num">1</span>'</span>; <span class="com">-- id æ˜¯æ•°å­—ç±»å‹ï¼Œå­—ç¬¦ä¸²å¯¼è‡´ç´¢å¼•å¤±æ•ˆ</span>
<span class="com">-- è§£å†³ï¼šä¿æŒç±»å‹ä¸€è‡´</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> users <span class="kwd">WHERE</span> id = <span class="num">1</span>;

<span class="com">-- <span class="num">3</span>. <span class="kwd">LIKE</span> æŸ¥è¯¢ä»¥é€šé…ç¬¦å¼€å¤´</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> users <span class="kwd">WHERE</span> username <span class="kwd">LIKE</span> <span class="str">'%test%'</span>; <span class="com">-- ç´¢å¼•å¤±æ•ˆ</span>
<span class="com">-- è§£å†³ï¼šä½¿ç”¨å…¨æ–‡ç´¢å¼•æˆ–é¿å…å‰å¯¼é€šé…ç¬¦</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> users <span class="kwd">WHERE</span> username <span class="kwd">LIKE</span> <span class="str">'test%'</span>; <span class="com">-- ç´¢å¼•æœ‰æ•ˆ</span>

<span class="com">-- <span class="num">4</span>. <span class="kwd">OR</span> æ¡ä»¶</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> users <span class="kwd">WHERE</span> username = <span class="str">'test'</span> <span class="kwd">OR</span> email = <span class="str">'test@example.com'</span>;
<span class="com">-- å¦‚æœä¸¤ä¸ªå­—æ®µéƒ½æœ‰ç´¢å¼•ï¼Œä¼šåˆ†åˆ«ä½¿ç”¨ï¼Œä½†æ•ˆç‡å¯èƒ½ä¸å¦‚ UNION</span>
<span class="com">-- è§£å†³ï¼šä½¿ç”¨ <span class="kwd">UNION</span> ALL</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> users <span class="kwd">WHERE</span> username = <span class="str">'test'</span>
<span class="kwd">UNION</span> <span class="kwd">ALL</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> users <span class="kwd">WHERE</span> email = <span class="str">'test@example.com'</span>;

<span class="com">-- <span class="num">5</span>. <span class="kwd">NOT</span> <span class="kwd">IN</span>, <span class="kwd">NOT</span> <span class="kwd">EXISTS</span>, <></span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> users <span class="kwd">WHERE</span> username <> <span class="str">'test'</span>; <span class="com">-- ç´¢å¼•å¯èƒ½å¤±æ•ˆ</span>

<span class="com">-- <span class="num">6</span>. æŸ¥è¯¢æ¡ä»¶ä¸­åŒ…å« NULL</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> users <span class="kwd">WHERE</span> username <span class="kwd">IS</span> NULL; <span class="com">-- å¦‚æœ username æœ‰ç´¢å¼•ï¼Œå¯ä»¥å‘½ä¸­</span></code></pre>
                </div>

                <h5>1.8.2 ç´¢å¼•ç¢ç‰‡é—®é¢˜</h5>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- æ£€æµ‹ç´¢å¼•ç¢ç‰‡</span>
<span class="kwd">SELECT</span>
    table_name,
    <span class="kwd">engine</span>,
    ROUND(data_length / <span class="num">1024</span> / <span class="num">1024</span>, <span class="num">2</span>) <span class="kwd">as</span> data_mb,
    ROUND(index_length / <span class="num">1024</span> / <span class="num">1024</span>, <span class="num">2</span>) <span class="kwd">as</span> index_mb,
    ROUND(data_free / <span class="num">1024</span> / <span class="num">1024</span>, <span class="num">2</span>) <span class="kwd">as</span> free_mb
<span class="kwd">FROM</span> information_schema.<span class="kwd">tables</span>
<span class="kwd">WHERE</span> table_schema = <span class="kwd">DATABASE</span>()
<span class="kwd">ORDER BY</span> data_free DESC;

<span class="com">-- é‡å»ºç´¢å¼•å’Œè¡¨ï¼ˆæ¶ˆé™¤ç¢ç‰‡ï¼‰</span>
<span class="kwd">OPTIMIZE</span> <span class="kwd">TABLE</span> users;

<span class="com">-- æˆ–è€…é‡å»ºè¡¨</span>
<span class="kwd">ALTER</span> <span class="kwd">TABLE</span> users ENGINE=InnoDB;

<span class="com">-- å¯¹äºå¤§è¡¨ï¼Œå¯ä»¥ä½¿ç”¨ pt-online-schema-change åœ¨çº¿é‡å»º</span>
<span class="com">-- pt-online-schema-change --<span class="kwd">alter</span> "ENGINE=InnoDB" D=your_database,t=users --execute</span></code></pre>
                </div>

                <h3>2. äº‹åŠ¡å¤„ç†ï¼ˆæ”¯æŒåˆ†å¸ƒå¼äº‹åŠ¡ï¼‰</h3>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- å¼€å§‹äº‹åŠ¡</span>
START TRANSACTION;

<span class="com">-- æ‰§è¡Œ SQL è¯­å¥</span>
<span class="kwd">UPDATE</span> accounts <span class="kwd">SET</span> balance = balance - <span class="num">100</span> <span class="kwd">WHERE</span> id = <span class="num">1</span>;
<span class="kwd">UPDATE</span> accounts <span class="kwd">SET</span> balance = balance + <span class="num">100</span> <span class="kwd">WHERE</span> id = <span class="num">2</span>;

<span class="com">-- æäº¤äº‹åŠ¡ï¼ˆè‡ªåŠ¨ä½¿ç”¨ 2PCï¼‰</span>
COMMIT;

<span class="com">-- æˆ–å›æ»šäº‹åŠ¡</span>
ROLLBACK;

<span class="com">-- ä¿å­˜ç‚¹</span>
SAVEPOINT sp1;
<span class="kwd">UPDATE</span> accounts <span class="kwd">SET</span> balance = balance - <span class="num">50</span> <span class="kwd">WHERE</span> id = <span class="num">1</span>;
<span class="com">-- å›æ»šåˆ°ä¿å­˜ç‚¹</span>
<span class="kwd">ROLLBACK</span> TO sp1;

<span class="com">-- åˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆXA äº‹åŠ¡æ”¹è¿›ï¼‰</span>
XA START <span class="str">'xid1'</span>;
<span class="kwd">UPDATE</span> accounts <span class="kwd">SET</span> balance = balance - <span class="num">100</span> <span class="kwd">WHERE</span> id = <span class="num">1</span>;
XA <span class="kwd">END</span> <span class="str">'xid1'</span>;
XA PREPARE <span class="str">'xid1'</span>;
XA <span class="kwd">COMMIT</span> <span class="str">'xid1'</span>;</code></pre>
                </div>

                <h3>3. è§†å›¾ï¼ˆç‰©åŒ–è§†å›¾ï¼‰</h3>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- åˆ›å»ºæ™®é€šè§†å›¾</span>
<span class="kwd">CREATE</span> <span class="kwd">VIEW</span> user_summary <span class="kwd">AS</span>
<span class="kwd">SELECT</span>
    username,
    email,
    <span class="func">TIMESTAMPDIFF</span>(<span class="type">YEAR</span>, created_at, <span class="func">NOW</span>()) <span class="kwd">as</span> years_active
<span class="kwd">FROM</span> users;

<span class="com">-- åˆ›å»ºç‰©åŒ–è§†å›¾ï¼ˆMySQL <span class="num">9</span>.x æ–°å¢ï¼‰</span>
<span class="kwd">CREATE</span> <span class="kwd">MATERIALIZED</span> <span class="kwd">VIEW</span> mv_user_stats
<span class="kwd">REFRESH</span> <span class="kwd">EVERY</span> <span class="num">1</span> <span class="kwd">HOUR</span>
<span class="kwd">AS</span>
<span class="kwd">SELECT</span>
    <span class="func">COUNT</span>(*) <span class="kwd">as</span> total_users,
    <span class="func">AVG</span>(age) <span class="kwd">as</span> avg_age,
    <span class="func">MAX</span>(created_at) <span class="kwd">as</span> last_signup
<span class="kwd">FROM</span> users;

<span class="com">-- æ‰‹åŠ¨åˆ·æ–°ç‰©åŒ–è§†å›¾</span>
<span class="kwd">REFRESH</span> <span class="kwd">MATERIALIZED</span> <span class="kwd">VIEW</span> mv_user_stats;

<span class="com">-- ä½¿ç”¨è§†å›¾</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> user_summary;
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> mv_user_stats;

<span class="com">-- åˆ é™¤è§†å›¾</span>
<span class="kwd">DROP</span> <span class="kwd">VIEW</span> user_summary;
<span class="kwd">DROP</span> <span class="kwd">MATERIALIZED</span> <span class="kwd">VIEW</span> mv_user_stats;</code></pre>
                </div>

                <h3>4. å­˜å‚¨è¿‡ç¨‹ï¼ˆæ”¯æŒ JavaScriptï¼‰</h3>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- ä¼ ç»Ÿå­˜å‚¨è¿‡ç¨‹</span>
<span class="kwd">DELIMITER</span> //
<span class="kwd">CREATE</span> <span class="kwd">PROCEDURE</span> get_users_by_age(<span class="kwd">IN</span> min_age <span class="kwd">INT</span>)
<span class="kwd">BEGIN</span>
    <span class="kwd">SELECT</span> * <span class="kwd">FROM</span> users <span class="kwd">WHERE</span> age >= min_age;
<span class="kwd">END</span> //
<span class="kwd">DELIMITER</span> ;

<span class="com">-- <span class="kwd">JavaScript</span> å­˜å‚¨è¿‡ç¨‹ï¼ˆMySQL <span class="num">9</span>.x æ–°å¢ï¼‰</span>
<span class="kwd">DELIMITER</span> //
<span class="kwd">CREATE</span> <span class="kwd">PROCEDURE</span> analyze_user_data()
<span class="kwd">LANGUAGE</span> <span class="kwd">JAVASCRIPT</span> <span class="kwd">AS</span>
$$
    const result = session.sql(<span class="str">'<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> users'</span>).execute();
    const analysis = {
        total: result.length,
        avg_age: result.reduce((sum, row) => sum + row.age, <span class="num">0</span>) / result.length
    };
    <span class="kwd">return</span> JSON.stringify(analysis);
$$ //
<span class="kwd">DELIMITER</span> ;

<span class="com">-- è°ƒç”¨å­˜å‚¨è¿‡ç¨‹</span>
<span class="kwd">CALL</span> get_users_by_age(<span class="num">25</span>);
<span class="kwd">CALL</span> analyze_user_data();

<span class="com">-- åˆ é™¤å­˜å‚¨è¿‡ç¨‹</span>
<span class="kwd">DROP</span> <span class="kwd">PROCEDURE</span> get_users_by_age;
<span class="kwd">DROP</span> <span class="kwd">PROCEDURE</span> analyze_user_data;</code></pre>
                </div>

                <h3>5. è§¦å‘å™¨ï¼ˆæ”¯æŒæ‰¹é‡æ“ä½œï¼‰</h3>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- åˆ›å»ºè§¦å‘å™¨</span>
<span class="kwd">DELIMITER</span> //
<span class="kwd">CREATE</span> <span class="kwd">TRIGGER</span> before_user_insert
<span class="kwd">BEFORE</span> <span class="kwd">INSERT</span> <span class="kwd">ON</span> users
<span class="kwd">FOR EACH ROW</span>
<span class="kwd">BEGIN</span>
    <span class="kwd">IF</span> NEW.age < <span class="num">0</span> <span class="kwd">THEN</span>
        <span class="kwd">SET</span> NEW.age = <span class="num">0</span>;
    <span class="kwd">END</span> IF;
    <span class="kwd">IF</span> NEW.email <span class="kwd">IS</span> <span class="kwd">NULL</span> <span class="kwd">THEN</span>
        SIGNAL SQLSTATE <span class="str">'<span class="num">45000</span>'</span> <span class="kwd">SET</span> MESSAGE_TEXT = <span class="str">'Email ä¸èƒ½ä¸ºç©º'</span>;
    <span class="kwd">END</span> IF;
<span class="kwd">END</span> //
<span class="kwd">DELIMITER</span> ;

<span class="com">-- æ‰¹é‡æ“ä½œè§¦å‘å™¨ï¼ˆFOR EACH STATEMENTï¼‰</span>
<span class="kwd">DELIMITER</span> //
<span class="kwd">CREATE</span> <span class="kwd">TRIGGER</span> log_bulk_operation
<span class="kwd">AFTER</span> <span class="kwd">INSERT</span> <span class="kwd">ON</span> users
FOR EACH STATEMENT
<span class="kwd">BEGIN</span>
    <span class="kwd">INSERT</span> <span class="kwd">INTO</span> audit_log (operation, row_count, <span class="kwd">timestamp</span>)
    <span class="kwd">VALUES</span> (<span class="str">'BULK_INSERT'</span>, <span class="func">ROW_COUNT</span>(), <span class="func">NOW</span>());
<span class="kwd">END</span> //
<span class="kwd">DELIMITER</span> ;

<span class="com">-- åˆ é™¤è§¦å‘å™¨</span>
<span class="kwd">DROP</span> <span class="kwd">TRIGGER</span> before_user_insert;</code></pre>
                </div>

                <h3>6. è¿æ¥æŸ¥è¯¢ï¼ˆLATERAL JOINï¼‰</h3>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- å†…è¿æ¥</span>
<span class="kwd">SELECT</span> u.username, o.order_id
<span class="kwd">FROM</span> users u
<span class="kwd">INNER JOIN</span> orders o <span class="kwd">ON</span> u.id = o.user_id;

<span class="com">-- <span class="kwd">LATERAL</span> JOINï¼ˆMySQL <span class="num">9</span>.x æ–°å¢ï¼‰</span>
<span class="kwd">SELECT</span> u.username, latest_orders.*
<span class="kwd">FROM</span> users u
<span class="kwd">LEFT JOIN</span> <span class="kwd">LATERAL</span> (
    <span class="kwd">SELECT</span> o.order_id, o.total_amount
    <span class="kwd">FROM</span> orders o
    <span class="kwd">WHERE</span> o.user_id = u.id
    <span class="kwd">ORDER BY</span> o.order_date <span class="kwd">DESC</span>
    <span class="kwd">LIMIT</span> <span class="num">3</span>
) <span class="kwd">AS</span> latest_orders <span class="kwd">ON</span> TRUE;

<span class="com">-- é€’å½’ CTEï¼ˆæŸ¥è¯¢å±‚çº§æ•°æ®ï¼‰</span>
<span class="kwd">WITH</span> <span class="kwd">RECURSIVE</span> category_tree <span class="kwd">AS</span> (
    <span class="kwd">SELECT</span> id, name, parent_id, <span class="num">1</span> <span class="kwd">as</span> <span class="kwd">level</span>
    <span class="kwd">FROM</span> categories
    <span class="kwd">WHERE</span> parent_id <span class="kwd">IS</span> <span class="kwd">NULL</span>
    <span class="kwd">UNION</span> <span class="kwd">ALL</span>
    <span class="kwd">SELECT</span> c.id, c.name, c.parent_id, ct.<span class="kwd">level</span> + <span class="num">1</span>
    <span class="kwd">FROM</span> categories c
    <span class="kwd">INNER JOIN</span> category_tree ct <span class="kwd">ON</span> c.parent_id = ct.id
)
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> category_tree <span class="kwd">ORDER BY</span> <span class="kwd">level</span>, name;</code></pre>
                </div>
            </div>
        </section>

        <section id="index-theory" class="section">
            <h2>ç´¢å¼•åŸç†</h2>
            <div class="content">
                <h3>1. ç´¢å¼•æ¦‚è¿°</h3>
                <p>ç´¢å¼•æ˜¯æ•°æ®åº“ä¸­ç”¨äºåŠ é€Ÿæ•°æ®æ£€ç´¢çš„ç‰¹æ®Šæ•°æ®ç»“æ„ã€‚åœ¨ MySQL ä¸­ï¼Œç´¢å¼•æœ¬è´¨ä¸Šæ˜¯å¸®åŠ©å¿«é€Ÿå®šä½æ•°æ®çš„æ•°æ®ç»“æ„ï¼Œç±»ä¼¼äºä¹¦ç±çš„ç›®å½•ã€‚ç†è§£ç´¢å¼•çš„å®ç°åŸç†å¯¹äºè®¾è®¡é«˜æ€§èƒ½æ•°æ®åº“è‡³å…³é‡è¦ã€‚</p>

                <h3>2. B+ Tree ç´¢å¼•åŸç†</h3>
                
                <h4>2.1 B+ Tree ç»“æ„</h4>
                <p>B+ Tree æ˜¯ MySQL ä¸­ InnoDB å­˜å‚¨å¼•æ“é»˜è®¤ä½¿ç”¨çš„ç´¢å¼•ç»“æ„ã€‚å®ƒæ˜¯ä¸€ç§è‡ªå¹³è¡¡çš„å¤šè·¯æœç´¢æ ‘ï¼Œæ‰€æœ‰æ•°æ®éƒ½å­˜å‚¨åœ¨å¶å­èŠ‚ç‚¹ï¼Œéå¶å­èŠ‚ç‚¹åªå­˜å‚¨ç´¢å¼•é”®ã€‚</p>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- B+ Tree ç»“æ„ç‰¹ç‚¹ï¼š</span>
<span class="com">-- 1. éå¶å­èŠ‚ç‚¹åªå­˜å‚¨ç´¢å¼•é”®ï¼ˆå†—ä½™å­˜å‚¨ï¼‰ï¼Œä¸å­˜å‚¨å®é™…æ•°æ®</span>
<span class="com">-- 2. å¶å­èŠ‚ç‚¹å­˜å‚¨æ‰€æœ‰æ•°æ®ï¼ˆåŒ…å«ä¸»é”®å’Œæ‰€æœ‰åˆ—ï¼‰</span>
<span class="com">-- 3. å¶å­èŠ‚ç‚¹ä¹‹é—´é€šè¿‡åŒå‘é“¾è¡¨è¿æ¥</span>
<span class="com">-- 4. æ‰€æœ‰å¶å­èŠ‚ç‚¹æ·±åº¦ç›¸åŒï¼ŒæŸ¥è¯¢æ—¶é—´å¤æ‚åº¦ç¨³å®š O(log n)</span>

<span class="com">-- å‡è®¾ B+ Tree é˜¶æ•° m=4ï¼š</span>
<span class="com">--        [50]              éå¶å­èŠ‚ç‚¹ï¼ˆç´¢å¼•é”®ï¼‰</span>
<span class="com">--      /   |   \</span>
<span class="com">--   [10] [30] [50,70,90]  å¶å­èŠ‚ç‚¹ï¼ˆæ•°æ®+é“¾è¡¨ï¼‰</span>
<span class="com">--    |    |    |</span>
<span class="com">--   ...  ...  ...</span></code></pre>
                </div>

                <h4>2.2 B+ Tree æŸ¥è¯¢è¿‡ç¨‹</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- æŸ¥è¯¢ id=50 çš„è®°å½•è¿‡ç¨‹ï¼š</span>
<span class="com">-- 1. ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œ50 >= 50ï¼Œè¿›å…¥ä¸­é—´å­æ ‘</span>
<span class="com">-- 2. æ¯”è¾ƒ 30 < 50 < 70ï¼Œè¿›å…¥å·¦ä¾§å¶å­èŠ‚ç‚¹</span>
<span class="com">-- 3. åœ¨å¶å­èŠ‚ç‚¹ä¸­é¡ºåºæŸ¥æ‰¾ï¼Œæ‰¾åˆ°ç›®æ ‡è®°å½•</span>

<span class="com">-- B+ Tree æŸ¥è¯¢æ•ˆç‡ï¼š</span>
<span class="com">-- - é«˜åº¦é€šå¸¸ä¸º 2-3 å±‚ï¼ˆç™¾ä¸‡çº§æ•°æ®ï¼‰</span>
<span class="com">-- - æ¯æ¬¡ IO å¯è¯»å–ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆçº¦ 16KBï¼‰</span>
<span class="com">-- - ç£ç›˜ IO æ¬¡æ•° = æ ‘é«˜åº¦ â‰ˆ 3 æ¬¡</span>

<span class="com">-- å¯¹æ¯”å…¨è¡¨æ‰«æï¼šéœ€è¦è¯»å–æ‰€æœ‰æ•°æ®é¡µ</span></code></pre>
                </div>

                <h4>2.3 B+ Tree vs B Tree</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- B+ Tree vs B Tree å¯¹æ¯”ï¼š</span>
<span class="kwd">ç‰¹æ€§</span>           | <span class="kwd">B+ Tree</span>              | <span class="kwd">B Tree</span>
---------------|--------------------|----------------
æ•°æ®å­˜å‚¨       | åªåœ¨å¶å­èŠ‚ç‚¹        | æ‰€æœ‰èŠ‚ç‚¹éƒ½å­˜å‚¨æ•°æ®
æŸ¥è¯¢ç¨³å®šæ€§     | O(log n)ï¼Œæ‰€æœ‰æŸ¥è¯¢ | O(log n)ï¼Œä¸åŒä½ç½®
<span class="kwd">èŒƒå›´æŸ¥è¯¢</span>        | å¶å­èŠ‚ç‚¹é“¾è¡¨ï¼Œ<span class="kwd">é«˜æ•ˆ</span>     | éœ€è¦éå†æ ‘
ç£ç›˜ IO        | æ›´å°‘ï¼ˆåªè¯»å¶å­èŠ‚ç‚¹ï¼‰| æ›´å¤š
ç©ºé—´åˆ©ç”¨ç‡     | æ›´é«˜ï¼ˆèŠ‚ç‚¹æ»¡ï¼‰      | ç›¸å¯¹è¾ƒä½

<span class="com">-- ä¸ºä»€ä¹ˆ MySQL é€‰æ‹© B+ Treeï¼Ÿ</span>
<span class="com">-- 1. èŒƒå›´æŸ¥è¯¢æ›´é«˜æ•ˆï¼Œé€‚åˆ ORDER BY</span>
<span class="com">-- 2. æŸ¥è¯¢æ•ˆç‡æ›´ç¨³å®šï¼ˆéƒ½è¦åˆ°å¶å­èŠ‚ç‚¹ï¼‰</span>
<span class="com">-- 3. æ›´é€‚åˆç£ç›˜å­˜å‚¨ï¼ŒIO æ¬¡æ•°å°‘</span></code></pre>
                </div>

                <h3>3. å“ˆå¸Œç´¢å¼•åŸç†</h3>
                
                <h4>3.1 å“ˆå¸Œè¡¨ç»“æ„</h4>
                <p>å“ˆå¸Œç´¢å¼•ä½¿ç”¨å“ˆå¸Œè¡¨å®ç°ï¼Œé€šè¿‡å“ˆå¸Œå‡½æ•°å°†ç´¢å¼•é”®è½¬æ¢ä¸ºå“ˆå¸Œå€¼ï¼Œç„¶åç”¨å“ˆå¸Œå€¼å®šä½æ•°æ®ã€‚å“ˆå¸Œç´¢å¼•çš„æŸ¥è¯¢æ—¶é—´å¤æ‚åº¦ä¸º O(1)ï¼Œä½†åªæ”¯æŒç²¾ç¡®åŒ¹é…æŸ¥è¯¢ã€‚</p>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- å“ˆå¸Œç´¢å¼•ç»“æ„ï¼š</span>
<span class="com">-- å“ˆå¸Œå‡½æ•°ï¼šhash(key) -> hash_value</span>
<span class="com">-- å“ˆå¸Œè¡¨ï¼šbucket -> æŒ‡å‘æ•°æ®è¡Œ</span>

<span class="com">-- ç¤ºä¾‹ï¼š</span>
<span class="kwd">key</span> = <span class="str">'zhangsan'</span>
<span class="func">hash</span>(<span class="str">'zhangsan'</span>) = <span class="num">0x7f3a</span> (å“ˆå¸Œå€¼)
<span class="kwd">bucket</span>[<span class="num">0x7f3a</span>] -> [row1, row2] (å“ˆå¸Œå†²çªé“¾è¡¨)

<span class="com">-- åˆ›å»ºå“ˆå¸Œç´¢å¼•ï¼ˆMemory/Heal å­˜å‚¨å¼•æ“ï¼‰</span>
<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> t1 (
    id <span class="kwd">INT</span>,
    name <span class="type">VARCHAR</span>(<span class="num">100</span>),
    <span class="kwd">INDEX</span> idx_name (name) <span class="kwd">USING</span> <span class="kwd">HASH</span>
) ENGINE=MEMORY;</code></pre>
                </div>

                <h4>3.2 å“ˆå¸Œç´¢å¼•çš„é™åˆ¶</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- å“ˆå¸Œç´¢å¼•çš„é™åˆ¶ï¼š</span>
<span class="com">-- 1. åªæ”¯æŒç­‰å€¼æŸ¥è¯¢ï¼Œä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢</span>
SELECT * FROM users WHERE age > 25;  <span class="com">-- âŒ æ— æ³•ä½¿ç”¨å“ˆå¸Œç´¢å¼•</span>
SELECT * FROM users WHERE name = 'zhangsan';  <span class="com">-- âœ… å¯ä»¥ä½¿ç”¨</span>

<span class="com">-- 2. ä¸æ”¯æŒæ’åºå’Œå‰ç¼€åŒ¹é…</span>
SELECT * FROM users ORDER BY name;  <span class="com">-- âŒ æ— æ³•ä½¿ç”¨</span>
SELECT * FROM users WHERE name LIKE 'zhang%';  <span class="com">-- âŒ æ— æ³•ä½¿ç”¨</span>

<span class="com">-- 3. å“ˆå¸Œå†²çªå¯¼è‡´æ€§èƒ½ä¸‹é™</span>
<span class="com">-- 4. æ— æ³•é¿å…å›è¡¨æŸ¥è¯¢</span>

<span class="com">-- InnoDB è‡ªé€‚åº”å“ˆå¸Œç´¢å¼• (AHI)</span>
<span class="com">-- InnoDB ä¼šè‡ªåŠ¨ä¸ºçƒ­ç‚¹æ•°æ®åˆ›å»ºå“ˆå¸Œç´¢å¼•</span>
<span class="kwd">SHOW</span> ENGINE INNODB STATUS;  <span class="com">-- æŸ¥çœ‹è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•çŠ¶æ€</span></code></pre>
                </div>

                <h3>4. å…¨æ–‡ç´¢å¼•åŸç†</h3>
                
                <h4>4.1 å€’æ’ç´¢å¼•ç»“æ„</h4>
                <p>å…¨æ–‡ç´¢å¼•é‡‡ç”¨å€’æ’ç´¢å¼•ï¼ˆInverted Indexï¼‰ç»“æ„ï¼Œä¸æ­£å‘ç´¢å¼•ç›¸åï¼Œå€’æ’ç´¢å¼•è®°å½•æ¯ä¸ªè¯æ¡å‡ºç°åœ¨å“ªäº›æ–‡æ¡£ä¸­ã€‚è¿™ä½¿å¾—å…¨æ–‡æœç´¢éå¸¸é«˜æ•ˆã€‚</p>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- å€’æ’ç´¢å¼•ç»“æ„ï¼š</span>
<span class="com">-- æ­£å‘ç´¢å¼•ï¼šæ–‡æ¡£ -> [è¯æ¡1, è¯æ¡2, ...]</span>
<span class="com">-- å€’æ’ç´¢å¼•ï¼šè¯æ¡ -> [æ–‡æ¡£1, æ–‡æ¡£2, ...]</span>

<span class="com">-- ç¤ºä¾‹æ–‡æ¡£ï¼š</span>
<span class="str">Doc1</span>: <span class="str">"MySQL is a database"</span>
<span class="str">Doc2</span>: <span class="str">"MySQL is open source"</span>

<span class="com">-- å€’æ’ç´¢å¼•ï¼š</span>
<span class="str">"MySQL"</span>   -> [<span class="str">Doc1</span>, <span class="str">Doc2</span>]
<span class="str">"is"</span>      -> [<span class="str">Doc1</span>, <span class="str">Doc2</span>]
<span class="str">"database"</span> -> [<span class="str">Doc1</span>]
<span class="str">"open"</span>     -> [<span class="str">Doc2</span>]
<span class="str">"source"</span>   -> [<span class="str">Doc2</span>]

<span class="com">-- åˆ›å»ºå…¨æ–‡ç´¢å¼•</span>
<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> articles (
    id <span class="kwd">INT</span> <span class="kwd">PRIMARY KEY</span>,
    title <span class="type">VARCHAR</span>(<span class="num">200</span>),
    content <span class="type">TEXT</span>,
    <span class="kwd">FULLTEXT</span> <span class="kwd">INDEX</span> ft_idx (title, content) <span class="kwd">WITH</span> PARSER ngram
) ENGINE=InnoDB;</code></pre>
                </div>

                <h4>4.2 å…¨æ–‡æœç´¢æœºåˆ¶</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- å…¨æ–‡æœç´¢æ¨¡å¼ï¼š</span>
<span class="com">-- 1. NATURAL LANGUAGE MODEï¼ˆè‡ªç„¶è¯­è¨€æ¨¡å¼ï¼‰</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> articles
<span class="kwd">WHERE</span> <span class="func">MATCH</span>(title, content) <span class="func">AGAINST</span>(<span class="str">'database'</span> <span class="kwd">IN</span> <span class="kwd">NATURAL</span> <span class="kwd">LANGUAGE</span> MODE);

<span class="com">-- 2. BOOLEAN MODEï¼ˆå¸ƒå°”æ¨¡å¼ï¼‰</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> articles
<span class="kwd">WHERE</span> <span class="func">MATCH</span>(title, content) <span class="func">AGAINST</span>(<span class="str">'+MySQL -database'</span> <span class="kwd">IN</span> BOOLEAN MODE);

<span class="com">-- 3. QUERY EXPANSIONï¼ˆæŸ¥è¯¢æ‰©å±•ï¼‰</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> articles
<span class="kwd">WHERE</span> <span class="func">MATCH</span>(title, content) <span class="func">AGAINST</span>(<span class="str">'MySQL'</span> <span class="kwd">WITH</span> <span class="kwd">QUERY</span> EXPANSION);

<span class="com">-- 4. ngram åˆ†è¯å™¨ï¼ˆä¸­æ–‡ï¼‰</span>
<span class="kwd">CREATE</span> <span class="kwd">FULLTEXT</span> <span class="kwd">INDEX</span> ft_zh <span class="kwd">ON</span> articles(content) <span class="kwd">WITH</span> PARSER ngram;</code></pre>
                </div>

                <h3>5. ç©ºé—´ç´¢å¼•åŸç†</h3>
                
                <h4>5.1 R-Tree ç»“æ„</h4>
                <p>ç©ºé—´ç´¢å¼•ä½¿ç”¨ R-Treeï¼ˆåŒºåŸŸæ ‘ï¼‰ç»“æ„ï¼Œå®ƒæ˜¯ä¸€ç§ä¸“é—¨ç”¨äºå¤„ç†å¤šç»´æ•°æ®çš„æ ‘ç»“æ„ã€‚R-Tree å°†ç©ºé—´åˆ’åˆ†ä¸ºå±‚æ¬¡åµŒå¥—çš„çŸ©å½¢åŒºåŸŸï¼Œèƒ½å¤Ÿé«˜æ•ˆå¤„ç†ç©ºé—´æŸ¥è¯¢ã€‚</p>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- R-Tree ç»“æ„åŸç†ï¼š</span>
<span class="com">-- 1. ç©ºé—´è¢«é€’å½’åˆ’åˆ†ä¸ºåµŒå¥—çš„æœ€å°è¾¹ç•ŒçŸ©å½¢ (MBR)</span>
<span class="com">-- 2. æ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨å­èŠ‚ç‚¹çš„ MBR</span>
<span class="com">-- 3. å¶å­èŠ‚ç‚¹å­˜å‚¨å®é™…çš„ç©ºé—´å¯¹è±¡</span>

<span class="com">-- R-Tree ç¤ºä¾‹ï¼š</span>
<span class="com">--        [MBR1]           æ ¹èŠ‚ç‚¹</span>
<span class="com">--      /   |   \</span>
<span class="com">--  [MBR2] [MBR3] [MBR4]  ä¸­é—´èŠ‚ç‚¹</span>
<span class="com">--   / \    |     / \</span>
<span class="com">-- P1  P2  P3   P4  P5    å¶å­èŠ‚ç‚¹ï¼ˆç©ºé—´å¯¹è±¡ï¼‰</span>

<span class="com">-- åˆ›å»ºç©ºé—´ç´¢å¼•</span>
<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> locations (
    id <span class="kwd">INT</span> <span class="kwd">PRIMARY KEY</span>,
    name <span class="type">VARCHAR</span>(<span class="num">100</span>),
    location GEOMETRY <span class="kwd">NOT</span> NULL</span>,
    <span class="kwd">SPATIAL</span> <span class="kwd">INDEX</span> idx_location (location)
) ENGINE=InnoDB;</code></pre>
                </div>

                <h4>5.2 ç©ºé—´æŸ¥è¯¢ç±»å‹</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- ç©ºé—´æŸ¥è¯¢ç¤ºä¾‹ï¼š</span>
<span class="com">-- 1. åŒ…å«æŸ¥è¯¢ï¼šæŸ¥æ‰¾å¤šè¾¹å½¢å†…çš„ç‚¹</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> locations
<span class="kwd">WHERE</span> <span class="func">ST_Contains</span>(
    <span class="func">ST_GeomFromText</span>(<span class="str">'POLYGON((0 0, 10 0, 10 10, 0 10, 0 0))'</span>),
    location
);

<span class="com">-- 2. è·ç¦»æŸ¥è¯¢ï¼šæŸ¥æ‰¾è·ç¦»æŸç‚¹ä¸€å®šèŒƒå›´å†…çš„å¯¹è±¡</span>
<span class="kwd">SELECT</span> *, <span class="func">ST_Distance_Sphere</span>(location, <span class="func">ST_GeomFromText</span>(<span class="str">'POINT(116.4 39.9)'</span>))
<span class="kwd">FROM</span> locations
<span class="kwd">WHERE</span> <span class="func">ST_Distance_Sphere</span>(location, <span class="func">ST_GeomFromText</span>(<span class="str">'POINT(116.4 39.9)'</span>)) < <span class="num">50000</span>;

<span class="com">-- 3. ç›¸äº¤æŸ¥è¯¢ï¼šæŸ¥æ‰¾ç›¸äº¤çš„ç©ºé—´å¯¹è±¡</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> locations
<span class="kwd">WHERE</span> <span class="func">ST_Intersects</span>(location, <span class="func">ST_GeomFromText</span>(<span class="str">'LINESTRING(0 0, 10 10)'</span>));</code></pre>
                </div>

                <h3>6. èšç°‡ç´¢å¼• vs éèšç°‡ç´¢å¼•</h3>
                
                <h4>6.1 èšç°‡ç´¢å¼•ï¼ˆClustered Indexï¼‰</h4>
                <p>èšç°‡ç´¢å¼•å†³å®šäº†æ•°æ®çš„ç‰©ç†å­˜å‚¨é¡ºåºã€‚æ¯ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªèšç°‡ç´¢å¼•ï¼Œå› ä¸ºæ•°æ®åªèƒ½æŒ‰ä¸€ç§æ–¹å¼ç‰©ç†æ’åºã€‚é€šå¸¸ä¸»é”®å°±æ˜¯èšç°‡ç´¢å¼•ã€‚</p>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- InnoDB èšç°‡ç´¢å¼•ç‰¹ç‚¹ï¼š</span>
<span class="com">-- 1. æ•°æ®è¡Œç›´æ¥å­˜å‚¨åœ¨å¶å­èŠ‚ç‚¹ä¸­</span>
<span class="com">-- 2. ä¸»é”®ç´¢å¼•å°±æ˜¯èšç°‡ç´¢å¼•</span>
<span class="com">-- 3. å¦‚æœæ²¡æœ‰ä¸»é”®ï¼Œä½¿ç”¨ç¬¬ä¸€ä¸ªå”¯ä¸€éç©ºç´¢å¼•</span>
<span class="com">-- 4. å¦‚æœæ²¡æœ‰å”¯ä¸€ç´¢å¼•ï¼ŒInnoDB ä¼šç”Ÿæˆéšè—çš„ ROW_ID</span>

<span class="com">-- èšç°‡ç´¢å¼•ç»“æ„ï¼š</span>
<span class="com">-- å¶å­èŠ‚ç‚¹å­˜å‚¨å®Œæ•´çš„æ•°æ®è¡Œ</span>
<span class="com">-- +--------+-------------+-----+-----+</span>
<span class="com">-- | id (PK)| name        | age | ... |</span>
<span class="com">-- +--------+-------------+-----+-----+</span>
<span class="com">-- | 1      | zhangsan    | 25  | ... |</span>
<span class="com">-- | 2      | lisi        | 30  | ... |</span>
<span class="com">-- | 3      | wangwu      | 28  | ... |</span>
<span class="com">-- +--------+-------------+-----+-----+</span>

<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> users (
    id <span class="kwd">INT</span> <span class="kwd">PRIMARY KEY</span>,  <span class="com">-- èšç°‡ç´¢å¼•</span>
    name <span class="type">VARCHAR</span>(<span class="num">100</span>),
    age <span class="kwd">INT</span>,
    <span class="kwd">INDEX</span> idx_age (age)   <span class="com">-- éèšç°‡ç´¢å¼•</span>
);</code></pre>
                </div>

                <h4>6.2 éèšç°‡ç´¢å¼•ï¼ˆSecondary Indexï¼‰</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- éèšç°‡ç´¢å¼•ï¼ˆè¾…åŠ©ç´¢å¼•ï¼‰ç‰¹ç‚¹ï¼š</span>
<span class="com">-- 1. å¶å­èŠ‚ç‚¹å­˜å‚¨ç´¢å¼•é”® + ä¸»é”®å€¼</span>
<span class="com">-- 2. ä¸€ä¸ªè¡¨å¯ä»¥æœ‰å¤šä¸ªéèšç°‡ç´¢å¼•</span>
<span class="com">-- 3. æŸ¥è¯¢æ—¶éœ€è¦å…ˆé€šè¿‡éèšç°‡ç´¢å¼•æ‰¾åˆ°ä¸»é”®</span>
<span class="com">-- 4. å†é€šè¿‡ä¸»é”®åˆ°èšç°‡ç´¢å¼•ä¸­è·å–å®Œæ•´æ•°æ®ï¼ˆå›è¡¨ï¼‰</span>

<span class="com">-- éèšç°‡ç´¢å¼• idx_age ç»“æ„ï¼š</span>
<span class="com">-- +--------+--------+</span>
<span class="com">-- | age    | id(PK) |</span>
<span class="com">-- +--------+--------+</span>
<span class="com">-- | 25     | 1      |</span>
<span class="com">-- | 28     | 3      |</span>
<span class="com">-- | 30     | 2      |</span>
<span class="com">-- +--------+--------+</span>

<span class="com">-- æŸ¥è¯¢ SELECT * FROM users WHERE age = 25ï¼š</span>
<span class="com">-- 1. åœ¨ idx_age ä¸­æ‰¾åˆ° age=25 çš„è®°å½•ï¼Œè·å– id=1</span>
<span class="com">-- 2. åœ¨èšç°‡ç´¢å¼•ä¸­æ‰¾åˆ° id=1 çš„å®Œæ•´æ•°æ®</span>
<span class="com">-- 3. è¿”å›å®Œæ•´æ•°æ®è¡Œ</span></code></pre>
                </div>

                <h4>6.3 è¦†ç›–ç´¢å¼•é¿å…å›è¡¨</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- è¦†ç›–ç´¢å¼•ï¼šç´¢å¼•åŒ…å«æŸ¥è¯¢æ‰€éœ€çš„æ‰€æœ‰åˆ—</span>
<span class="com">-- ä¸éœ€è¦å›è¡¨ï¼Œç›´æ¥ä»ç´¢å¼•ä¸­è¿”å›æ•°æ®</span>

<span class="com">-- åˆ›å»ºè¦†ç›–ç´¢å¼•</span>
<span class="kwd">CREATE</span> <span class="kwd">INDEX</span> idx_age_name <span class="kwd">ON</span> users(age, name);

<span class="com">-- ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼ˆä¸éœ€è¦å›è¡¨ï¼‰</span>
<span class="kwd">SELECT</span> age, name <span class="kwd">FROM</span> users <span class="kwd">WHERE</span> age > <span class="num">25</span>;
<span class="com">-- EXPLAIN: Extra = Using index</span>

<span class="com">-- éœ€è¦å›è¡¨çš„æŸ¥è¯¢</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> users <span class="kwd">WHERE</span> age > <span class="num">25</span>;
<span class="com">-- EXPLAIN: Extra = Using index condition</span>

<span class="com">-- éªŒè¯æ˜¯å¦ä½¿ç”¨è¦†ç›–ç´¢å¼•</span>
<span class="kwd">EXPLAIN</span> <span class="kwd">SELECT</span> age, name <span class="kwd">FROM</span> users <span class="kwd">WHERE</span> age = <span class="num">25</span>;
<span class="com">-- type=ref, key=idx_age_name, Extra=Using index</span></code></pre>
                </div>

                <h4>6.4 å›è¡¨åŸç†è¯¦è§£</h4>
                <p>å›è¡¨æ˜¯æŒ‡æŸ¥è¯¢è¿‡ç¨‹ä¸­ï¼Œå…ˆé€šè¿‡éèšç°‡ç´¢å¼•æ‰¾åˆ°ä¸»é”®å€¼ï¼Œå†æ ¹æ®ä¸»é”®å€¼åˆ°èšç°‡ç´¢å¼•ä¸­æŸ¥æ‰¾å®Œæ•´æ•°æ®è¡Œçš„è¿‡ç¨‹ã€‚è¿™æ˜¯ InnoDB å­˜å‚¨å¼•æ“çš„é‡è¦ç‰¹æ€§ã€‚</p>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- å›è¡¨çš„å®Œæ•´è¿‡ç¨‹ï¼š</span>
<span class="com">-- 1. åœ¨éèšç°‡ç´¢å¼•æ ‘ä¸­æŸ¥æ‰¾</span>
<span class="com">-- 2. è·å–æ»¡è¶³æ¡ä»¶çš„ä¸»é”®å€¼</span>
<span class="com">-- 3. ä½¿ç”¨ä¸»é”®å€¼åœ¨èšç°‡ç´¢å¼•ä¸­æŸ¥æ‰¾å®Œæ•´æ•°æ®</span>
<span class="com">-- 4. è¿”å›å®Œæ•´çš„ç”¨æˆ·æ•°æ®</span>

<span class="com">-- ç¤ºä¾‹è¡¨ç»“æ„ï¼š</span>
<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> orders (
    id <span class="kwd">INT</span> <span class="kwd">PRIMARY KEY</span>,           <span class="com">-- èšç°‡ç´¢å¼•</span>
    order_no <span class="type">VARCHAR</span>(<span class="num">20</span>),       <span class="com">-- å”¯ä¸€ç´¢å¼•</span>
    customer_id <span class="kwd">INT</span>,
    amount <span class="kwd">DECIMAL</span>(<span class="num">10</span>,<span class="num">2</span>),
    status <span class="type">VARCHAR</span>(<span class="num">10</span>),
    created_at <span class="type">DATETIME</span>,
    <span class="kwd">INDEX</span> idx_customer (customer_id) <span class="com">-- éèšç°‡ç´¢å¼•</span>
);

<span class="com">-- æ‰§è¡Œ SELECT * FROM orders WHERE customer_id = 100</span>
<span class="com">-- 1. åœ¨ idx_customer ä¸­æ‰¾åˆ° customer_id=100 çš„è®°å½•</span>
<span class="com">-- 2. è·å–ä¸»é”® idï¼ˆå¦‚ id=500ï¼‰</span>
<span class="com">-- 3. åœ¨èšç°‡ç´¢å¼•ä¸­æŸ¥æ‰¾ id=500 çš„å®Œæ•´è®°å½•</span>
<span class="com">-- 4. è¿”å›æ‰€æœ‰åˆ—æ•°æ®</span>

<span class="kwd">EXPLAIN</span> <span class="kwd">SELECT</span> * <span class="kwd">FROM</span> orders <span class="kwd">WHERE</span> customer_id = <span class="num">100</span>;
<span class="com">-- type: ref, key: idx_customer</span>
<span class="com">-- Extra: Using index condition (éœ€è¦å›è¡¨)</span></code></pre>
                </div>

                <h4>6.5 å›è¡¨æ€§èƒ½å½±å“</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- å›è¡¨çš„æ€§èƒ½å½±å“ï¼š</span>
<span class="com">-- 1. å¢åŠ ç£ç›˜ IOï¼šæ¯æ¬¡å›è¡¨å¯èƒ½äº§ç”Ÿä¸€æ¬¡ç£ç›˜è¯»å–</span>
<span class="com">-- 2. éšæœº IOï¼šèšç°‡ç´¢å¼•ä¸­æŸ¥æ‰¾æ˜¯éšæœº IO</span>
<span class="com">-- 3. å›è¡¨æ¬¡æ•° = ç´¢å¼•å‘½ä¸­çš„è®°å½•æ•°</span>

<span class="com">-- å›è¡¨æ¬¡æ•°è¿‡å¤šçš„ä¾‹å­</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> orders <span class="kwd">WHERE</span> customer_id > <span class="num">100</span>;
<span class="com">-- å‡è®¾ customer_id > 100 æœ‰ 10000 æ¡è®°å½•</span>
<span class="com">-- éœ€è¦å›è¡¨ 10000 æ¬¡ï¼Œæ€§èƒ½å¾ˆå·®</span>

<span class="kwd">EXPLAIN</span> <span class="kwd">SELECT</span> * <span class="kwd">FROM</span> orders <span class="kwd">WHERE</span> customer_id > <span class="num">100</span>;
<span class="com">-- type: range, key: idx_customer</span>
<span class="com">-- rows: 10000 (é¢„è®¡å›è¡¨æ¬¡æ•°)</span>

<span class="com">-- ä¼˜åŒ–æ–¹æ¡ˆï¼šä½¿ç”¨è¦†ç›–ç´¢å¼•</span>
<span class="kwd">CREATE</span> <span class="kwd">INDEX</span> idx_cover <span class="kwd">ON</span> orders(customer_id, order_no, amount, status);

<span class="com">-- å¦‚æœæŸ¥è¯¢çš„åˆ—éƒ½åœ¨ç´¢å¼•ä¸­ï¼Œä¸éœ€è¦å›è¡¨</span>
<span class="kwd">SELECT</span> customer_id, order_no, amount, status 
<span class="kwd">FROM</span> orders <span class="kwd">WHERE</span> customer_id > <span class="num">100</span>;

<span class="kwd">EXPLAIN</span> <span class="kwd">SELECT</span> customer_id, order_no, amount, status 
<span class="kwd">FROM</span> orders <span class="kwd">WHERE</span> customer_id > <span class="num">100</span>;
<span class="com">-- Extra: Using index (è¦†ç›–ç´¢å¼•ï¼Œæ— éœ€å›è¡¨)</span></code></pre>
                </div>

                <h4>6.6 å‡å°‘å›è¡¨çš„æ–¹æ³•</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- æ–¹æ³•1ï¼šä½¿ç”¨è¦†ç›–ç´¢å¼•</span>
<span class="com">-- å°†éœ€è¦æŸ¥è¯¢çš„åˆ—éƒ½åŒ…å«åœ¨ç´¢å¼•ä¸­</span>

<span class="com">-- æ–¹æ³•2ï¼šä¼˜åŒ–æŸ¥è¯¢æ¡ä»¶</span>
<span class="com">-- é¿å…è¿”å›å¤§é‡æ•°æ®</span>
<span class="kwd">SELECT</span> id, order_no <span class="kwd">FROM</span> orders <span class="kwd">WHERE</span> customer_id = <span class="num">100</span>
<span class="kwd">LIMIT</span> <span class="num">100</span>;  <span class="com">-- é™åˆ¶è¿”å›æ•°é‡</span>

<span class="com">-- æ–¹æ³•3ï¼šä½¿ç”¨ä¸»é”®æŸ¥è¯¢</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> orders <span class="kwd">WHERE</span> id = <span class="num">500</span>;
<span class="com">-- ç›´æ¥åœ¨èšç°‡ç´¢å¼•ä¸­æŸ¥æ‰¾ï¼Œä¸éœ€è¦å›è¡¨</span>

<span class="com">-- æ–¹æ³•4ï¼šåˆ†é¡µä¼˜åŒ–</span>
<span class="com">-- é¿å… OFFSET è¿‡å¤§å¯¼è‡´çš„æ·±åº¦åˆ†é¡µé—®é¢˜</span>

<span class="com">-- ä½æ•ˆï¼ˆå›è¡¨æ¬¡æ•°å¤šï¼‰ï¼š</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> orders <span class="kwd">ORDER BY</span> id <span class="kwd">LIMIT</span> <span class="num">10000</span>, <span class="num">10</span>;

<span class="com">-- é«˜æ•ˆï¼ˆåŸºäºä¸»é”®èŒƒå›´ï¼‰ï¼š</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> orders <span class="kwd">WHERE</span> id > <span class="num">10000</span> <span class="kwd">LIMIT</span> <span class="num">10</span>;
<span class="com">-- ä¸Šä¸€é¡µæœ€åä¸€æ¡è®°å½•çš„ id ä½œä¸ºèµ·ç‚¹</span>

<span class="com">-- æ–¹æ³•5ï¼šä½¿ç”¨å»¶è¿Ÿå…³è”</span>
<span class="kwd">SELECT</span> o.* 
<span class="kwd">FROM</span> orders o 
<span class="kwd">INNER JOIN</span> (
    <span class="kwd">SELECT</span> id <span class="kwd">FROM</span> orders <span class="kwd">WHERE</span> customer_id = <span class="num">100</span>
    <span class="kwd">LIMIT</span> <span class="num">100</span>
) t <span class="kwd">ON</span> o.id = t.id;</code></pre>
                </div>

                <h3>7. ç´¢å¼•å­˜å‚¨ç»“æ„</h3>
                
                <h4>7.1 InnoDB é¡µé¢ç»“æ„</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- InnoDB æ•°æ®é¡µç»“æ„ï¼ˆé»˜è®¤ 16KBï¼‰ï¼š</span>
<span class="com">-- +------------------+</span>
<span class="com">-- | File Header      | 38 bytes - æ–‡ä»¶å¤´</span>
<span class="com">-- +------------------+</span>
<span class="com">-- | Page Header      | 56 bytes - é¡µå¤´</span>
<span class="com">-- +------------------+</span>
<span class="com">-- | Infimum + Supremum| 26 bytes - è™šæ‹Ÿè¡Œ</span>
<span class="com">-- +------------------+</span>
<span class="com">-- | User Records     | å˜é•¿ - ç”¨æˆ·æ•°æ®</span>
<span class="com">-- +------------------+</span>
<span class="com">-- | Free Space       | å˜é•¿ - ç©ºé—²ç©ºé—´</span>
<span class="com">-- +------------------+</span>
<span class="com">-- | Page Directory   | å˜é•¿ - é¡µç›®å½•</span>
<span class="com">-- +------------------+</span>
<span class="com">-- | File Trailer     | 8 bytes - æ–‡ä»¶å°¾</span>
<span class="com">-- +------------------+</span>

<span class="com">-- é¡µå†…è®°å½•å­˜å‚¨ï¼š</span>
<span class="com">-- 1. è®°å½•å¤´ä¿¡æ¯ï¼ˆå˜é•¿å­—æ®µé•¿åº¦ã€NULLæ ‡å¿—ç­‰ï¼‰</span>
<span class="com">-- 2. è®°å½•å®é™…æ•°æ®</span>
<span class="com">-- 3. è®°å½•é€šè¿‡ Page Directory å®ç°äºŒåˆ†æŸ¥æ‰¾</span></code></pre>
                </div>

                <h4>7.2 ç´¢å¼•é¡µç»“æ„</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- B+ Tree ç´¢å¼•é¡µç»“æ„ï¼š</span>
<span class="com">-- +------------------+</span>
<span class="com">-- | File Header      | 38 bytes</span>
<span class="com">-- +------------------+</span>
<span class="com">-- | Page Header      | 56 bytes</span>
<span class="com">-- +------------------+</span>
<span class="com">-- | User Records     | ç´¢å¼•è®°å½•</span>
<span class="com">-- |  (éå¶å­èŠ‚ç‚¹)    | (æœ€å°é”®, æŒ‡å‘å­é¡µæŒ‡é’ˆ)</span>
<span class="com">-- |  (å¶å­èŠ‚ç‚¹)      | (é”®å€¼, ä¸»é”®/è¡ŒæŒ‡é’ˆ)</span>
<span class="com">-- +------------------+</span>
<span class="com">-- | Free Space       | ç©ºé—²ç©ºé—´</span>
<span class="com">-- +------------------+</span>
<span class="com">-- | Page Directory   | æ§½ä½ç›®å½•ï¼ˆè®°å½•åˆ†ç»„ï¼‰</span>
<span class="com">-- +------------------+</span>
<span class="com">-- | File Trailer     | 8 bytes</span>
<span class="com">-- +------------------+</span>

<span class="com">-- éå¶å­èŠ‚ç‚¹è®°å½•æ ¼å¼ï¼š</span>
<span class="com">-- | è®°å½•å¤´ | ç´¢å¼•é”®å€¼ | é¡µé¢æŒ‡é’ˆ |</span>

<span class="com">-- å¶å­èŠ‚ç‚¹è®°å½•æ ¼å¼ï¼ˆèšç°‡ç´¢å¼•ï¼‰ï¼š</span>
<span class="com">-- | è®°å½•å¤´ | ä¸»é”®å€¼ | å…¶ä»–åˆ—æ•°æ® |</span>

<span class="com">-- å¶å­èŠ‚ç‚¹è®°å½•æ ¼å¼ï¼ˆéèšç°‡ç´¢å¼•ï¼‰ï¼š</span>
<span class="com">-- | è®°å½•å¤´ | ç´¢å¼•é”®å€¼ | ä¸»é”®å€¼ |</span></code></pre>
                </div>

                <h3>8. ç´¢å¼•ä¼˜åŒ–åŸç†</h3>
                
                <h4>8.1 æœ€å·¦å‰ç¼€åŸåˆ™</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- å¤åˆç´¢å¼• (a, b, c) çš„ä½¿ç”¨è§„åˆ™ï¼š</span>
<span class="kwd">WHERE</span> a = <span class="num">1</span>                 <span class="com">-- âœ… ä½¿ç”¨ç´¢å¼• a</span>
<span class="kwd">WHERE</span> a = <span class="num">1</span> <span class="kwd">AND</span> b = <span class="num">2</span>        <span class="com">-- âœ… ä½¿ç”¨ç´¢å¼• a, b</span>
<span class="kwd">WHERE</span> a = <span class="num">1</span> <span class="kwd">AND</span> b = <span class="num">2</span> <span class="kwd">AND</span> c = <span class="num">3</span>  <span class="com">-- âœ… ä½¿ç”¨ç´¢å¼• a, b, c</span>
<span class="kwd">WHERE</span> b = <span class="num">2</span>                 <span class="com">-- âŒ ä¸ä½¿ç”¨ç´¢å¼•</span>
<span class="kwd">WHERE</span> b = <span class="num">2</span> <span class="kwd">AND</span> c = <span class="num">3</span>    <span class="com">-- âŒ ä¸ä½¿ç”¨ç´¢å¼•</span>
<span class="kwd">WHERE</span> a = <span class="num">1</span> <span class="kwd">AND</span> c = <span class="num">3</span>    <span class="com">-- âš ï¸ åªä½¿ç”¨ç´¢å¼• a</span>

<span class="com">-- åŸç†ï¼šå¤åˆç´¢å¼•æŒ‰ä»å·¦åˆ°å³çš„é¡ºåºæ„å»º B+ Tree</span>
<span class="com">-- å¿…é¡»å…ˆä½¿ç”¨å‰é¢çš„åˆ—ï¼Œæ‰èƒ½åˆ©ç”¨åç»­åˆ—çš„ç´¢å¼•</span></code></pre>
                </div>

                <h4>8.2 ç´¢å¼•ä¸‹æ¨ï¼ˆIndex Condition Pushdownï¼‰</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- ç´¢å¼•ä¸‹æ¨åŸç†ï¼š</span>
<span class="com">-- åœ¨ MySQL 5.6+ ä¹‹å‰ï¼š</span>
<span class="com">-- 1. é€šè¿‡ç´¢å¼•æ‰¾åˆ°æ»¡è¶³ a=1 çš„ä¸»é”®</span>
<span class="com">-- 2. å›è¡¨è·å–å®Œæ•´æ•°æ®</span>
<span class="com">-- 3. åœ¨ server å±‚è¿‡æ»¤ b>100 çš„æ¡ä»¶</span>

<span class="com">-- MySQL 5.6+ ç´¢å¼•ä¸‹æ¨ï¼š</span>
<span class="com">-- 1. é€šè¿‡ç´¢å¼•æ‰¾åˆ°æ»¡è¶³ a=1 çš„ä¸»é”®</span>
<span class="com">-- 2. åœ¨å­˜å‚¨å¼•æ“å±‚ç›´æ¥è¿‡æ»¤ b>100 çš„æ¡ä»¶</span>
<span class="com">-- 3. åªå¯¹æ»¡è¶³æ‰€æœ‰æ¡ä»¶çš„è®°å½•å›è¡¨</span>

<span class="com">-- ç¤ºä¾‹ç´¢å¼•ï¼š(a, b)</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> t <span class="kwd">WHERE</span> a = <span class="num">1</span> <span class="kwd">AND</span> b > <span class="num">100</span>;

<span class="com">-- éªŒè¯ç´¢å¼•ä¸‹æ¨</span>
<span class="kwd">EXPLAIN</span> <span class="kwd">SELECT</span> * <span class="kwd">FROM</span> t <span class="kwd">WHERE</span> a = <span class="num">1</span> <span class="kwd">AND</span> b > <span class="num">100</span>;
<span class="com">-- Extra: Using index condition (ä½¿ç”¨äº†ç´¢å¼•ä¸‹æ¨)</span></code></pre>
                </div>

                <h4>8.3 ç´¢å¼•åˆå¹¶ï¼ˆIndex Mergeï¼‰</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- ç´¢å¼•åˆå¹¶åŸç†ï¼š</span>
<span class="com">-- MySQL å¯ä»¥åŒæ—¶ä½¿ç”¨å¤šä¸ªç´¢å¼•</span>
<span class="com">-- ç„¶ååˆå¹¶ç»“æœé›†</span>

<span class="com">-- ç´¢å¼•åˆå¹¶ç±»å‹ï¼š</span>
<span class="com">-- 1. intersectionï¼ˆäº¤é›†ï¼‰- å¤šä¸ªç´¢å¼•ç»“æœå–äº¤é›†</span>
<span class="com">-- 2. unionï¼ˆå¹¶é›†ï¼‰- å¤šä¸ªç´¢å¼•ç»“æœå–å¹¶é›†</span>
<span class="com">-- 3. sort_unionï¼ˆæ’åºå¹¶é›†ï¼‰- å…ˆæ’åºå†å–å¹¶é›†</span>

<span class="com">-- ç¤ºä¾‹ï¼š</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> users <span class="kwd">WHERE</span> age = <span class="num">25</span> <span class="kwd">AND</span> name = <span class="str">'zhangsan'</span>;

<span class="kwd">EXPLAIN</span> <span class="kwd">SELECT</span> * <span class="kwd">FROM</span> users <span class="kwd">WHERE</span> age = <span class="num">25</span> <span class="kwd">AND</span> name = <span class="str">'zhangsan'</span>;
<span class="com">-- type: index_merge</span>
<span class="com">-- key: idx_age, idx_name</span>
<span class="com">-- Extra: Using intersect(idx_age,idx_name)</span></code></pre>
                </div>

                <h3>9. ç´¢å¼•å®è·µåˆ†æ</h3>
                
                <h4>9.1 ä½¿ç”¨ EXPLAIN åˆ†æç´¢å¼•</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- EXPLAIN å…³é”®å­—æ®µï¼š</span>
<span class="com">-- type: è¿æ¥ç±»å‹ï¼ˆä»å¥½åˆ°å·®ï¼‰</span>
<span class="com">--   system > const > eq_ref > ref > range > index > ALL</span>
<span class="com">--   const: ä¸»é”®/å”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢</span>
<span class="com">--   ref: éå”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢</span>
<span class="com">--   range: ç´¢å¼•èŒƒå›´æŸ¥è¯¢</span>
<span class="com">--   index: å…¨ç´¢å¼•æ‰«æ</span>
<span class="com">--   ALL: å…¨è¡¨æ‰«æï¼ˆéœ€è¦ä¼˜åŒ–ï¼‰</span>

<span class="com">-- key: å®é™…ä½¿ç”¨çš„ç´¢å¼•</span>
<span class="com">-- rows: é¢„è®¡æ‰«æçš„è¡Œæ•°</span>
<span class="com">-- Extra: é¢å¤–ä¿¡æ¯</span>
<span class="com">--   Using index: ä½¿ç”¨è¦†ç›–ç´¢å¼•</span>
<span class="com">--   Using where: ä½¿ç”¨ WHERE æ¡ä»¶è¿‡æ»¤</span>
<span class="com">--   Using index condition: ä½¿ç”¨ç´¢å¼•ä¸‹æ¨</span>
<span class="com">--   Using filesort: éœ€è¦é¢å¤–æ’åº</span>
<span class="com">--   Using temporary: ä½¿ç”¨ä¸´æ—¶è¡¨</span>

<span class="kwd">EXPLAIN</span> <span class="kwd">SELECT</span> * <span class="kwd">FROM</span> users <span class="kwd">WHERE</span> age = <span class="num">25</span>;

<span class="com">-- åˆ†æç»“æœï¼š</span>
<span class="com">-- type: ref (ä½¿ç”¨äº†éå”¯ä¸€ç´¢å¼•)</span>
<span class="com">-- key: idx_age</span>
<span class="com">-- rows: 10 (é¢„è®¡æ‰«æ 10 è¡Œ)</span></code></pre>
                </div>

                <h4>9.2 ç´¢å¼•è®¾è®¡æœ€ä½³å®è·µ</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- ç´¢å¼•è®¾è®¡åŸåˆ™ï¼š</span>
<span class="com">-- 1. åŒºåˆ†åº¦é«˜çš„åˆ—æ”¾åœ¨å‰é¢</span>
<span class="kwd">CREATE</span> <span class="kwd">INDEX</span> idx_status_user <span class="kwd">ON</span> orders(user_id, <span class="kwd">status</span>);
<span class="com">-- âœ… user_id åŒºåˆ†åº¦é«˜ï¼Œæ”¾å‰é¢</span>

<span class="com">-- 2. è€ƒè™‘æŸ¥è¯¢çš„ WHERE æ¡ä»¶é¡ºåº</span>
<span class="kwd">CREATE</span> <span class="kwd">INDEX</span> idx_age_name <span class="kwd">ON</span> users(age, name);
<span class="com">-- é€‚åˆ: WHERE age = ? æˆ– WHERE age = ? AND name = ?</span>

<span class="com">-- 3. æ§åˆ¶ç´¢å¼•æ•°é‡</span>
<span class="com">-- - ç´¢å¼•å ç”¨ç©ºé—´</span>
<span class="com">-- - å½±å“ INSERT/UPDATE/DELETE æ€§èƒ½</span>
<span class="com">-- - å»ºè®®å•ä¸ªè¡¨ç´¢å¼•æ•° < 5</span>

<span class="com">-- 4. ä½¿ç”¨è¦†ç›–ç´¢å¼•å‡å°‘å›è¡¨</span>
<span class="kwd">CREATE</span> <span class="kwd">INDEX</span> idx_user_cover <span class="kwd">ON</span> orders(user_id, <span class="kwd">status</span>, created_at);
<span class="com">-- è¦†ç›–: SELECT user_id, status FROM orders WHERE user_id = ?</span>

<span class="com">-- 5. é¿å…åœ¨åŒºåˆ†åº¦ä½çš„åˆ—ä¸Šå»ºç´¢å¼•</span>
<span class="com">-- å¦‚: æ€§åˆ«ã€çŠ¶æ€ï¼ˆ0/1ï¼‰ç­‰</span></code></pre>
                </div>
            </div>
        </section>

        <section id="performance" class="section">
            <h2>æ€§èƒ½ä¼˜åŒ–</h2>
            <div class="content">
                <h3>1. AI æŸ¥è¯¢ä¼˜åŒ–å™¨</h3>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- å¯ç”¨ <span class="kwd">AI</span> æŸ¥è¯¢ä¼˜åŒ–å™¨</span>
<span class="kwd">SET</span> GLOBAL optimizer_switch = <span class="str">'ai_optimization=on'</span>;

<span class="com">-- ä½¿ç”¨ <span class="kwd">AI</span> ä¼˜åŒ–æç¤º</span>
<span class="kwd">SELECT</span> /*+ AI_OPTIMIZE */ * <span class="kwd">FROM</span> users <span class="kwd">WHERE</span> age > <span class="num">25</span>;

<span class="com">-- åˆ†ææŸ¥è¯¢è®¡åˆ’ï¼ˆ<span class="kwd">AI</span> å¢å¼ºç‰ˆï¼‰</span>
<span class="kwd">EXPLAIN</span> <span class="kwd">ANALYZE</span> <span class="kwd">SELECT</span> * <span class="kwd">FROM</span> users <span class="kwd">WHERE</span> age > <span class="num">25</span>;

<span class="com">-- æŸ¥çœ‹ <span class="kwd">AI</span> ä¼˜åŒ–å»ºè®®</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> sys.ai_query_recommendations
<span class="kwd">WHERE</span> query_hash = <span class="func">MD5</span>(<span class="str">'YOUR_QUERY'</span>);

<span class="com">-- è‡ªåŠ¨åº”ç”¨ä¼˜åŒ–å»ºè®®</span>
<span class="kwd">CALL</span> sys.apply_ai_optimizations(<span class="str">'YOUR_QUERY_HASH'</span>);</code></pre>
                </div>

                <h3>2. æŸ¥è¯¢ç¼“å­˜ä¼˜åŒ–</h3>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- å¯ç”¨æŸ¥è¯¢ç¼“å­˜ï¼ˆMySQL <span class="num">9</span>.x æ™ºèƒ½ç¼“å­˜ï¼‰</span>
<span class="kwd">SET</span> GLOBAL query_cache_type = ON;
<span class="kwd">SET</span> GLOBAL query_cache_size = <span class="num">67108864</span>; <span class="com">-- 64MB</span>

<span class="com">-- ç›‘æ§ç¼“å­˜å‘½ä¸­ç‡</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> performance_schema.events_statements_summary_by_digest
<span class="kwd">ORDER BY</span> SUM_TIMER_WAIT <span class="kwd">DESC</span> <span class="kwd">LIMIT</span> <span class="num">10</span>;

<span class="com">-- æŸ¥çœ‹ç¼“å­˜ç»Ÿè®¡</span>
<span class="kwd">SHOW</span> <span class="kwd">STATUS</span> <span class="kwd">LIKE</span> <span class="str">'Qcache%'</span>;</code></pre>
                </div>

                <details>
                    <summary>3. SQL è¯­å¥ä¼˜åŒ–æŠ€å·§ï¼ˆç‚¹å‡»å±•å¼€ï¼‰</summary>

                <h4>3.1 é¿å…å…¨è¡¨æ‰«æ</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- âŒ å…¨è¡¨æ‰«æï¼ˆæ•ˆç‡ä½ï¼‰</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> users <span class="kwd">WHERE</span> age != <span class="num">25</span>;
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> users <span class="kwd">WHERE</span> age <span class="kwd">NOT</span> <span class="kwd">IN</span> (<span class="num">20</span>, <span class="num">30</span>);

<span class="com">-- âœ… ä½¿ç”¨ç´¢å¼•ï¼ˆæ•ˆç‡é«˜ï¼‰</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> users <span class="kwd">WHERE</span> age = <span class="num">25</span>;

<span class="com">-- âŒ å‰å¯¼é€šé…ç¬¦ï¼ˆæ— æ³•ä½¿ç”¨ç´¢å¼•ï¼‰</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> users <span class="kwd">WHERE</span> name <span class="kwd">LIKE</span> <span class="str">'%zhang%'</span>;

<span class="com">-- âœ… åç½®é€šé…ç¬¦ï¼ˆå¯ä»¥ä½¿ç”¨ç´¢å¼•ï¼‰</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> users <span class="kwd">WHERE</span> name <span class="kwd">LIKE</span> <span class="str">'zhang%'</span>;

<span class="com">-- âœ… ä½¿ç”¨è¦†ç›–ç´¢å¼•</span>
<span class="kwd">SELECT</span> name, age <span class="kwd">FROM</span> users <span class="kwd">WHERE</span> name <span class="kwd">LIKE</span> <span class="str">'zhang%'</span>;</code></pre>
                </div>

                <h4>3.2 ä¼˜åŒ– LIMIT åˆ†é¡µ</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- âŒ ä½æ•ˆçš„åˆ†é¡µï¼ˆæ·±åº¦åˆ†é¡µé—®é¢˜ï¼‰</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> orders <span class="kwd">ORDER BY</span> id <span class="kwd">LIMIT</span> <span class="num">100000</span>, <span class="num">10</span>;
<span class="com">-- MySQL ä¼šå…ˆæ‰«æå‰ 100010 æ¡è®°å½•ï¼Œç„¶åä¸¢å¼ƒå‰ 100000 æ¡</span>

<span class="com">-- âœ… ä¼˜åŒ–æ–¹æ¡ˆ1ï¼šåŸºäºä¸»é”®çš„èŒƒå›´æŸ¥è¯¢</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> orders 
<span class="kwd">WHERE</span> id > <span class="num">100000</span> 
<span class="kwd">ORDER BY</span> id 
<span class="kwd">LIMIT</span> <span class="num">10</span>;

<span class="com">-- âœ… ä¼˜åŒ–æ–¹æ¡ˆ2ï¼šå»¶è¿Ÿå…³è”</span>
<span class="kwd">SELECT</span> o.*
<span class="kwd">FROM</span> orders o
<span class="kwd">INNER JOIN</span> (
    <span class="kwd">SELECT</span> id <span class="kwd">FROM</span> orders
    <span class="kwd">ORDER BY</span> id
    <span class="kwd">LIMIT</span> <span class="num">100000</span>, <span class="num">10</span>
) t <span class="kwd">ON</span> o.id = t.id;

<span class="com">-- âœ… ä¼˜åŒ–æ–¹æ¡ˆ3ï¼šè®°å½•ä¸Šä¸€é¡µæœ€åä¸€æ¡ ID</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> orders 
<span class="kwd">WHERE</span> id > <span class="num">100000</span> 
<span class="kwd">ORDER BY</span> id 
<span class="kwd">LIMIT</span> <span class="num">10</span>;
<span class="com">-- å‡è®¾ä¸Šä¸€é¡µæœ€åä¸€æ¡æ˜¯ id=100000</span></code></pre>
                </div>

                <h4>3.3 é¿å… SELECT *</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- âŒ SELECT * ä¼šè¯»å–æ‰€æœ‰åˆ—ï¼Œå¢åŠ  IO</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> orders <span class="kwd">WHERE</span> customer_id = <span class="num">100</span>;

<span class="com">-- âœ… åªæŸ¥è¯¢éœ€è¦çš„åˆ—</span>
<span class="kwd">SELECT</span> order_no, amount, created_at 
<span class="kwd">FROM</span> orders <span class="kwd">WHERE</span> customer_id = <span class="num">100</span>;

<span class="com">-- âœ… ä½¿ç”¨è¦†ç›–ç´¢å¼•æ—¶ï¼Œæ•ˆæœæ›´æ˜æ˜¾</span>
<span class="kwd">CREATE</span> <span class="kwd">INDEX</span> idx_cover <span class="kwd">ON</span> orders(customer_id, order_no, amount);
<span class="kwd">SELECT</span> order_no, amount <span class="kwd">FROM</span> orders <span class="kwd">WHERE</span> customer_id = <span class="num">100</span>;
<span class="com">-- å®Œå…¨åœ¨ç´¢å¼•ä¸­å®Œæˆï¼Œä¸éœ€è¦å›è¡¨</span></code></pre>
                </div>

                <h4>3.4 åˆç†ä½¿ç”¨ JOIN</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- âŒ å¤§è¡¨ JOIN å°è¡¨ï¼ˆæ•ˆç‡ä½ï¼‰</span>
<span class="kwd">SELECT</span> o.*, c.name
<span class="kwd">FROM</span> orders o  <span class="com">-- å¤§è¡¨</span>
<span class="kwd">LEFT</span> <span class="kwd">JOIN</span> customers c <span class="kwd">ON</span> o.customer_id = c.id;

<span class="com">-- âœ… ä½¿ç”¨å°è¡¨é©±åŠ¨å¤§è¡¨ï¼ˆEXPLAIN ä¸­ type æœ€å¥½ï¼‰</span>
<span class="kwd">SELECT</span> o.*, c.name
<span class="kwd">FROM</span> customers c  <span class="com">-- å°è¡¨</span>
<span class="kwd">LEFT</span> <span class="kwd">JOIN</span> orders o <span class="kwd">ON</span> o.customer_id = c.id;

<span class="com">-- ç¡®ä¿ JOIN æ¡ä»¶æœ‰ç´¢å¼•</span>
<span class="kwd">CREATE</span> <span class="kwd">INDEX</span> idx_order_customer <span class="kwd">ON</span> orders(customer_id);
<span class="kwd">CREATE</span> <span class="kwd">INDEX</span> idx_customer_id <span class="kwd">ON</span> customers(id);

<span class="com">-- é¿å…å¤šè¡¨ JOINï¼Œé€‚å½“æ‹†åˆ†ä¸ºå¤šä¸ªæŸ¥è¯¢</span></code></pre>
                </div>

                <h4>3.5 æ‰¹é‡æ“ä½œä¼˜åŒ–</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- âŒ é€æ¡æ’å…¥ï¼ˆæ•ˆç‡ä½ï¼‰</span>
<span class="kwd">INSERT</span> <span class="kwd">INTO</span> users (name) <span class="kwd">VALUES</span> (<span class="str">'a'</span>);
<span class="kwd">INSERT</span> <span class="kwd">INTO</span> users (name) <span class="kwd">VALUES</span> (<span class="str">'b'</span>);
<span class="kwd">INSERT</span> <span class="kwd">INTO</span> users (name) <span class="kwd">VALUES</span> (<span class="str">'c'</span>);

<span class="com">-- âœ… æ‰¹é‡æ’å…¥ï¼ˆæ•ˆç‡é«˜ï¼‰</span>
<span class="kwd">INSERT</span> <span class="kwd">INTO</span> users (name) <span class="kwd">VALUES</span>
    (<span class="str">'a'</span>), (<span class="str">'b'</span>), (<span class="str">'c'</span>), (<span class="str">'d'</span>), (<span class="str">'e'</span>);

<span class="com">-- æ‰¹é‡æ’å…¥å»ºè®®æ¯æ¬¡ 1000-5000 æ¡</span>

<span class="com">-- ç¦ç”¨ç´¢å¼•åŠ é€Ÿæ‰¹é‡æ’å…¥</span>
<span class="kwd">ALTER</span> <span class="kwd">TABLE</span> users <span class="kwd">DISABLE</span> KEYS;
<span class="kwd">INSERT</span> <span class="kwd">INTO</span> users (name) <span class="kwd">VALUES</span> ...;  <span class="com">-- æ‰¹é‡æ’å…¥</span>
<span class="kwd">ALTER</span> <span class="kwd">TABLE</span> users <span class="kwd">ENABLE</span> KEYS;

<span class="com">-- ä½¿ç”¨ LOAD DATA INFILEï¼ˆæœ€å¿«ï¼‰</span>
<span class="kwd">LOAD</span> DATA INFILE <span class="str">'/path/to/file.csv'</span>
<span class="kwd">INTO</span> TABLE users
FIELDS TERMINATED BY <span class="str">','</span>
LINES TERMINATED BY <span class="str">'\n'</span>
(name);</code></pre>
                </div>
                </details>

                <h3>4. å¸¸ç”¨é…ç½®ä¼˜åŒ–</h3>

                <h4>4.1 ç¼“å†²åŒºé…ç½®</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- InnoDB ç¼“å†²æ± å¤§å°ï¼ˆå»ºè®®è®¾ç½®ä¸ºå¯ç”¨å†…å­˜çš„ 60-80%ï¼‰</span>
<span class="kwd">SET</span> GLOBAL innodb_buffer_pool_size = <span class="num">4294967296</span>;  <span class="com">-- 4GB</span>

<span class="com">-- ç¼“å†²æ± å®ä¾‹æ•°é‡ï¼ˆå¤šæ ¸CPUå»ºè®®è®¾ç½®å¤šä¸ªå®ä¾‹ï¼‰</span>
<span class="kwd">SET</span> GLOBAL innodb_buffer_pool_instances = <span class="num">4</span>;

<span class="com">-- æ—¥å¿—æ–‡ä»¶å¤§å°</span>
<span class="kwd">SET</span> GLOBAL innodb_log_file_size = <span class="num">1073741824</span>;  <span class="com">-- 1GB</span>

<span class="com">-- åˆ·æ–°æ—¥å¿—é¢‘ç‡ï¼ˆå¹³è¡¡æ€§èƒ½å’Œæ•°æ®å®‰å…¨ï¼‰</span>
<span class="kwd">SET</span> GLOBAL innodb_flush_log_at_trx_commit = <span class="num">2</span>;
<span class="com">-- 1: æ¯æ¬¡äº‹åŠ¡åˆ·æ–°ï¼ˆæœ€å®‰å…¨ï¼Œé»˜è®¤ï¼‰</span>
<span class="com">-- 2: æ¯ç§’åˆ·æ–°ï¼ˆæ€§èƒ½å¥½ï¼Œå´©æºƒå¯èƒ½ä¸¢å¤±1ç§’æ•°æ®ï¼‰</span>
<span class="com">-- 0: ä¸ç«‹å³åˆ·æ–°ï¼ˆæœ€å¿«ï¼Œå´©æºƒå¯èƒ½ä¸¢å¤±å¤§é‡æ•°æ®ï¼‰</span></code></pre>
                </div>

                <h4>4.2 è¿æ¥é…ç½®</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- æœ€å¤§è¿æ¥æ•°</span>
<span class="kwd">SET</span> GLOBAL max_connections = <span class="num">500</span>;

<span class="com">-- è¿æ¥è¶…æ—¶æ—¶é—´</span>
<span class="kwd">SET</span> GLOBAL wait_timeout = <span class="num">600</span>;  <span class="com">-- 10åˆ†é’Ÿ</span>
<span class="kwd">SET</span> GLOBAL interactive_timeout = <span class="num">600</span>;

<span class="com">-- çº¿ç¨‹ç¼“å­˜å¤§å°</span>
<span class="kwd">SET</span> GLOBAL thread_cache_size = <span class="num">50</span>;

<span class="com">-- æŸ¥è¯¢ç¼“å­˜å¤§å°</span>
<span class="kwd">SET</span> GLOBAL query_cache_size = <span class="num08864</span">671>;  <span class="com">-- 64MB</span>
<span class="kwd">SET</span> GLOBAL query_cache_limit = <span class="num">1048576</span>;  <span class="com">-- å•ä¸ªæŸ¥è¯¢æœ€å¤§1MB</span></code></pre>
                </div>

                <h4>4.3 ä¸´æ—¶è¡¨å’Œæ’åºç¼“å†²</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- ä¸´æ—¶è¡¨å¤§å°</span>
<span class="kwd">SET</span> GLOBAL tmp_table_size = <span class="num">134217728</span>;  <span class="com">-- 128MB</span>
<span class="kwd">SET</span> GLOBAL max_heap_table_size = <span class="num">134217728</span>;

<span class="com">-- æ’åºç¼“å†²å¤§å°</span>
<span class="kwd">SET</span> GLOBAL sort_buffer_size = <span class="num">4194304</span>;  <span class="com">-- 4MB</span>

<span class="com">-- è¯»å–ç¼“å†²å¤§å°</span>
<span class="kwd">SET</span> GLOBAL read_buffer_size = <span class="num">2097152</span>;  <span class="com">-- 2MB</span>
<span class="kwd">SET</span> GLOBAL read_rnd_buffer_size = <span class="num">4194304</span>;  <span class="com">-- 4MB</span>

<span class="com">-- æŸ¥çœ‹é…ç½®</span>
<span class="kwd">SHOW</span> VARIABLES LIKE <span class="str">'%buffer%'</span>;
<span class="kwd">SHOW</span> VARIABLES LIKE <span class="str">'%size%'</span>;</code></pre>
                </div>

                <h3>5. æ…¢æŸ¥è¯¢åˆ†æ</h3>

                <h4>5.1 å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—</span>
<span class="kwd">SET</span> GLOBAL slow_query_log = <span class="str">'ON'</span>;
<span class="kwd">SET</span> GLOBAL slow_query_log_file = <span class="str">'/var/log/mysql/slow.log'</span>;
<span class="kwd">SET</span> GLOBAL long_query_time = <span class="num">1</span>;  <span class="com">-- è¶…è¿‡1ç§’è®°å½•</span>
<span class="kwd">SET</span> GLOBAL log_queries_not_using_indexes = <span class="str">'ON'</span>;

<span class="com">-- æŸ¥çœ‹æ…¢æŸ¥è¯¢</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> mysql.slow_log
<span class="kwd">ORDER BY</span> start_time DESC
<span class="kwd">LIMIT</span> <span class="num">10</span>;

<span class="com">-- ä½¿ç”¨ mysqldumpslow å·¥å…·åˆ†æ</span>
<span class="com">-- mysqldumpslow -s t -t 10 /var/log/mysql/slow.log</span>
<span class="com">-- -s: æ’åºæ–¹å¼ (t=æ—¶é—´, c=æ¬¡æ•°)</span>
<span class="com">-- -t: æ˜¾ç¤ºå‰Næ¡</span></code></pre>
                </div>

                <h4>5.2 ä½¿ç”¨ EXPLAIN åˆ†æ</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- EXPLAIN åˆ†ææŸ¥è¯¢è®¡åˆ’</span>
<span class="kwd">EXPLAIN</span> <span class="kwd">SELECT</span> * <span class="kwd">FROM</span> users <span class="kwd">WHERE</span> age > <span class="num">25</span>;

<span class="com">-- å…³é”®å­—æ®µè§£è¯»ï¼š</span>
<span class="com">-- type: è¿æ¥ç±»å‹</span>
<span class="com">--   system > const > eq_ref > ref > range > index > ALL</span>
<span class="com">--   const/eq_ref/ref/range éƒ½æ˜¯å¯æ¥å—çš„</span>
<span class="com">--   ALL è¡¨ç¤ºå…¨è¡¨æ‰«æï¼Œéœ€è¦ä¼˜åŒ–</span>

<span class="com">-- key: å®é™…ä½¿ç”¨çš„ç´¢å¼•</span>
<span class="com">-- rows: é¢„è®¡æ‰«æçš„è¡Œæ•°ï¼ˆè¶Šå°è¶Šå¥½ï¼‰</span>
<span class="com">-- Extra: é¢å¤–ä¿¡æ¯</span>
<span class="com">--   Using index: ä½¿ç”¨è¦†ç›–ç´¢å¼•</span>
<span class="com">--   Using filesort: éœ€è¦é¢å¤–æ’åº</span>
<span class="com">--   Using temporary: ä½¿ç”¨ä¸´æ—¶è¡¨</span>

<span class="com">-- EXPLAIN ANALYZEï¼ˆå®é™…æ‰§è¡Œå¹¶åˆ†æï¼‰</span>
<span class="kwd">EXPLAIN</span> ANALYZE <span class="kwd">SELECT</span> * <span class="kwd">FROM</span> users <span class="kwd">WHERE</span> age > <span class="num">25</span>;</code></pre>
                </div>

                <h3>6. è¡¨ç»“æ„ä¼˜åŒ–</h3>

                <h4>6.1 é€‰æ‹©åˆé€‚çš„æ•°æ®ç±»å‹</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- âŒ ä½¿ç”¨è¿‡å¤§çš„æ•°æ®ç±»å‹</span>
<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> t1 (
    id <span class="type">INT</span>,           <span class="com">-- 4å­—èŠ‚</span>
    phone <span class="type">VARCHAR</span>(<span class="num">20</span>)
);

<span class="com">-- âœ… ä½¿ç”¨åˆé€‚çš„æ•°æ®ç±»å‹</span>
<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> t2 (
    id <span class="kwd">INT</span> <span class="kwd">UNSIGNED</span>,     <span class="com">-- æ— ç¬¦å·ï¼Œæ”¯æŒæ›´å¤§èŒƒå›´</span>
    status <span class="kwd">TINYINT</span>,        <span class="com">-- 1å­—èŠ‚ï¼ŒèŒƒå›´ -128~127</span>
    age <span class="kwd">TINYINT</span> <span class="kwd">UNSIGNED</span>, <span class="com">-- 0-255</span>
    views <span class="kwd">BIGINT</span> <span class="kwd">UNSIGNED</span>,  <span class="com">-- å¤§è®¿é—®é‡</span>
    price <span class="type">DECIMAL</span>(<span class="num">10</span>,<span class="num">2</span>)  <span class="com">-- ç²¾ç¡®ä»·æ ¼</span>
);

<span class="com">-- ä½¿ç”¨ ENUM ä»£æ›¿å­—ç¬¦ä¸²</span>
<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> orders (
    status <span class="kwd">ENUM</span>(<span class="str">'pending'</span>, <span class="str">'processing'</span>, <span class="str">'completed'</span>, <span class="str">'cancelled'</span>)
);

<span class="com">-- ä½¿ç”¨ NOT NULL</span>
<span class="com">-- NULL éœ€è¦é¢å¤–ç©ºé—´å­˜å‚¨ï¼Œä¸”å½±å“ç´¢å¼•æ•ˆç‡</span></code></pre>
                </div>

                <h4>6.2 å‚ç›´æ‹†åˆ†å’Œæ°´å¹³æ‹†åˆ†</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- å‚ç›´æ‹†åˆ†ï¼šå°†å¤§è¡¨æ‹†åˆ†ä¸ºå¤šä¸ªå°è¡¨</span>
<span class="com">-- åŸå§‹è¡¨ï¼šusers (id, name, email, avatar, bio, ...) å­—æ®µå¾ˆå¤š</span>

<span class="com">-- æ‹†åˆ†åï¼š</span>
<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> users (
    id <span class="kwd">INT</span> <span class="kwd">PRIMARY KEY</span>,
    name <span class="type">VARCHAR</span>(<span class="num">50</span>),
    email <span class="type">VARCHAR</span>(<span class="num">100</span>)
);

<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> user_profiles (
    user_id <span class="kwd">INT</span> <span class="kwd">PRIMARY KEY</span>,
    avatar <span class="type">VARCHAR</span>(<span class="num">255</span>),
    bio <span class="type">TEXT</span>,
    <span class="kwd">FOREIGN</span> <span class="kwd">KEY</span> (user_id) <span class="kwd">REFERENCES</span> users(id)
);

<span class="com">-- æ°´å¹³æ‹†åˆ†ï¼šæŒ‰æ•°æ®èŒƒå›´æˆ–å“ˆå¸Œåˆ†è¡¨</span>
<span class="com">-- æŒ‰æœˆä»½åˆ†è¡¨ï¼ˆé€‚ç”¨äºæ—¥å¿—ã€è®¢å•ç­‰ï¼‰</span>
<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> orders_202401 (
    <span class="kwd">LIKE</span> orders
);

<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> orders_202402 (
    <span class="kwd">LIKE</span> orders
);

<span class="com">-- ä½¿ç”¨åˆ†åŒºè¡¨ï¼ˆMySQL åŸç”Ÿæ”¯æŒï¼‰</span>
<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> orders_partitioned (
    id <span class="kwd">INT</span>,
    created_at <span class="type">DATE</span>,
    amount <span class="type">DECIMAL</span>(<span class="num">10</span>,<span class="num">2</span>)
) PARTITION BY <span class="kwd">RANGE</span> (YEAR(created_at)) (
    PARTITION p2023 <span class="kwd">VALUES</span> LESS THAN (<span class="num">2024</span>),
    PARTITION p2024 <span class="kwd">VALUES</span> LESS THAN (<span class="num">2025</span>),
    PARTITION pmax <span class="kwd">VALUES</span> LESS THAN <span class="kwd">MAXVALUE</span>
);</code></pre>
                </div>

                <h3>7. è¯»å†™åˆ†ç¦»ä¸è´Ÿè½½å‡è¡¡</h3>

                <h4>7.1 ä¸»ä»å¤åˆ¶é…ç½®</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- ä¸»åº“é…ç½®</span>
<span class="kwd">[mysqld]
server-id = <span class="num">1</span>
log-bin = mysql-bin
binlog-do-db = myapp

<span class="com">-- ä»åº“é…ç½®</span>
<span class="kwd">[mysqld]
server-id = <span class="num">2</span>
relay-log = relay-bin
read-only = <span class="num">1</span>

<span class="com">-- ä»åº“è®¾ç½®</span>
<span class="kwd">CHANGE</span> MASTER <span class="kwd">TO</span>
    MASTER_HOST=<span class="str">'master_host'</span>,
    MASTER_USER=<span class="str">'repl_user'</span>,
    MASTER_PASSWORD=<span class="str">'password'</span>,
    MASTER_LOG_FILE=<span class="str">'mysql-bin.000001'</span>,
    MASTER_LOG_POS=<span class="num">154</span>;

<span class="kwd">START</span> SLAVE;
<span class="kwd">SHOW</span> SLAVE STATUS\G</code></pre>
                </div>

                <h4>7.2 è¿æ¥æ± é…ç½®</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- æ¨èä½¿ç”¨è¿æ¥æ± ï¼ˆæ¨è HikariCPã€Druidï¼‰</span>
<span class="com">-- è¿æ¥æ± é…ç½®å»ºè®®ï¼š</span>

<span class="com">-- æœ€å°ç©ºé—²è¿æ¥æ•°</span>
minimum-idle = <span class="num">5</span>

<span class="com">-- æœ€å¤§è¿æ¥æ•°</span>
maximum-pool-size = <span class="num">20</span>

<span class="com">-- ç©ºé—²è¿æ¥è¶…æ—¶ï¼ˆæ¯«ç§’ï¼‰</span>
idle-timeout = <span class="num">300000</span>

<span class="com">-- è¿æ¥æœ€å¤§ç”Ÿå‘½å‘¨æœŸï¼ˆæ¯«ç§’ï¼‰</span>
max-lifetime = <span class="num">1800000</span>

<span class="com">-- è¿æ¥è¶…æ—¶ï¼ˆæ¯«ç§’ï¼‰</span>
connection-timeout = <span class="num">30000</span></code></pre>
                </div>

                <h3>3. å¹¶å‘æ§åˆ¶</h3>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- æŸ¥çœ‹å½“å‰é”æƒ…å†µ</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> performance_schema.data_locks;

<span class="com">-- è®¾ç½®äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼ˆæ”¯æŒæ–°çš„éš”ç¦»çº§åˆ«ï¼‰</span>
<span class="kwd">SET</span> TRANSACTION <span class="kwd">ISOLATION</span> <span class="kwd">LEVEL</span> READ COMMITTED;

<span class="com">-- ä¹è§‚é”ï¼ˆæ”¹è¿›çš„ç‰ˆæœ¬æ§åˆ¶ï¼‰</span>
<span class="kwd">UPDATE</span> products
<span class="kwd">SET</span> stock = stock - <span class="num">1</span>, <span class="kwd">version</span> = <span class="kwd">version</span> + <span class="num">1</span>
<span class="kwd">WHERE</span> id = <span class="num">1</span> <span class="kwd">AND</span> <span class="kwd">version</span> = <span class="num">5</span>;

<span class="com">-- æŸ¥çœ‹è¡Œé”ç­‰å¾…</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> performance_schema.events_waits_current
<span class="kwd">WHERE</span> EVENT_NAME <span class="kwd">LIKE</span> <span class="str">'%lock%'</span>;</code></pre>
                </div>

                <h3>4. æ€§èƒ½ç›‘æ§</h3>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- å®æ—¶æ€§èƒ½ç›‘æ§</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> sys.statements_with_runtimes_in_95th_percentile;

<span class="com">-- æŸ¥çœ‹æ…¢æŸ¥è¯¢ï¼ˆ<span class="kwd">AI</span> åˆ†æï¼‰</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> sys.statements_with_temp_tables
<span class="kwd">ORDER BY</span> tmp_tables DESC;

<span class="com">-- è¡¨ç©ºé—´ä½¿ç”¨æƒ…å†µ</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> information_schema.innodb_tablespaces;

<span class="com">-- <span class="kwd">AI</span> æ€§èƒ½è¯Šæ–­æŠ¥å‘Š</span>
<span class="kwd">CALL</span> sys.generate_performance_report(<span class="str">'your_database'</span>);</code></pre>
                </div>
            </div>
        </section>

        <section id="security" class="section">
            <h2>å®‰å…¨ç‰¹æ€§</h2>
            <div class="content">
                <h3>1. é›¶ä¿¡ä»»æ¶æ„</h3>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- å¯ç”¨é›¶ä¿¡ä»»æ¶æ„</span>
<span class="kwd">SET</span> GLOBAL require_secure_transport = ON;
<span class="kwd">SET</span> GLOBAL validate_password.<span class="kwd">policy</span> = STRONG;

<span class="com">-- åˆ›å»ºç”¨æˆ·ï¼ˆæ”¯æŒå¤šå› ç´ è®¤è¯ï¼‰</span>
<span class="kwd">CREATE</span> USER <span class="str">'admin'</span>@<span class="str">'%'</span> IDENTIFIED <span class="kwd">BY</span> <span class="str">'password'</span>
<span class="kwd">WITH</span> MAX_QUERIES_PER_HOUR <span class="num">1000</span>
MAX_UPDATES_PER_HOUR <span class="num">100</span>
MAX_CONNECTIONS_PER_HOUR <span class="num">100</span>
MAX_USER_CONNECTIONS <span class="num">10</span>;

<span class="com">-- å¯ç”¨ MFA</span>
<span class="kwd">ALTER</span> USER <span class="str">'admin'</span>@<span class="str">'%'</span> <span class="kwd">REQUIRE</span> MFA;

<span class="com">-- è§’è‰²ç®¡ç†ï¼ˆæ”¹è¿›çš„ RBACï¼‰</span>
<span class="kwd">CREATE</span> <span class="kwd">ROLE</span> <span class="str">'developer'</span>, <span class="str">'analyst'</span>;
GRANT <span class="kwd">SELECT</span>, <span class="kwd">INSERT</span>, <span class="kwd">UPDATE</span> <span class="kwd">ON</span> app_database.* TO <span class="str">'developer'</span>;
GRANT <span class="kwd">SELECT</span> <span class="kwd">ON</span> app_database.* TO <span class="str">'analyst'</span>;

GRANT <span class="str">'developer'</span> TO <span class="str">'user1'</span>@<span class="str">'%'</span>;
<span class="kwd">SET</span> <span class="kwd">DEFAULT</span> <span class="kwd">ROLE</span> <span class="kwd">ALL</span> TO <span class="str">'user1'</span>@<span class="str">'%'</span>;</code></pre>
                </div>

                <h3>2. æ•°æ®åŠ å¯†</h3>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- é€æ˜æ•°æ®åŠ å¯†ï¼ˆTDEï¼‰</span>
<span class="kwd">ALTER</span> INSTANCE <span class="kwd">ROTATE</span> INNODB <span class="kwd">MASTER</span> KEY;

<span class="com">-- åˆ—çº§åŠ å¯†</span>
<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> sensitive_data (
    id <span class="kwd">INT</span> <span class="kwd">AUTO_INCREMENT</span> <span class="kwd">PRIMARY KEY</span>,
    credit_card <span class="type">VARCHAR</span>(<span class="num">100</span>) <span class="kwd">ENCRYPTED</span> <span class="kwd">WITH</span> <span class="str">'AES256-CBC'</span>
);

<span class="com">-- æŸ¥è¯¢åŠ å¯†æ•°æ®ï¼ˆè‡ªåŠ¨è§£å¯†ï¼‰</span>
<span class="kwd">SELECT</span> id, <span class="func">AES_DECRYPT</span>(credit_card, <span class="str">'encryption_key'</span>) <span class="kwd">as</span> card_number
<span class="kwd">FROM</span> sensitive_data;

<span class="com">-- å®¡è®¡æ—¥å¿—ï¼ˆå¢å¼ºç‰ˆï¼‰</span>
<span class="kwd">SET</span> GLOBAL audit_log_policy = ALL;
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> performance_schema.events_statements_history_long;</code></pre>
                </div>

                <h3>3. è®¿é—®æ§åˆ¶</h3>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- åŸºäºæ—¶é—´çš„è®¿é—®æ§åˆ¶</span>
<span class="kwd">CREATE</span> USER <span class="str">'temp_user'</span>@<span class="str">'%'</span> IDENTIFIED <span class="kwd">BY</span> <span class="str">'password'</span>
<span class="kwd">WITH</span> VALID_UNTIL <span class="str">'<span class="num">2027</span>-<span class="num">12</span>-<span class="num">31</span> <span class="num">23</span>:<span class="num">59</span>:<span class="num">59</span>'</span>;

<span class="com">-- è¡Œçº§å®‰å…¨ç­–ç•¥ï¼ˆRow-<span class="kwd">Level</span> Securityï¼‰</span>
<span class="kwd">CREATE</span> <span class="kwd">POLICY</span> user_isolation <span class="kwd">ON</span> users
FOR <span class="kwd">SELECT</span>
USING (user_id = <span class="func">CURRENT_USER_ID</span>());

<span class="com">-- æŸ¥çœ‹æƒé™</span>
<span class="kwd">SHOW</span> GRANTS FOR <span class="str">'user1'</span>@<span class="str">'%'</span>;</code></pre>
                </div>
            </div>
        </section>

        <section id="ai" class="section">
            <h2>AI å¢å¼ºåŠŸèƒ½</h2>
            <div class="content">
                <h3>1. AI æŸ¥è¯¢ä¼˜åŒ–å™¨</h3>
                
                <h4>1.1 ä¼ ç»ŸæŸ¥è¯¢ä¼˜åŒ–å™¨ vs AI ä¼˜åŒ–å™¨</h4>
                <p>MySQL 9.x å¼•å…¥äº†åŸºäºæœºå™¨å­¦ä¹ çš„æŸ¥è¯¢ä¼˜åŒ–å™¨ï¼Œèƒ½å¤Ÿé€šè¿‡åˆ†æå†å²æŸ¥è¯¢æ¨¡å¼å’Œç»Ÿè®¡ä¿¡æ¯ï¼Œè‡ªåŠ¨é€‰æ‹©æœ€ä¼˜çš„æ‰§è¡Œè®¡åˆ’ã€‚</p>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- ä¼ ç»Ÿä¼˜åŒ–å™¨åŸºäºæˆæœ¬æ¨¡å‹</span>
<span class="com">-- AI ä¼˜åŒ–å™¨åŸºäºå†å²æ•°æ®å’Œé¢„æµ‹æ¨¡å‹</span>

<span class="com">-- å¯ç”¨ AI ä¼˜åŒ–å™¨</span>
<span class="kwd">SET</span> GLOBAL optimizer_switch = <span class="str">'ai_optimization=on'</span>;

<span class="com">-- æŸ¥çœ‹å½“å‰ä¼˜åŒ–å™¨è®¾ç½®</span>
<span class="kwd">SHOW</span> VARIABLES LIKE <span class="str">'optimizer_switch'</span>;

<span class="com">-- ä¸ºç‰¹å®šæŸ¥è¯¢å¯ç”¨ AI ä¼˜åŒ–</span>
<span class="kwd">SELECT</span> /*+ AI_OPTIMIZE */ *
<span class="kwd">FROM</span> orders o
<span class="kwd">JOIN</span> customers c <span class="kwd">ON</span> o.customer_id = c.id
<span class="kwd">WHERE</span> o.created_at > <span class="str">'2024-01-01'</span>
<span class="kwd">ORDER BY</span> o.total_amount DESC
<span class="kwd">LIMIT</span> <span class="num">100</span>;</code></pre>
                </div>

                <h4>1.2 AI ä¼˜åŒ–å™¨å·¥ä½œåŸç†</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- AI ä¼˜åŒ–å™¨çš„å·¥ä½œæµç¨‹ï¼š</span>
<span class="com">-- 1. æ”¶é›†å†å²æŸ¥è¯¢æ‰§è¡Œæ•°æ®</span>
<span class="com">-- 2. æ„å»ºæŸ¥è¯¢ç‰¹å¾æ¨¡å‹</span>
<span class="com">-- 3. é¢„æµ‹ä¸åŒæ‰§è¡Œè®¡åˆ’çš„æˆæœ¬</span>
<span class="com">-- 4. é€‰æ‹©æœ€ä¼˜æ‰§è¡Œè®¡åˆ’</span>

<span class="com">-- æŸ¥çœ‹ AI ä¼˜åŒ–å™¨çš„åˆ†æç»“æœ</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> sys.ai_query_analysis
<span class="kwd">WHERE</span> query_time > <span class="func">NOW</span>() - INTERVAL <span class="num">1</span> DAY
<span class="kwd">ORDER BY</span> execution_time DESC;

<span class="com">-- æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’é¢„æµ‹</span>
<span class="kwd">EXPLAIN</span> ANALYZE <span class="kwd">SELECT</span> * <span class="kwd">FROM</span> users <span class="kwd">WHERE</span> age > <span class="num">25</span>;

<span class="com">-- AI ä¼˜åŒ–çš„ç»Ÿè®¡ä¿¡æ¯</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> sys.ai_optimizer_stats;</code></pre>
                </div>

                <details>
                    <summary>2. æœºå™¨å­¦ä¹ é›†æˆï¼ˆç‚¹å‡»å±•å¼€ï¼‰</summary>

                <h4>2.1 å†…ç½® ML æ¨¡å‹</h4>
                <p>MySQL 9.x æ”¯æŒç›´æ¥åœ¨æ•°æ®åº“ä¸­åˆ›å»ºã€è®­ç»ƒå’Œä½¿ç”¨æœºå™¨å­¦ä¹ æ¨¡å‹ï¼Œå®ç°ç«¯åˆ°ç«¯çš„ ML å·¥ä½œæµã€‚</p>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- æŸ¥çœ‹æ”¯æŒçš„ ML ç®—æ³•</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> sys.ml_available_algorithms;

<span class="com">-- åˆ›å»ºè®­ç»ƒæ•°æ®è¡¨</span>
<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> customer_features (
    customer_id <span class="kwd">INT PRIMARY KEY</span>,
    age <span class="kwd">INT</span>,
    income <span class="kwd">DECIMAL</span>(<span class="num">10</span>,<span class="num">2</span>),
    purchase_frequency <span class="kwd">INT</span>,
    avg_order_value <span class="kwd">DECIMAL</span>(<span class="num">10</span>,<span class="num">2</span>),
    days_since_last_purchase <span class="kwd">INT</span>,
    churn_label <span class="kwd">TINYINT</span>  <span class="com">-- ç›®æ ‡å˜é‡ï¼š1=æµå¤±ï¼Œ0=ç•™å­˜</span>
);

<span class="com">-- åˆ›å»ºæœºå™¨å­¦ä¹ æ¨¡å‹</span>
<span class="kwd">CREATE</span> ML <span class="kwd">MODEL</span> customer_churn_model
<span class="kwd">FROM</span> customer_features
FEATURES (age, income, purchase_frequency, avg_order_value, days_since_last_purchase)
TARGET (churn_label)
ALGORITHM <span class="str">'gradient_boosting'</span>
OPTIONS (
    n_estimators = <span class="num">100</span>,
    max_depth = <span class="num">5</span>,
    learning_rate = <span class="num">0.1</span>
);</code></pre>
                </div>

                <h4>2.2 æ¨¡å‹é¢„æµ‹</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- ä½¿ç”¨æ¨¡å‹è¿›è¡Œé¢„æµ‹</span>
<span class="kwd">SELECT</span> 
    customer_id,
    <span class="func">PREDICT</span>(customer_churn_model <span class="kwd">USING</span> 
        age, income, purchase_frequency, avg_order_value, days_since_last_purchase
    ) <span class="kwd">as</span> churn_probability,
    <span class="kwd">CASE</span>
        WHEN <span class="func">PREDICT</span>(...) > <span class="num">0.7</span> THEN <span class="str">'é«˜é£é™©'</span>
        WHEN <span class="func">PREDICT</span>(...) > <span class="num">0.3</span> THEN <span class="str">'ä¸­é£é™©'</span>
        <span class="kwd">ELSE</span> <span class="str">'ä½é£é™©'</span>
    <span class="kwd">END</span> <span class="kwd">as</span> risk_level
<span class="kwd">FROM</span> customer_features
<span class="kwd">WHERE</span> churn_label <span class="kwd">IS</span> NULL;

<span class="com">-- æ‰¹é‡é¢„æµ‹å¹¶æ›´æ–°è¡¨</span>
<span class="kwd">UPDATE</span> customer_features
<span class="kwd">SET</span> predicted_churn = 
    <span class="func">PREDICT</span>(customer_churn_model <span class="kwd">USING</span> age, income, purchase_frequency, avg_order_value, days_since_last_purchase)
<span class="kwd">WHERE</span> churn_label <span class="kwd">IS</span> NULL;

<span class="com">-- æ¨¡å‹è¯„ä¼°</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> sys.ml_model_evaluation
<span class="kwd">WHERE</span> model_name = <span class="str">'customer_churn_model'</span>;</code></pre>
                </div>

                <h4>2.3 æ¨¡å‹ç®¡ç†</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- æŸ¥çœ‹æ‰€æœ‰æ¨¡å‹</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> sys.ml_models;

<span class="com">-- æŸ¥çœ‹æ¨¡å‹è¯¦ç»†ä¿¡æ¯</span>
<span class="kwd">DESCRIBE</span> ML <span class="kwd">MODEL</span> customer_churn_model;

<span class="com">-- é‡æ–°è®­ç»ƒæ¨¡å‹</span>
<span class="kwd">ALTER</span> ML <span class="kwd">MODEL</span> customer_churn_model
RETRAIN <span class="kwd">FROM</span> customer_features
FEATURES (age, income, purchase_frequency, avg_order_value, days_since_last_purchase)
TARGET (churn_label);

<span class="com">-- å¯¼å‡ºæ¨¡å‹</span>
<span class="kwd">EXPORT</span> ML <span class="kwd">MODEL</span> customer_churn_model
<span class="kwd">TO</span> <span class="str">'/backup/models/'</span>;

<span class="com">-- å¯¼å…¥æ¨¡å‹</span>
<span class="kwd">IMPORT</span> ML <span class="kwd">MODEL</span> customer_churn_model_new
<span class="kwd">FROM</span> <span class="str">'/backup/models/customer_churn_model'</span>;

<span class="com">-- åˆ é™¤æ¨¡å‹</span>
<span class="kwd">DROP</span> ML <span class="kwd">MODEL</span> customer_churn_model;</code></pre>
                </div>
                </details>

                <h3>3. å‘é‡æœç´¢ä¸è¯­ä¹‰æŸ¥è¯¢</h3>
                
                <h4>3.1 å‘é‡ç´¢å¼•</h4>
                <p>MySQL 9.x åŸç”Ÿæ”¯æŒå‘é‡æ•°æ®ç±»å‹å’Œå‘é‡ç´¢å¼•ï¼Œå¯ç”¨äºè¯­ä¹‰æœç´¢ã€ç›¸ä¼¼åº¦åŒ¹é…ç­‰ AI åº”ç”¨åœºæ™¯ã€‚</p>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- åˆ›å»ºåŒ…å«å‘é‡åˆ—çš„è¡¨</span>
<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> documents (
    id <span class="kwd">INT PRIMARY KEY</span>,
    title <span class="type">VARCHAR</span>(<span class="num">255</span>),
    content <span class="type">TEXT</span>,
    embedding <span class="type">VECTOR</span>(<span class="num">768</span>),  <span class="com">-- 768ç»´å‘é‡ï¼ˆæ”¯æŒ BERT ç­‰æ¨¡å‹ï¼‰</span>
    <span class="kwd">INDEX</span> idx_embedding (embedding) <span class="kwd">USING</span> HNSW
);

<span class="com">-- æ’å…¥å¸¦å‘é‡çš„æ•°æ®</span>
<span class="kwd">INSERT</span> <span class="kwd">INTO</span> documents (id, title, content, embedding)
<span class="kwd">VALUES</span> (
    <span class="num">1</span>, 
    <span class="str">'MySQL æ•™ç¨‹'</span>, 
    <span class="str">'MySQL æ˜¯ä¸€ç§å…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ...'</span>,
    <span class="str">'[0.12, -0.34, 0.56, ...]'</span>  <span class="com">-- å®é™…ä½¿ç”¨ embedding ç”Ÿæˆå·¥å…·</span>
);

<span class="com">-- åˆ›å»ºå‘é‡ç´¢å¼•ï¼ˆHNSW ç®—æ³•ï¼‰</span>
<span class="kwd">ALTER</span> <span class="kwd">TABLE</span> documents 
ADD <span class="kwd">INDEX</span> idx_vector (embedding) <span class="kwd">USING</span> HNSW
OPTIONS (m = <span class="num">16</span>, ef_construction = <span class="num">200</span>);</code></pre>
                </div>

                <h4>3.2 å‘é‡ç›¸ä¼¼åº¦æœç´¢</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- å‘é‡è·ç¦»è®¡ç®—å‡½æ•°ï¼š</span>
<span class="com">-- VECTOR_DISTANCE(v1, v2, 'cosine') - ä½™å¼¦ç›¸ä¼¼åº¦</span>
<span class="com">-- VECTOR_DISTANCE(v1, v2, 'euclidean') - æ¬§æ°è·ç¦»</span>
<span class="com">-- VECTOR_DISTANCE(v1, v2, 'dot_product') - ç‚¹ç§¯</span>

<span class="com">-- æŸ¥æ‰¾æœ€ç›¸ä¼¼çš„æ–‡æ¡£</span>
<span class="kwd">SELECT</span> id, title, 
    <span class="func">VECTOR_DISTANCE</span>(embedding, <span class="str">'[0.12, -0.34, 0.56, ...]'</span>, <span class="str">'cosine'</span>) <span class="kwd">as</span> distance
<span class="kwd">FROM</span> documents
<span class="kwd">ORDER BY</span> distance
<span class="kwd">LIMIT</span> <span class="num">5</span>;

<span class="com">-- ä½¿ç”¨å‘é‡ç´¢å¼•åŠ é€Ÿæœç´¢ï¼ˆè¿‘ä¼¼æœ€è¿‘é‚»ï¼‰</span>
<span class="kwd">SELECT</span> id, title,
    <span class="func">VECTOR_DISTANCE</span>(embedding, <span class="str">'[query_vector]'</span>, <span class="str">'cosine'</span>) <span class="kwd">as</span> distance
<span class="kwd">FROM</span> documents
<span class="kwd">ORDER BY</span> distance
<span class="kwd">LIMIT</span> <span class="num">10</span>;

<span class="com">-- è¿‡æ»¤æ¡ä»¶ + å‘é‡æœç´¢</span>
<span class="kwd">SELECT</span> id, title
<span class="kwd">FROM</span> documents
<span class="kwd">WHERE</span> category = <span class="str">'æ•°æ®åº“'</span>
<span class="kwd">ORDER BY</span> <span class="func">VECTOR_DISTANCE</span>(embedding, <span class="str">'[query_vector]'</span>, <span class="str">'cosine'</span>)
<span class="kwd">LIMIT</span> <span class="num">5</span>;</code></pre>
                </div>

                <h3>4. è‡ªç„¶è¯­è¨€æŸ¥è¯¢</h3>
                
                <h4>4.1 NL2SQL è½¬æ¢</h4>
                <p>é€šè¿‡è‡ªç„¶è¯­è¨€å¤„ç†æŠ€æœ¯ï¼Œå°†è‡ªç„¶è¯­è¨€æŸ¥è¯¢è½¬æ¢ä¸ºä¼˜åŒ–çš„ SQL è¯­å¥ã€‚</p>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- ä½¿ç”¨è‡ªç„¶è¯­è¨€æŸ¥è¯¢</span>
<span class="kwd">CALL</span> sys.natural_language_query(
    <span class="str">'æŸ¥æ‰¾2024å¹´é”€å”®é¢è¶…è¿‡10000å…ƒçš„å®¢æˆ·'</span>
);

<span class="com">-- AI ç”Ÿæˆçš„ SQL ç¤ºä¾‹ï¼š</span>
<span class="com">-- SELECT c.name, SUM(o.total_amount) as total_sales</span>
<span class="com">-- FROM customers c</span>
<span class="com">-- JOIN orders o ON c.id = o.customer_id</span>
<span class="com">-- WHERE YEAR(o.order_date) = 2024</span>
<span class="com">-- GROUP BY c.id, c.name</span>
<span class="com">-- HAVING SUM(o.total_amount) > 10000</span>

<span class="com">-- è‡ªç„¶è¯­è¨€æŸ¥è¯¢å¤æ‚é—®é¢˜</span>
<span class="kwd">SELECT</span> <span class="func">NL</span>(<span class="str">'å“ªäº›äº§å“çš„æœˆé”€é‡å‘ˆä¸‹é™è¶‹åŠ¿ï¼Ÿ'</span>);

<span class="com">-- æŸ¥çœ‹å†å²è‡ªç„¶è¯­è¨€æŸ¥è¯¢</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> sys.nl_query_history
<span class="kwd">ORDER BY</span> query_time DESC
<span class="kwd">LIMIT</span> <span class="num">20</span>;</code></pre>
                </div>

                <h4>4.2 æŸ¥è¯¢è§£é‡Šä¸ä¼˜åŒ–å»ºè®®</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- AI è§£é‡ŠæŸ¥è¯¢æ„å›¾</span>
<span class="kwd">SELECT</span> sys.explain_query(
    <span class="str">'SELECT * FROM orders WHERE status = "pending"'</span>
) <span class="kwd">as</span> explanation;

<span class="com">-- è·å–æ€§èƒ½ä¼˜åŒ–å»ºè®®</span>
<span class="kwd">SELECT</span> sys.get_optimization_suggestions(
    <span class="str">'SELECT o.*, c.name FROM orders o JOIN customers c ON o.customer_id = c.id'</span>
);

<span class="com">-- SQL è¯­å¥æ”¹å†™å»ºè®®</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> sys.query_rewrites
<span class="kwd">WHERE</span> original_query LIKE <span class="str">'%orders%'</span>;</code></pre>
                </div>

                <h3>5. æ™ºèƒ½å¼‚å¸¸æ£€æµ‹</h3>
                
                <h4>5.1 æ•°æ®å¼‚å¸¸æ£€æµ‹</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- é…ç½®å¼‚å¸¸æ£€æµ‹</span>
<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> anomaly_detection_config (
    table_name <span class="type">VARCHAR</span>(<span class="num">64</span>),
    column_name <span class="type">VARCHAR</span>(<span class="num">64</span>),
    detection_method <span class="type">VARCHAR</span>(<span class="num">20</span>),  <span class="com">-- 'statistical', 'ml', 'isolation_forest'</span>
    sensitivity <span class="kwd">DECIMAL</span>(<span class="num">3</span>,<span class="num">2</span>)  <span class="com">-- 0.0-1.0</span>
);

<span class="com">-- ä¸ºç”¨æˆ·è¡¨å¯ç”¨å¼‚å¸¸æ£€æµ‹</span>
<span class="kwd">INSERT</span> <span class="kwd">INTO</span> anomaly_detection_config
<span class="kwd">VALUES</span> (<span class="str">'users'</span>, <span class="str">'age'</span>, <span class="str">'isolation_forest'</span>, <span class="num">0.8</span>);

<span class="com">-- æ‰‹åŠ¨è§¦å‘å¼‚å¸¸æ£€æµ‹</span>
<span class="kwd">CALL</span> sys.detect_data_anomalies(<span class="str">'users'</span>);

<span class="com">-- æŸ¥çœ‹æ£€æµ‹åˆ°çš„å¼‚å¸¸</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> sys.detected_anomalies
<span class="kwd">WHERE</span> table_name = <span class="str">'users'</span>
<span class="kwd">AND</span> detected_at > <span class="func">NOW</span>() - INTERVAL <span class="num">1</span> DAY;</code></pre>
                </div>

                <h4>5.2 æ€§èƒ½å¼‚å¸¸æ£€æµ‹</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- å¯ç”¨æ€§èƒ½å¼‚å¸¸æ£€æµ‹</span>
<span class="kwd">SET</span> GLOBAL performance_anomaly_detection = <span class="str">'ON'</span>;

<span class="com">-- é…ç½®æ€§èƒ½æŒ‡æ ‡é˜ˆå€¼</span>
<span class="kwd">CREATE</span> <span class="kwd">EVENT</span> hourly_performance_check
<span class="kwd">ON</span> <span class="kwd">SCHEDULE</span> <span class="kwd">EVERY</span> <span class="num">1</span> <span class="kwd">HOUR</span>
DO
<span class="kwd">BEGIN</span>
    <span class="kwd">CALL</span> sys.detect_performance_anomalies();
    <span class="kwd">CALL</span> sys.detect_slow_queries();
<span class="kwd">END</span>;

<span class="com">-- æŸ¥çœ‹æ€§èƒ½å¼‚å¸¸</span>
<span class="kwd">SELECT</span> 
    <span class="kwd">timestamp</span>,
    metric_name,
    expected_value,
    actual_value,
    anomaly_score
<span class="kwd">FROM</span> sys.performance_anomalies
<span class="kwd">WHERE</span> <span class="kwd">timestamp</span> > <span class="func">NOW</span>() - INTERVAL <span class="num">24</span> HOURS
<span class="kwd">ORDER BY</span> anomaly_score DESC;

<span class="com">-- å¼‚å¸¸è‡ªåŠ¨å‘Šè­¦</span>
<span class="kwd">CREATE</span> <span class="kwd">TRIGGER</span> performance_anomaly_alert
<span class="kwd">AFTER</span> <span class="kwd">INSERT</span> <span class="kwd">ON</span> sys.performance_anomalies
<span class="kwd">FOR</span> <span class="kwd">EACH</span> <span class="kwd">ROW</span>
<span class="kwd">BEGIN</span>
    <span class="kwd">IF</span> NEW.anomaly_score > <span class="num">0.9</span> <span class="kwd">THEN</span>
        <span class="kwd">INSERT</span> <span class="kwd">INTO</span> alert_log <span class="kwd">VALUES</span>(NEW.<span class="kwd">timestamp</span>, NEW.metric_name);
    <span class="kwd">END</span> <span class="kwd">IF</span>;
<span class="kwd">END</span>;</code></pre>
                </div>

                <h3>6. æ™ºèƒ½ç´¢å¼•æ¨è</h3>
                
                <h4>6.1 è‡ªåŠ¨ç´¢å¼•åˆ†æ</h4>
                <div class="code-block">
                    <pre><span class="com">-- å¼€å¯æŸ¥è¯¢åˆ†ææ”¶é›†</span>
<span class="kwd">SET</span> GLOBAL optimizer_trace = <span class="str">'enabled=on'</span>;
<span class="kwd">SET</span> GLOBAL performance_schema = <span class="str">'ON'</span>;

<span class="com">-- è¿è¡Œä¸€æ®µæ—¶é—´åï¼Œåˆ†ææŸ¥è¯¢æ¨¡å¼</span>
<span class="kwd">CALL</span> sys.analyze_workload(<span class="str">'your_database'</span>);

<span class="com">-- æŸ¥çœ‹ç´¢å¼•æ¨è</span>
<span class="kwd">SELECT</span> 
    table_name,
    suggested_index,
    columns,
    potential_improvement,
    estimated_size
<span class="kwd">FROM</span> sys.index_recommendations
<span class="kwd">WHERE</span> table_schema = <span class="str">'your_database'</span>
<span class="kwd">ORDER BY</span> potential_improvement DESC;</code></pre>
                </div>

                <h4>6.2 è‡ªåŠ¨åº”ç”¨ç´¢å¼•</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- é¢„è§ˆç´¢å¼•åˆ›å»ºè¯­å¥</span>
<span class="kwd">SELECT</span> create_index_statement
<span class="kwd">FROM</span> sys.index_recommendations
<span class="kwd">WHERE</span> table_name = <span class="str">'orders'</span>
<span class="kwd">AND</span> recommended_index = <span class="str">'idx_customer_date'</span>;

<span class="com">-- æ‰‹åŠ¨åº”ç”¨æ¨èç´¢å¼•</span>
<span class="kwd">CALL</span> sys.apply_index_recommendation(
    <span class="str">'orders'</span>, 
    <span class="str">'idx_customer_date'</span>
);

<span class="com">-- è‡ªåŠ¨åº”ç”¨å®‰å…¨ç´¢å¼•ï¼ˆå¯å¿«é€Ÿå›æ»šï¼‰</span>
<span class="kwd">CALL</span> sys.apply_recommended_indexes(
    <span class="str">'your_database'</span>,
    <span class="str">'auto'</span>,
    <span class="num">1000</span>  <span class="com">-- æœ€å¤§å½±å“è¡Œæ•°é˜ˆå€¼</span>
);

<span class="com">-- å›æ»šç´¢å¼•å˜æ›´</span>
<span class="kwd">CALL</span> sys.rollback_index_change(<span class="str">'idx_customer_date'</span>, <span class="str">'orders'</span>);</code></pre>
                </div>

                <h3>7. AI è¾…åŠ©è¿ç»´</h3>
                
                <h4>7.1 æ™ºèƒ½ç›‘æ§ä»ªè¡¨ç›˜</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- æŸ¥çœ‹ AI å¥åº·çŠ¶æ€æŠ¥å‘Š</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> sys.ai_health_check\G

<span class="com">-- AI ç”Ÿæˆçš„ä¼˜åŒ–å»ºè®®</span>
<span class="kwd">SELECT</span> 
    category,
    issue,
    recommendation,
    priority,
    estimated_impact
<span class="kwd">FROM</span> sys.ai_recommendations
<span class="kwd">WHERE</span> status = <span class="str">'pending'</span>
<span class="kwd">ORDER BY</span> priority DESC;

<span class="com">-- è‡ªåŠ¨æ€§èƒ½è°ƒä¼˜</span>
<span class="kwd">CALL</span> sys.auto_tune(<span class="str">'your_database'</span>);

<span class="com">-- æŸ¥çœ‹è°ƒä¼˜å†å²</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> sys.auto_tune_history
<span class="kwd">WHERE</span> tuned_at > <span class="func">NOW</span>() - INTERVAL <span class="num">7</span> DAY;</code></pre>
                </div>

                <h4>7.2 å®¹é‡é¢„æµ‹</h4>
                <div class="code-block">
                    <pre><code class="sql"><span class="com">-- å­˜å‚¨å®¹é‡é¢„æµ‹</span>
<span class="kwd">SELECT</span> 
    table_name,
    current_size_mb,
    predicted_size_30d,
    predicted_size_90d,
    days_until_full
<span class="kwd">FROM</span> sys.capacity_predictions
<span class="kwd">WHERE</span> table_schema = <span class="str">'your_database'</span>;

<span class="com">-- æ€§èƒ½è¶‹åŠ¿é¢„æµ‹</span>
<span class="kwd">SELECT</span> 
    metric_name,
    current_value,
    predicted_value_7d,
    trend
<span class="kwd">FROM</span> sys.performance_predictions;

<span class="com">-- åŸºäºé¢„æµ‹è‡ªåŠ¨æ‰©å®¹å»ºè®®</span>
<span class="kwd">SELECT</span> * <span class="kwd">FROM</span> sys.scaling_recommendations
<span class="kwd">WHERE</span> recommendation_type = <span class="str">'storage'</span>;</code></pre>
                </div>
            </div>
        </section>

        <section id="practice" class="section">
            <h2>å®æˆ˜ç»ƒä¹ </h2>
            <div class="content">
                <div class="practice-project">
                    <h3>é¡¹ç›®ä¸€ï¼šåšå®¢ç®¡ç†ç³»ç»Ÿ</h3>
                    <p>æ„å»ºä¸€ä¸ªç®€å•çš„åšå®¢ç®¡ç†ç³»ç»Ÿï¼ŒåŒ…å«ç”¨æˆ·ã€æ–‡ç« ã€è¯„è®ºç­‰åŠŸèƒ½ã€‚</p>

                    <details>
                        <summary>æŸ¥çœ‹å®Œæ•´ä»£ç </summary>
                        <div class="code-block">
                            <pre><code class="sql"><span class="com">-- åˆ›å»ºæ•°æ®åº“</span>
<span class="kwd">CREATE</span> <span class="kwd">DATABASE</span> blog_system;
<span class="kwd">USE</span> blog_system;

<span class="com">-- ç”¨æˆ·è¡¨</span>
<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> users (
    id <span class="kwd">INT</span> <span class="kwd">AUTO_INCREMENT</span> <span class="kwd">PRIMARY KEY</span>,
    username <span class="type">VARCHAR</span>(<span class="num">50</span>) <span class="kwd"><span class="kwd">NOT</span> NULL</span> <span class="kwd">UNIQUE</span>,
    <span class="kwd">password</span> <span class="type">VARCHAR</span>(<span class="num">255</span>) <span class="kwd"><span class="kwd">NOT</span> NULL</span>,
    email <span class="type">VARCHAR</span>(<span class="num">100</span>) <span class="kwd"><span class="kwd">NOT</span> NULL</span> <span class="kwd">UNIQUE</span>,
    created_at <span class="kwd">TIMESTAMP</span> <span class="kwd">DEFAULT</span> <span class="kwd">CURRENT_TIMESTAMP</span>
);

<span class="com">-- åˆ†ç±»è¡¨</span>
<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> categories (
    id <span class="kwd">INT</span> <span class="kwd">AUTO_INCREMENT</span> <span class="kwd">PRIMARY KEY</span>,
    name <span class="type">VARCHAR</span>(<span class="num">50</span>) <span class="kwd"><span class="kwd">NOT</span> NULL</span>,
    description <span class="kwd">TEXT</span>
);

<span class="com">-- æ–‡ç« è¡¨</span>
<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> posts (
    id <span class="kwd">INT</span> <span class="kwd">AUTO_INCREMENT</span> <span class="kwd">PRIMARY KEY</span>,
    title <span class="type">VARCHAR</span>(<span class="num">200</span>) <span class="kwd"><span class="kwd">NOT</span> NULL</span>,
    content <span class="kwd">TEXT</span> <span class="kwd"><span class="kwd">NOT</span> NULL</span>,
    author_id <span class="kwd">INT</span> <span class="kwd"><span class="kwd">NOT</span> NULL</span>,
    category_id <span class="type">INT</span>,
    views <span class="kwd">INT</span> <span class="kwd">DEFAULT</span> <span class="num">0</span>,
    <span class="kwd">status</span> <span class="type">ENUM</span>(<span class="str">'draft'</span>, <span class="str">'published'</span>, <span class="str">'archived'</span>) <span class="kwd">DEFAULT</span> <span class="str">'draft'</span>,
    created_at <span class="kwd">TIMESTAMP</span> <span class="kwd">DEFAULT</span> <span class="kwd">CURRENT_TIMESTAMP</span>,
    updated_at <span class="kwd">TIMESTAMP</span> <span class="kwd">DEFAULT</span> <span class="kwd">CURRENT_TIMESTAMP</span> <span class="kwd">ON</span> <span class="kwd">UPDATE</span> <span class="kwd">CURRENT_TIMESTAMP</span>,
    <span class="kwd">FOREIGN KEY</span> (author_id) <span class="kwd">REFERENCES</span> users(id) <span class="kwd">ON</span> <span class="kwd">DELETE</span> <span class="kwd">CASCADE</span>,
    <span class="kwd">FOREIGN KEY</span> (category_id) <span class="kwd">REFERENCES</span> categories(id) <span class="kwd">ON</span> <span class="kwd">DELETE</span> <span class="kwd">SET</span> <span class="kwd">NULL</span>
);

<span class="com">-- è¯„è®ºè¡¨</span>
<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> comments (
    id <span class="kwd">INT</span> <span class="kwd">AUTO_INCREMENT</span> <span class="kwd">PRIMARY KEY</span>,
    post_id <span class="kwd">INT</span> <span class="kwd"><span class="kwd">NOT</span> NULL</span>,
    user_id <span class="kwd">INT</span> <span class="kwd"><span class="kwd">NOT</span> NULL</span>,
    content <span class="kwd">TEXT</span> <span class="kwd"><span class="kwd">NOT</span> NULL</span>,
    created_at <span class="kwd">TIMESTAMP</span> <span class="kwd">DEFAULT</span> <span class="kwd">CURRENT_TIMESTAMP</span>,
    <span class="kwd">FOREIGN KEY</span> (post_id) <span class="kwd">REFERENCES</span> posts(id) <span class="kwd">ON</span> <span class="kwd">DELETE</span> <span class="kwd">CASCADE</span>,
    <span class="kwd">FOREIGN KEY</span> (user_id) <span class="kwd">REFERENCES</span> users(id) <span class="kwd">ON</span> <span class="kwd">DELETE</span> <span class="kwd">CASCADE</span>
);

<span class="com">-- æ’å…¥ç¤ºä¾‹æ•°æ®</span>
<span class="kwd">INSERT</span> <span class="kwd">INTO</span> categories (name, description) <span class="kwd">VALUES</span>
    (<span class="str">'æŠ€æœ¯'</span>, <span class="str">'æŠ€æœ¯ç›¸å…³æ–‡ç« '</span>),
    (<span class="str">'ç”Ÿæ´»'</span>, <span class="str">'ç”Ÿæ´»åˆ†äº«'</span>),
    (<span class="str">'å­¦ä¹ '</span>, <span class="str">'å­¦ä¹ ç¬”è®°'</span>);

<span class="kwd">INSERT</span> <span class="kwd">INTO</span> users (username, <span class="kwd">password</span>, email) <span class="kwd">VALUES</span>
    (<span class="str">'admin'</span>, <span class="str">'hashed_password'</span>, <span class="str">'admin@example.com'</span>),
    (<span class="str">'zhangsan'</span>, <span class="str">'hashed_password'</span>, <span class="str">'zhangsan@example.com'</span>);

<span class="kwd">INSERT</span> <span class="kwd">INTO</span> posts (title, content, author_id, category_id, <span class="kwd">status</span>) <span class="kwd">VALUES</span>
    (<span class="str">'MySQL å…¥é—¨æ•™ç¨‹'</span>, <span class="str">'è¿™æ˜¯ MySQL å…¥é—¨æ•™ç¨‹çš„å†…å®¹...'</span>, <span class="num">1</span>, <span class="num">1</span>, <span class="str">'published'</span>),
    (<span class="str">'å­¦ä¹ ç¬”è®°'</span>, <span class="str">'ä»Šå¤©å­¦ä¹ äº†æ•°æ®åº“åŸºç¡€çŸ¥è¯†'</span>, <span class="num">2</span>, <span class="num">3</span>, <span class="str">'published'</span>);

<span class="kwd">INSERT</span> <span class="kwd">INTO</span> comments (post_id, user_id, content) <span class="kwd">VALUES</span>
    (<span class="num">1</span>, <span class="num">2</span>, <span class="str">'å¾ˆå¥½çš„æ•™ç¨‹ï¼Œå­¦åˆ°äº†å¾ˆå¤šï¼'</span>),
    (<span class="num">2</span>, <span class="num">1</span>, <span class="str">'ç»§ç»­åŠ æ²¹ï¼'</span>);</code></pre>
                                </div>
                    </details>
                </div>

                <div class="practice-project">
                    <h3>é¡¹ç›®äºŒï¼šç”µå•†è®¢å•ç³»ç»Ÿ</h3>
                    <p>è®¾è®¡ä¸€ä¸ªç”µå•†è®¢å•ç³»ç»Ÿï¼ŒåŒ…å«å•†å“ã€è®¢å•ã€è®¢å•è¯¦æƒ…ç­‰è¡¨ã€‚</p>

                    <details>
                        <summary>æŸ¥çœ‹å®Œæ•´ä»£ç </summary>
                        <div class="code-block">
                            <pre><code class="sql"><span class="com">-- åˆ›å»ºæ•°æ®åº“</span>
<span class="kwd">CREATE</span> <span class="kwd">DATABASE</span> ecommerce;
<span class="kwd">USE</span> ecommerce;

<span class="com">-- å•†å“è¡¨</span>
<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> products (
    id <span class="kwd">INT</span> <span class="kwd">AUTO_INCREMENT</span> <span class="kwd">PRIMARY KEY</span>,
    name <span class="type">VARCHAR</span>(<span class="num">200</span>) <span class="kwd"><span class="kwd">NOT</span> NULL</span>,
    description <span class="type">TEXT</span>,
    price <span class="type">DECIMAL</span>(<span class="num">10</span>, <span class="num">2</span>) <span class="kwd"><span class="kwd">NOT</span> NULL</span>,
    stock <span class="kwd">INT</span> <span class="kwd">DEFAULT</span> <span class="num">0</span>,
    category <span class="type">VARCHAR</span>(<span class="num">50</span>),
    created_at <span class="kwd">TIMESTAMP</span> <span class="kwd">DEFAULT</span> <span class="kwd">CURRENT_TIMESTAMP</span>
);

<span class="com">-- ç”¨æˆ·è¡¨</span>
<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> customers (
    id <span class="kwd">INT</span> <span class="kwd">AUTO_INCREMENT</span> <span class="kwd">PRIMARY KEY</span>,
    username <span class="type">VARCHAR</span>(<span class="num">50</span>) <span class="kwd"><span class="kwd">NOT</span> NULL</span> <span class="kwd">UNIQUE</span>,
    email <span class="type">VARCHAR</span>(<span class="num">100</span>) <span class="kwd"><span class="kwd">NOT</span> NULL</span> <span class="kwd">UNIQUE</span>,
    phone <span class="type">VARCHAR</span>(<span class="num">20</span>),
    address <span class="type">TEXT</span>,
    created_at <span class="kwd">TIMESTAMP</span> <span class="kwd">DEFAULT</span> <span class="kwd">CURRENT_TIMESTAMP</span>
);

<span class="com">-- è®¢å•è¡¨</span>
<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> orders (
    id <span class="kwd">INT</span> <span class="kwd">AUTO_INCREMENT</span> <span class="kwd">PRIMARY KEY</span>,
    customer_id <span class="kwd">INT</span> <span class="kwd"><span class="kwd">NOT</span> NULL</span>,
    total_amount <span class="type">DECIMAL</span>(<span class="num">10</span>, <span class="num">2</span>) <span class="kwd"><span class="kwd">NOT</span> NULL</span>,
    <span class="kwd">status</span> <span class="type">ENUM</span>(<span class="str">'pending'</span>, <span class="str">'confirmed'</span>, <span class="str">'shipped'</span>, <span class="str">'delivered'</span>, <span class="str">'cancelled'</span>) <span class="kwd">DEFAULT</span> <span class="str">'pending'</span>,
    order_date <span class="kwd">TIMESTAMP</span> <span class="kwd">DEFAULT</span> <span class="kwd">CURRENT_TIMESTAMP</span>,
    <span class="kwd">FOREIGN KEY</span> (customer_id) <span class="kwd">REFERENCES</span> customers(id)
);

<span class="com">-- è®¢å•è¯¦æƒ…è¡¨</span>
<span class="kwd">CREATE</span> <span class="kwd">TABLE</span> order_items (
    id <span class="kwd">INT</span> <span class="kwd">AUTO_INCREMENT</span> <span class="kwd">PRIMARY KEY</span>,
    order_id <span class="kwd">INT</span> <span class="kwd"><span class="kwd">NOT</span> NULL</span>,
    product_id <span class="kwd">INT</span> <span class="kwd"><span class="kwd">NOT</span> NULL</span>,
    quantity <span class="kwd">INT</span> <span class="kwd"><span class="kwd">NOT</span> NULL</span>,
    price <span class="type">DECIMAL</span>(<span class="num">10</span>, <span class="num">2</span>) <span class="kwd"><span class="kwd">NOT</span> NULL</span>,
    <span class="kwd">FOREIGN KEY</span> (order_id) <span class="kwd">REFERENCES</span> orders(id) <span class="kwd">ON</span> <span class="kwd">DELETE</span> <span class="kwd">CASCADE</span>,
    <span class="kwd">FOREIGN KEY</span> (product_id) <span class="kwd">REFERENCES</span> products(id)
);

<span class="com">-- å¤æ‚æŸ¥è¯¢ç¤ºä¾‹ï¼šæŸ¥è¯¢æŸä¸ªç”¨æˆ·çš„æ‰€æœ‰è®¢å•åŠè¯¦æƒ…</span>
<span class="kwd">SELECT</span>
    o.id <span class="kwd">as</span> order_id,
    o.order_date,
    o.total_amount,
    o.<span class="kwd">status</span>,
    p.name <span class="kwd">as</span> product_name,
    oi.quantity,
    oi.price
<span class="kwd">FROM</span> orders o
<span class="kwd">INNER JOIN</span> order_items oi <span class="kwd">ON</span> o.id = oi.order_id
<span class="kwd">INNER JOIN</span> products p <span class="kwd">ON</span> oi.product_id = p.id
<span class="kwd">WHERE</span> o.customer_id = <span class="num">1</span>
<span class="kwd">ORDER BY</span> o.order_date DESC;</code></pre>
                                </div>
                    </details>
                </div>
            </div>
        </section>
    </main>
    </div>

</body>
</html>